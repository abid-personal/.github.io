<!DOCTYPE html><html lang="en"><head><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&amp;display=swap"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="alternate" type="application/rss+xml" title="Hi. My name is Abid Omar and this is the corner of the web where I write some stuff - RSS feed" href="https://omarabid.com/rust-intro/feed.xml"/><title>A brief introduction to Rust</title><meta name="robots" content="follow, index"/><meta name="description" content="A brief introduction to Rust"/><meta property="og:url" content="https://omarabid.com/rust-intro/"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Abid Omar"/><meta property="og:description" content="A brief introduction to Rust"/><meta property="og:title" content="A brief introduction to Rust"/><meta property="og:image" content="https://omarabid.com/static/images/twitter-card.png"/><meta property="article:published_time" content="2019-10-10T00:00:00.000Z"/><link rel="canonical" href="https://omarabid.com/rust-intro/"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://omarabid.com/blog/rust-intro"
  },
  "headline": "A brief introduction to Rust",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://omarabid.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2019-10-10T00:00:00.000Z",
  "dateModified": "2019-10-10T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Abid Omar"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Abid Omar",
    "logo": {
      "@type": "ImageObject",
      "url": "https://omarabid.com/static/images/logo.svg"
    }
  },
  "description": "A brief introduction to Rust"
}</script><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/1acde02ea90c0019b1ed.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1acde02ea90c0019b1ed.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-ddd010a953737b6e3536.js" defer=""></script><script src="/_next/static/chunks/main-1aa55ee5cb237aff08bd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8b47dd6048cf98b00021.js" defer=""></script><script src="/_next/static/chunks/393-abafcbfcfcb496b3c637.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-fb6bd16194f61ff4cc96.js" defer=""></script><script src="/_next/static/KYIboEi8iEOtO3qwukdDm/_buildManifest.js" defer=""></script><script src="/_next/static/KYIboEi8iEOtO3qwukdDm/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap">@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9dCBsR6Z2vfE9aq3bpdva8iVtipIat--AvNcGYE8U.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9dCBsR6Z2vfE9aq3bpdva8iVtipIat--AvNZ-YE8U.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9dCBsR6Z2vfE9aq3bpdva8iVtipIat--AvNa2YE8U.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9dCBsR6Z2vfE9aq3bpdva8iVtipIat--AvNUGfE8U.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9dCBsR6Z2vfE9aq3bpdva8iVtipIat--AvNXifE8U.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiHOTXhke_M0u.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWgXOTXhke_M0u.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiXOTXhke_M0u.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhnOTXhke_M0u.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWi3OTXhke_M0u.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhXOTXhke_A.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiHOTXhke_M0u.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWgXOTXhke_M0u.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiXOTXhke_M0u.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhnOTXhke_M0u.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWi3OTXhke_M0u.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhXOTXhke_A.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiHOTXhke_M0u.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWgXOTXhke_M0u.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiXOTXhke_M0u.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhnOTXhke_M0u.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWi3OTXhke_M0u.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhXOTXhke_A.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiHOTXhke_M0u.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWgXOTXhke_M0u.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiXOTXhke_M0u.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhnOTXhke_M0u.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWi3OTXhke_M0u.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhXOTXhke_A.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiHOTXhke_M0u.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWgXOTXhke_M0u.woff2) format('woff2');unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWiXOTXhke_M0u.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhnOTXhke_M0u.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWi3OTXhke_M0u.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v12/uU9ICBsR6Z2vfE9aq3bpdvaWhXOTXhke_A.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="antialiased text-black bg-white dark:bg-gray-900 dark:text-white"><div id="__next"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><header class="relative flex flex-wrap justify-center content-center pt-44 pb-12"><div class="flex items-center justify-between"><h1 class="uppercase text-4xl"><a aria-label="Abid Omar Personal Blog" href="/">Abid Omar</a></h1></div><div class="absolute right-0"><button aria-label="Toggle Dark Mode" type="button" class="w-8 h-8 p-1 ml-1 mr-1 rounded sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button></div></header><div class="flex flex-col justify-between"><main class="mb-auto"><div class="max-w-3xl px-4 mx-auto sm:px-6 xl:max-w-5xl xl:px-0"><article><div><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">A brief introduction to Rust</h1></div></header><div class="pt-10 pb-8 divide-y divide-gray-200 xl:divide-y-0 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6" style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:pb-0 xl:col-span-3 xl:row-span-2"><div class="text-xl prose dark:prose-dark max-w-none"><p>This blog post will take a deep dive into the Rust world of mutability. By deep dive, it means the blog post is considerably long. So it will take time to go through the different examples. The topic we will dive through is specific but we will have to go through various Rust concepts: Ownership/Borrowing, Lifetimes, Unsafe, Sync, Closures, Macros and more. This might be intimidating and I think this is where many developers are put off.</p>
<p>This article assumes some familiarity with Rust; that is if you have successfully run a &quot;Hello World&quot; program, then you are qualified! If you have struggled with some of the hard concepts then this article could be a good introduction. It will not go deep for each one of these but will give you enough knowledge to help you understand the bigger picture.</p>
<hr/>
<p>We will start from a <em>reasonably</em> easy problem: We want to access a particular variable from any location in our program; by access, I mean both read and write access. That might seem like a straightforward thing to do, especially if you are coming from other languages like JavaScript. If we have a variable (and the browser is our sandbox), then we can make it global by attaching it to the <code>window</code> object. So if we have <code>window.config</code>, we can access (both read and write) the <code>config</code> variable from anywhere in our code.</p>
<p>So our problem is we have this <code>config</code> object but in Rust. The configuration object is a <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/rust-by-example/custom_types/structs.html">struct</a>. It can be set and initialized somewhere in our program. The initialization bit is important as we will find out later. Our configuration could be simple default values set in the code, and updated later; or it could require reading files, exchanging data over the network, etc. So we want to be sure that we can do both.</p>
<p>We have other requirements and although most of the use cases don&#x27;t need these niceties, it is better to have them for the future (And these are the kind of problems that Rust is intended to solve). Like, for example, our program might also become multithreaded in the future, as we anticipate more cores in the CPU and less improvement in the clock rate.</p>
<p>Things are already starting to confuse; so how about we start with a simple example and the most basic implementation of a configuration struct.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[derive(Debug)]</span>
</span><span class="code-line"><span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Hello, world!&quot;</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Debugging value: {}&quot;</span><span class="text-code-white">,</span> <span class="text-code-blue">config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Rechecking Debugging value: {}&quot;</span><span class="text-code-white">,</span> <span class="text-code-blue">config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">config</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>output</code></p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">Hello, world<span class="">!</span>
</span><span class="code-line">Debugging value: <span class="text-code-red">false</span>
</span><span class="code-line">Rechecking Debugging value: <span class="text-code-red">false</span>
</span></code></pre></div>
<p>Pretty simple: We use a function named <code>config</code> to return an instance of our configuration. Inside <code>config</code>, we make a new <code>MyConfig</code> instance for each call and then return it. (We could have placed this code in a different file and called it with <code>mod filename</code>; we are going to do that later, so don&#x27;t worry!).</p>
<p>So far so good. But there is a small issue here: Every time we call the <code>config</code> function, we return a <em>new</em> instance of <code>MyConfig</code>. Practically speaking, it is the <em>same</em> configuration; but technically speaking, it is a <em>different</em> object. Imagine, for instance, that our <code>config</code> function was querying a database for a particular field. The <code>config</code> function will be doing the query every time we call it. This is not good; after all we should only do it one time both for efficiency and consistency.</p>
<p>What we want is a single initialization of our configuration. That initialization is safeguarded somewhere, and then we access it as many times as we want. Basically, a global variable accessible from the <code>config</code> function or any other location in our program.</p>
<p>This time, we will separate our program into two files: <code>main.rs</code> and <code>config.rs</code>. The code could function from within <code>main.rs</code> but the separation of concerns is helpful.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">mod</span> <span class="">config</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">config<span class="text-code-white">::</span></span><span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Hello, world!&quot;</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Debug: {}&quot;</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Rechecking Debug: {}&quot;</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>config.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[derive(Debug)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">static</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">&amp;</span><span class="">&#x27;static</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="">&amp;</span><span class="">CONFIG</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Alright, a lot is going on here; especially if you are both new to and confused by the Rust syntax. But don&#x27;t worry, we will explain it in details. First, we are still using a function to return our configuration; but this time it is attached to the <code>MyConfig</code> struct. Think of a Rust struct like a JavaScript object or in OOP languages like a class where you can add both fields and methods to your struct. The method that returns our configuration is <code>global_config</code>.</p>
<p>Let&#x27;s go back further, this line deserves some explanation.</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">static</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span></code></pre></div>
<p>Creating a <em>global variable</em> in Rust is pretty easy. We just use the <code>static</code> keyword. Now, our variable <em>can be</em> available anywhere in our program. In fact, this is what the rust-lang documentation says about the <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/rust-by-example/scope/lifetime/static_lifetime.html">static</a> keyword:</p>
<blockquote>
<p>A &#x27;static lifetime is the longest possible lifetime, and lasts for the lifetime of the running program.</p>
</blockquote>
<p>Okay, that was a trap. What is a <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/rust-by-example/scope/lifetime.html">lifetime</a>? Well, you can go with the raw and naive definition: How long you will live. But that definition doesn&#x27;t seem about our <code>static</code> keyword, or is it? It is also way too simplistic. The rust-lang website will already throw words like <em>borrow checker</em> at you. That&#x27;s scary, so how about we stick to the raw definition for now: How long the variable will live.</p>
<p>So what&#x27;s <code>&#x27;static</code>? It is the longest lifetime; which means the entirety of our program. It means our variable will be <em>alive</em> and accessible as long as our program is running. The <code>static</code> keyword doesn&#x27;t mean our variable is a <em>constant</em> but just that it has a <code>&#x27;static</code> lifetime. A better word is <em>immortal</em> but that doesn&#x27;t sound geeky and cryptic enough and hence the choice of <code>&#x27;static</code>. If you are still confused, notice that <code>&#x27;static</code> is the name of the lifetime while <code>static</code> is a keyword that gives our variable a <code>&#x27;static</code> lifetime.</p>
<p>Our configuration is initialized once and we declare a global variable named <code>CONFIG</code>. To access it, we use the function <code>global_config</code> implemented in our struct; but since it is a global variable we could access it from anywhere really.</p>
<p>Let&#x27;s dissect the <code>global_config</code> function. If you are new to Rust, you might have already noticed the gibberish in that function. We are not returning <code>MyConfig</code> in the function signature but adding a bunch of keywords; something must be going on.</p>
<p>To understand what is going on, you might need to understand the Rust Ownership/Borrowing model. Don&#x27;t worry, we will stick to the naive definition: You can&#x27;t take/move what you don&#x27;t own, but you can borrow it. You can&#x27;t make changes on what you borrow unless you request permissions; and even then you are going to have to follow some rules.</p>
<p>So let&#x27;s test the constitution. If you run this line inside the main function.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">let</span> myconfig<span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">config<span class="text-code-white">::</span></span><span class="">CONFIG</span><span class="text-code-white">;</span>
</span></code></pre></div>
<p>On execution, we are going to get the following error.</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">error<span class="text-code-white">[</span><span class="">E0507</span><span class="text-code-white">]</span><span class="text-code-white">:</span> cannot <span class="text-code-purple">move</span> out of <span class="text-code-purple">static</span> item
</span><span class="code-line"> <span class="">-</span><span class="text-code-white">-&gt;</span> src<span class="">/</span>main<span class="text-code-white">.</span>rs<span class="text-code-white">:</span><span class="">9</span><span class="text-code-white">:</span><span class="">30</span>
</span><span class="code-line">  <span class="">|</span>
</span><span class="code-line"><span class="">9</span> <span class="">|</span>     <span class="text-code-purple">let</span> myconfig<span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">config<span class="text-code-white">::</span></span><span class="">CONFIG</span><span class="text-code-white">;</span>
</span><span class="code-line">  <span class="">|</span>                              <span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span><span class="">^</span>
</span><span class="code-line">  <span class="">|</span>                              <span class="">|</span>
</span><span class="code-line">  <span class="">|</span>                              cannot <span class="text-code-purple">move</span> out of <span class="text-code-purple">static</span> item
</span><span class="code-line">  <span class="">|</span>                              help<span class="text-code-white">:</span> consider borrowing here<span class="text-code-white">:</span> `<span class="">&amp;</span><span class="">config<span class="text-code-white">::</span></span><span class="">CONFIG</span>`
</span></code></pre></div>
<p>We do not own <code>CONFIG</code>. The ruler, therefore, would not allow moving it but most importantly: There is no way around it. The ruler would also gives us a hint: consider borrowing.</p>
<p>Borrowing is actually pretty cool: We can access the object from where it is located; and that is basically it. But that serves our purposes, right? (Plus Rust doesn&#x27;t charge us any interest!).</p>
<p>So this code is fine. (again we can run this code on <code>main.rs</code>)</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">  <span class="text-code-purple">let</span> myconfig<span class="text-code-white">:</span> <span class="">&amp;</span><span class="">MyConfig</span> <span class="">=</span> <span class="">&amp;</span><span class="">config<span class="text-code-white">::</span></span><span class="">CONFIG</span><span class="text-code-white">;</span>
</span><span class="code-line">  <span class="">dbg!</span><span class="text-code-white">(</span>myconfig<span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span></code></pre></div>
<p>Notice that here we do neither own nor move <code>CONFIG</code>. We are barely <em>referencing</em> it. The type of my <code>myconfig</code> is <code>&amp;MyConfig</code> and not <code>MyConfig</code>. A reference, and not the actual thing. To create a reference, we use an ampersand <code>&amp;</code>.</p>
<p>If you have been successfully following along, you almost did understand what the code in <code>global_config</code> does. Except for one more sketchy keyword: <code>&amp;&#x27;static</code>. If we tried to return <code>&amp;MyConfig</code> instead of <code>&amp;&#x27;static MyConfig</code>, we will get the following error.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">error<span class="text-code-white">[</span>E0106<span class="text-code-white">]</span>: missing lifetime specifier
</span><span class="code-line"> --<span class="">&gt;</span> src/config.rs:9:31
</span><span class="code-line">  <span class="">|</span>
</span><span class="code-line"><span class="">9</span> <span class="">|</span>     pub fn global_config<span class="text-code-white">(</span><span class="text-code-white">)</span> -<span class="">&gt;</span> <span class="">&amp;</span>MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">  <span class="">|</span>                               ^ help: consider giving it a <span class="text-code-green">&#x27;static lifetime: `&amp;&#x27;</span>static`
</span><span class="code-line">  <span class="">|</span>
</span><span class="code-line">  <span class="">=</span> help: this function&#x27;s <span class="">return</span> <span class="">type</span> contains a borrowed value, but there is no value <span class="text-code-purple">for</span> it to be borrowed from
</span></code></pre></div>
<p>The ruler is asking for a lifetime to our reference. You might be wondering: Why, and what does that mean? And what does a reference mean in the first place?</p>
<p>The <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html">Rust Programming Language book</a> has a rather helpful definition.</p>
<blockquote>
<p>These ampersands are references, and they allow you to refer to some value without taking ownership of it.</p>
</blockquote>
<blockquote>
<p>The opposite of referencing by using &amp; is dereferencing, which is accomplished with the dereference operator, *.</p>
</blockquote>
<p>Okay, so referencing is actually <em>borrowing</em>. But what is a lifetime? <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/rust-by-example/scope/lifetime.html">Rust By Example</a> has an average explanation.</p>
<blockquote>
<p>A lifetime is a construct the compiler (or more specifically, its borrow checker) uses to ensure all borrows are valid. Specifically, a variable&#x27;s lifetime begins when it is created and ends when it is destroyed. While lifetimes and scopes are often referred to together, they are not the same.</p>
</blockquote>
<blockquote>
<p>Take, for example, the case where we borrow a variable via &amp;. The borrow has a lifetime that is determined by where it is declared. As a result, the borrow is valid as long as it ends before the lender is destroyed. However, the scope of the borrow is determined by where the reference is used.</p>
</blockquote>
<p>What if <code>CONFIG</code> is dropped from memory? Now, we know for certain that this will not happen because <code>CONFIG</code> is <em>immortal</em> but the compiler doesn&#x27;t know that. In our signature, we are returning a reference to <code>MyConfig</code> and not <code>CONFIG</code>; so it is not clear how long the real object will live for. If that object is dropped, then our reference will fail. We need to ensure that our reference lives at most as the object it is <em>pointing</em> at. Not more.</p>
<p>In my opinion, the hard part about lifetimes is the unreadable gibberish that accompanies it. First, we need to define (or name) a lifetime. We do that before the function signature. We will make use of <code>&lt;,&gt;</code> and an apostrophe; that&#x27;s pretty clean. To make it more confusing, let&#x27;s name our lifetime &quot;a&quot; even though we can use a more meaningful names. If everybody on the community does that, it will greatly help beginners: They will think it is some sort of keyword out there. But as we will use it again in the returned value with an apostrophe, they will finally succumb and concede that it is pure wizardry.</p>
<p>Look at this! This code actually runs!</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"> <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="">&lt;</span><span class="">&#x27;a</span><span class="">&gt;</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">&amp;</span><span class="">&#x27;a</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">let</span> myconfig <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">true</span> <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="">&amp;</span>myconfig
</span><span class="code-line">    <span class="text-code-white">}</span>
</span></code></pre></div>
<p>Instead of defining a lifetime, we can assign the <code>&#x27;static</code> lifetime. That makes sense since the item we are borrowing from has a <code>&#x27;static</code> lifetime itself and should live for the entirety of the program. We don&#x27;t need to define the <code>&#x27;static</code> lifetime though, as it already is. If we replace the <code>&#x27;a</code> with <code>&#x27;static</code> and remove the definition, we will achieve our previous program.</p>
<hr/>
<p>Let&#x27;s move ahead. Now that your business is growing, your configuration is getting more sophisticated. In order to initialize the configuration, you need to run some tasks (like querying a database or reading from a file). Basically, you want to call a function that returns your configuration instead of having it <em>statically</em> defined.</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[derive(Debug)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">new</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="text-code-purple">Self</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">&amp;</span><span class="">&#x27;static</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="">&amp;</span><span class="">CONFIG</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>This new code defines a function <code>new</code>; which you might think of as a constructor. It will create a new instance of <code>Myconfig</code> and returns it. Since it is implemented within the <code>MyConfig</code> struct, it is basically returning an instance of itself. Thus, the use of the keyword <code>self</code>.</p>
<p>Unluckily, this doesn&#x27;t work. The ruler, again, complains.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">error<span class="text-code-white">[</span>E0015<span class="text-code-white">]</span>: calls <span class="text-code-purple">in</span> statics are limited to constant functions, tuple structs and tuple variants
</span><span class="code-line"> --<span class="">&gt;</span> src/config.rs:6:31
</span><span class="code-line">  <span class="">|</span>
</span><span class="code-line"><span class="">6</span> <span class="">|</span> pub static CONFIG: MyConfig <span class="">=</span> MyConfig::new<span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">  <span class="">|</span>                               ^^^^^^^^^^^^^^^
</span></code></pre></div>
<p>In case you think this is restricting, you need to understand one more idea: Statics are evaluated at compile time; in other words they are <em>hard-coded</em> into the binary. Functions, on the other hand, are only called at run time. This means Rust can&#x27;t determine the value of our static variable at compile time; and therefore can&#x27;t compile the program.</p>
<p>This is a major roadblock and there seems to be no way around it. Since it is impossible to assign a value to a <em>non-mutable</em> static variable at run time, we will have to resort to magic. If you are a scientist and don&#x27;t believe in magic, then this is a good time.</p>
<p>First, we need to add an external dependency named <code>lazy_static</code> to the <code>Cargo.toml</code> file.</p>
<p><code>Cargo.toml</code></p>
<div class="relative"><pre><code class="language-toml code-highlight"><span class="code-line"><span class="text-code-white">[</span><span class="">dependencies</span><span class="text-code-white">]</span>
</span><span class="code-line"><span class="">lazy_static</span> <span class="text-code-white">=</span> &quot;<span class="">1.3</span><span class="text-code-white">.</span><span class="">0</span>
</span></code></pre></div>
<p>Next, we import the dependency on <code>main.rs</code>.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[macro_use]</span>
</span><span class="code-line"><span class="text-code-purple">extern</span> <span class="text-code-purple">crate</span> <span class="">lazy_static</span><span class="text-code-white">;</span>
</span></code></pre></div>
<p>And now to the magical part, replace the previous definition with the following.</p>
<p><code>config.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">lazy_static!</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">ref</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Tada! Now our program works. Pretty cool, heh? It is not clear what kind of magic the <code>lazy_static</code> did but it just works. So that was lucky!</p>
<hr/>
<p>Except things are about to complicate a bit more. A new bureaucrat in the organization demands that he is able to pass the debug value to the configuration constructor. Bureaucrats want control and this particular one is not happy that debug can only be set from within the <code>MyConfig</code> constructor since it is outside of his jurisdiction.</p>
<p>So we change our constructor to allow him to sneak in.</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">new</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="text-code-purple">bool</span><span class="">&gt;</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="text-code-purple">Self</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-gray-400 italic">// We are just eluding him of power, we don&#x27;t actually use the custom_debug variable.</span>
</span><span class="code-line">        <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span></code></pre></div>
<p>This code is fine but it won&#x27;t compile because the static variable will require that we pass an optional boolean value. In case you don&#x27;t know what <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/option/index.html">Option</a>s are, this is a good time to introduce them. The bureaucrat is not certain that he wants to pass a debug value all the times. He just wants to have the option in case he feels like it. Rust, however, requires that parameters (declared in the function signature) are fully respected. That is, if we have a debug parameter, it needs to be there.</p>
<p>To manage this bureaucracy, Rust introduces an <code>Option</code> type: It encapsulates the real value if there is one; and if there is none it returns a type named <code>None</code>. Simple. It also has a set of functions to manage that additional bureaucracy overhead.</p>
<p>To make our code compile, we can do the following.</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">lazy_static!</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">ref</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">false</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Notice that we are using a function named <code>Some</code>. This is because the value that we need to pass is not a <code>bool</code> but an <code>Option&lt;bool&gt;</code>. The <code>Some</code> function encapsulates our <code>bool</code> inside an <code>Option</code>. So that was easy.</p>
<p>Except that bureaucrats can&#x27;t access the <code>config.rs</code> file. They need to pass the value from another place: <code>main.rs</code>. Since our <code>CONFIG</code> is not defined there, we need to create a new function to accommodate. This is going to complicate our setup but we have to comply.</p>
<p>Easy, right?</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">init</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="text-code-purple">bool</span><span class="">&gt;</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">Result</span><span class="">&lt;</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="text-code-purple">i32</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="">lazy_static!</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">ref</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">false</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="">Ok</span><span class="text-code-white">(</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">)</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Here we introduce, again, a new type: <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/result/">Result</a>. <code>Result</code> is similar to <code>Option</code> but serves another purpose and the name should be self-explanatory. <code>Result</code> could be either a success and return our result (in this case <code>()</code>) or a failure and return an error (in this case <code>i32</code>). I&#x27;m not going to go through it but you can check the <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/result/">Rust docs</a>.</p>
<p>Unfortunately, this doesn&#x27;t work. Even though <code>CONFIG</code> has a static (infinite) lifetime, you can&#x27;t access it outside the <code>init</code> function. In order to be able to do that, you need to return it. But we don&#x27;t want to do that; and neither that works (We do not own <code>CONFIG</code>).</p>
<p>If you think things started to overly complicate; then hold your breath. In the last example, we were not passing the <code>custom_debug</code> variable; we were just accepting it in the function signature. Now that our bureaucrats found out our misdeed, we need to pass it to the <code>lazy_static!</code> block; but if we do, we get the following error.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">error<span class="text-code-white">[</span>E0434<span class="text-code-white">]</span>: can&#x27;t capture dynamic environment <span class="text-code-purple">in</span> a fn item
</span><span class="code-line">  --<span class="">&gt;</span> src/config.rs:12:61
</span><span class="code-line">   <span class="">|</span>
</span><span class="code-line"><span class="">12</span> <span class="">|</span>             pub static ref CONFIG: MyConfig <span class="">=</span> MyConfig::new<span class="text-code-white">(</span>custom_debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">   <span class="">|</span>                                                             ^^^^^^^^^^^^
</span><span class="code-line">   <span class="">|</span>
</span><span class="code-line">   <span class="">=</span> help: use the <span class=""><span class="">`</span><span class="">||</span> <span class="text-code-white">{</span> <span class="text-code-white">..</span>. <span class="text-code-white">}</span><span class="">`</span></span> closure form instead
</span></code></pre></div>
<p>Great, things are getting out of control; and Rust is throwing an unreadable error message. What is an <em>fn item</em>, a <em>dynamic environment</em> and a <em>closure</em>? That&#x27;s a lot to take on a single error message and we already have another part of our program non-functioning. The truth is, we are coming to the reality that <code>lazy_static!</code> is not magic. It is just a macro.</p>
<p>What is a <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Macro_(computer_science)">macro</a>?</p>
<p>A macro is a way to generate Rust code for you. But what is this macro exactly generating? That could shed some light to what it does and maybe hint to better solutions.</p>
<p>Well, it turns out that it is possible to know that. Using this command, we can output the final code that Rust is compiling.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">cargo rustc -- -Z unstable-options --pretty<span class="">=</span>expanded
</span></code></pre></div>
<p>If you run this, you will see that a lot is going on. <code>println!</code> is a macro. That means the final code is much more than that single line. For now, we will focus on the code generated by <code>lazy_static!</code>.</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[allow(missing_copy_implementations)]</span>
</span><span class="code-line"><span class="">#[allow(non_camel_case_types)]</span>
</span><span class="code-line"><span class="">#[allow(dead_code)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">CONFIG</span> <span class="text-code-white">{</span>
</span><span class="code-line">    __private_field<span class="text-code-white">:</span> <span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line"><span class="">#[doc(hidden)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">CONFIG</span> <span class="">=</span> <span class="">CONFIG</span><span class="text-code-white">{</span>__private_field<span class="text-code-white">:</span> <span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span><span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="text-code-white">::</span><span class="">lazy_static<span class="text-code-white">::</span></span>__Deref <span class="text-code-purple">for</span> <span class="">CONFIG</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">type</span>
</span><span class="code-line">    <span class="">Target</span>
</span><span class="code-line">    <span class="">=</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="text-code-purple">fn</span> <span class="">deref</span><span class="text-code-white">(</span><span class="">&amp;</span><span class="text-code-purple">self</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">&amp;</span><span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="">#[inline(always)]</span>
</span><span class="code-line">        <span class="text-code-purple">fn</span> <span class="">__static_ref_initialize</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">)</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">        <span class="">#[inline(always)]</span>
</span><span class="code-line">        <span class="text-code-purple">fn</span> <span class="">__stability</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">&amp;</span><span class="">&#x27;static</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="text-code-purple">static</span> <span class="">LAZY</span><span class="text-code-white">:</span> <span class="text-code-white">::</span><span class="">lazy_static<span class="text-code-white">::</span>lazy<span class="text-code-white">::</span></span><span class="">Lazy</span><span class="">&lt;</span><span class="">MyConfig</span><span class="">&gt;</span> <span class="">=</span>
</span><span class="code-line">                <span class="text-code-white">::</span><span class="">lazy_static<span class="text-code-white">::</span>lazy<span class="text-code-white">::</span></span><span class="">Lazy</span><span class="text-code-white">::</span><span class="">INIT</span><span class="text-code-white">;</span>
</span><span class="code-line">            <span class="">LAZY</span><span class="text-code-white">.</span><span class="text-code-blue">get</span><span class="text-code-white">(</span>__static_ref_initialize<span class="text-code-white">)</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">        <span class="text-code-blue">__stability</span><span class="text-code-white">(</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="text-code-white">::</span><span class="">lazy_static<span class="text-code-white">::</span></span><span class="">LazyStatic</span> <span class="text-code-purple">for</span> <span class="">CONFIG</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">fn</span> <span class="">initialize</span><span class="text-code-white">(</span>lazy<span class="text-code-white">:</span> <span class="">&amp;</span><span class="text-code-purple">Self</span><span class="text-code-white">)</span> <span class="text-code-white">{</span> <span class="text-code-purple">let</span> _ <span class="">=</span> <span class="">&amp;</span><span class="">*</span><span class="">*</span>lazy<span class="text-code-white">;</span> <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Oops...</p>
<p>There is a lot going on here. First, <code>lazy_static!</code> is creating a new type (<code>config::MyConfig::init::CONFIG</code>). This can explain this weird error message when we try to return <code>CONFIG</code>.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">error<span class="text-code-white">[</span>E0308<span class="text-code-white">]</span>: mismatched types
</span><span class="code-line">  --<span class="">&gt;</span> src/config.rs:15:12
</span><span class="code-line">   <span class="">|</span>
</span><span class="code-line"><span class="">15</span> <span class="">|</span>         Ok<span class="text-code-white">(</span>CONFIG<span class="text-code-white">)</span>
</span><span class="code-line">   <span class="">|</span>            ^^^^^^ expected struct <span class=""><span class="">`</span>config::MyConfig<span class="">`</span></span>, found struct <span class=""><span class="">`</span>config::MyConfig::init::CONFIG<span class="">`</span></span>
</span><span class="code-line">   <span class="">|</span>
</span><span class="code-line">   <span class="">=</span> note: expected <span class="">type</span> <span class=""><span class="">`</span>config::MyConfig<span class="">`</span></span>
</span><span class="code-line">              found <span class="">type</span> <span class=""><span class="">`</span>config::MyConfig::init::CONFIG<span class="">`</span></span>
</span></code></pre></div>
<p>Cool. We are no longer using the <code>MyConfig</code> struct but another one that <code>lazy_static!</code> invented. It looks like <code>lazy_static!</code> has code that executes our function, gets the returned value and creates a new type that imitates our struct. But don&#x27;t take my word for it. I just happen to know about Rust as much as you do!</p>
<hr/>
<p>Remind me again: <em>Why are we here</em>?</p>
<p>The thing is, our problem seems to be simple. Only if we were able to change the value of the static variable after declaring it. That will solve all of our headaches. Let us get rid of <code>lazy_static!</code> and possibly enjoy the rest of the day with friends.</p>
<p>Who said we can&#x27;t?</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">mod</span> <span class="">config</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">config<span class="text-code-white">::</span></span><span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Hello, world!&quot;</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Debug value: {}&quot;</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">true</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Recheck Debug value: {}&quot;</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>config.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[derive(Debug)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">mut</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">init</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="text-code-purple">bool</span><span class="">&gt;</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">Result</span><span class="">&lt;</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="text-code-purple">i32</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">unsafe</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="">CONFIG</span><span class="text-code-white">.</span>debug <span class="">=</span> custom_debug<span class="text-code-white">.</span><span class="text-code-blue">unwrap_or</span><span class="text-code-white">(</span><span class="text-code-red">false</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">        <span class="">Ok</span><span class="text-code-white">(</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">&amp;</span><span class="">&#x27;static</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">unsafe</span> <span class="text-code-white">{</span> <span class="">&amp;</span><span class="">CONFIG</span> <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>output</code></p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">Hello, world<span class="">!</span>
</span><span class="code-line">Debug value: <span class="text-code-red">false</span>
</span><span class="code-line">Recheck Debug value: <span class="text-code-red">true</span>
</span></code></pre></div>
<p>Notice a few things here: <code>static</code> means a <code>&#x27;static</code> (infinite) lifetime. It doesn&#x27;t mean we can&#x27;t mutate the variable. It is not a constant. We can change it if we add the keyword <code>mut</code>. Rust doesn&#x27;t consider it safe (Thus the <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html">unsafe</a> keyword) but what does Rust know about the life of the streets??! Our program works. There is <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=RS7IzU2VJIQ">plastic in the ocean</a>; I mean, on the big scheme of things, this is a minor issue, right?</p>
<hr/>
<p>But this is not what Rust stands for, is it? We need to live up to the hype, but how do we go about that?</p>
<p>We can start by putting this line at the top of our program.</p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#![forbid(unsafe_code)]</span>
</span></code></pre></div>
<p>Running the previous code will now result in an error.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">error: usage of an <span class=""><span class="">`</span>unsafe<span class="">`</span></span> block
</span><span class="code-line">  --<span class="">&gt;</span> src/config.rs:10:9
</span><span class="code-line">   <span class="">|</span>
</span><span class="code-line"><span class="">10</span> <span class="">|</span> /         unsafe <span class="text-code-white">{</span>
</span><span class="code-line"><span class="">11</span> <span class="">|</span> <span class="">|</span>             CONFIG.debug <span class="">=</span> custom_debug.unwrap_or<span class="text-code-white">(</span>false<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="">12</span> <span class="">|</span> <span class="">|</span>         <span class="text-code-white">}</span>
</span><span class="code-line">   <span class="">|</span> <span class="">|</span>_________^
</span><span class="code-line">   <span class="">|</span>
</span></code></pre></div>
<p>Now we know what we want. We want a global variable that we can, at a certain point, mutate with external variables. But we must do that safely; and be ready for the future of multiple processors, cores and threads.</p>
<p>Let&#x27;s start with the global variable mutation. One might think that it is not possible to safely mutate static variables. And that&#x27;s actually correct which is why the Rust team has come up with some solutions.</p>
<p>Hidden somewhere in one of Rust&#x27;s types documentation (<a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/cell/struct.Cell.html">Cell</a>), we can read the following.</p>
<blockquote>
<p>Rust memory safety is based on this rule: Given an object T, it is only possible to have one of the following:</p>
</blockquote>
<blockquote>
<ul>
<li>Having several immutable references (&amp;T) to the object (also known as aliasing).</li>
<li>Having one mutable reference (&amp;mut T) to the object (also known as mutability).</li>
</ul>
</blockquote>
<p>Yes, that&#x27;s our problem right here.</p>
<blockquote>
<p>This is enforced by the Rust compiler. However, there are situations where this rule is not flexible enough. Sometimes it is required to have multiple references to an object and yet mutate it.</p>
</blockquote>
<blockquote>
<p>Shareable mutable containers exist to permit mutability in a controlled manner, even in the presence of aliasing. bla bla bla...</p>
</blockquote>
<p>Cool. That&#x27;s our solution right there. The <code>Cell</code>! Let&#x27;s go and implement it.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">mod</span> <span class="">config</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">config<span class="text-code-white">::</span></span><span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span><span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>config.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>cell<span class="text-code-white">::</span></span><span class="">Cell</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">#[derive(Debug, Copy, Clone)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">Cell</span><span class="">&lt;</span><span class="">MyConfig</span><span class="">&gt;</span> <span class="">=</span> <span class="">Cell</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">init</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="text-code-purple">bool</span><span class="">&gt;</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">Result</span><span class="">&lt;</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="text-code-purple">i32</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">match</span> custom_debug <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="">Some</span><span class="text-code-white">(</span>debug_value<span class="text-code-white">)</span> <span class="">=&gt;</span> <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">set</span><span class="text-code-white">(</span><span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> debug_value <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">,</span>
</span><span class="code-line">            <span class="">None</span> <span class="">=&gt;</span> <span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span>
</span><span class="code-line">        <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="">Ok</span><span class="text-code-white">(</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">get</span><span class="text-code-white">(</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>output</code></p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">error<span class="text-code-white">[</span>E0277<span class="text-code-white">]</span>: <span class=""><span class="">`</span>std::cell::Cell<span class="">&lt;</span>config::MyConfig<span class="">&gt;</span><span class="">`</span></span> cannot be shared between threads safely
</span><span class="code-line"> --<span class="">&gt;</span> src/config.rs:8:1
</span><span class="code-line">  <span class="">|</span>
</span><span class="code-line"><span class="">8</span> <span class="">|</span> pub static CONFIG: Cell<span class="">&lt;</span>MyConfig<span class="">&gt;</span> <span class="">=</span> Cell::new<span class="text-code-white">(</span>MyConfig <span class="text-code-white">{</span> debug: <span class="text-code-red">false</span> <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">  <span class="">|</span> ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ <span class=""><span class="">`</span>std::cell::Cell<span class="">&lt;</span>config::MyConfig<span class="">&gt;</span><span class="">`</span></span> cannot be shared between threads safely
</span><span class="code-line">  <span class="">|</span>
</span><span class="code-line">  <span class="">=</span> help: the trait <span class=""><span class="">`</span>std::marker::Sync<span class="">`</span></span> is not implemented <span class="text-code-purple">for</span> <span class=""><span class="">`</span>std::cell::Cell<span class="">&lt;</span>config::MyConfig<span class="">&gt;</span><span class="">`</span></span>
</span><span class="code-line">  <span class="">=</span> note: shared static variables must have a <span class="">type</span> that implements <span class=""><span class="">`</span>Sync<span class="">`</span></span>
</span></code></pre></div>
<p>This doesn&#x27;t work but it is important to note that this particular configuration, add a few complications: The <code>Clone</code> and <code>Copy</code> keywords. While they seem harmless now, they might be limiting for your future configurations complexity. In case you are wondering what they are about, we will get to them later on in this article.</p>
<p>But, for now, the gist of it, is that <code>Cell</code> is not thread-safe; whatever that means. We need a type like <code>Cell</code> but that happens to be <em>thread-safe</em>.</p>
<p>Browsing more through the Rust website, we find the <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/atomic/">atomic types</a>.</p>
<blockquote>
<p>Atomic types provide primitive shared-memory communication between threads, and are the building blocks of other concurrent types.</p>
</blockquote>
<p>Reading further into the documentation.</p>
<blockquote>
<p>Atomic variables are safe to share between threads (they implement Sync) but they do not themselves provide the mechanism for sharing and follow the threading model of rust. The most common way to share an atomic variable is to put it into an Arc (an atomically-reference-counted shared pointer).</p>
</blockquote>
<p>Atomic variables looks like they are the building block for higher-level types that might solve our problem. We should not use them (as per the advice of the documentation) and instead use the higher-level abstractions.</p>
<blockquote>
<p>Most of the low-level synchronization primitives are quite error-prone and inconvenient to use, which is why the standard library also exposes some higher-level synchronization objects.</p>
</blockquote>
<p>These objects are <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/struct.Arc.html">Arc</a>, <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/struct.Barrier.html">Barrier</a>, <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/struct.Condvar.html">Condvar</a>, <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/struct.Mutex.html">Mutex</a>, <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/struct.Once.html">Once</a>, and <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/sync/struct.RwLock.html">RwLock</a>. That&#x27;s a lot and might mean that the problem at hand is rather hard. Imagine you have two threads executing at the same time: You&#x27;d want a solid framework to let them share access to the same variable. That&#x27;s basically what this mess is about. If we were to have a single-threaded application, things would be much simpler. But we live in a world where quantum tunneling is a real thing!</p>
<p>So which one do we need? We want multiple access to the global variable (configuration). There are several that can fit the bill. Each has its own quirks and limitations.</p>
<p>Let&#x27;s look for example at <code>Once</code>.</p>
<blockquote>
<p>A synchronization primitive which can be used to run a one-time global initialization. Useful for one-time initialization for FFI or related functionality. This type can only be constructed with the ONCE_INIT value or the equivalent Once::new constructor.</p>
</blockquote>
<p>This sounds good if we want to do a single, one-time initialization of our configuration variable. But how is the code going to look like and what if we initialize twice?</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">mod</span> <span class="">config</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">config<span class="text-code-white">::</span></span><span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Hello, world!&quot;</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Debug value: {}&quot;</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">true</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Recheck Debug value: {}&quot;</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">false</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Recheck Debug value: {}&quot;</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span>debug<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>config.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>sync<span class="text-code-white">::</span></span><span class="">Once</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">#[derive(Debug)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="">INIT</span><span class="text-code-white">:</span> <span class="">Once</span> <span class="">=</span> <span class="">Once</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">mut</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">MyConfig</span> <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">init</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="text-code-purple">bool</span><span class="">&gt;</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">Result</span><span class="">&lt;</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="text-code-purple">i32</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="">INIT</span><span class="text-code-white">.</span><span class="text-code-blue">call_once</span><span class="text-code-white">(</span><span class=""><span class="">|</span><span class="">|</span></span> <span class="text-code-purple">unsafe</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="text-code-purple">match</span> custom_debug <span class="text-code-white">{</span>
</span><span class="code-line">                <span class="">Some</span><span class="text-code-white">(</span>debug_value<span class="text-code-white">)</span> <span class="">=&gt;</span> <span class="">CONFIG</span> <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">true</span> <span class="text-code-white">}</span><span class="text-code-white">,</span>
</span><span class="code-line">                <span class="">None</span> <span class="">=&gt;</span> <span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span>
</span><span class="code-line">            <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="">Ok</span><span class="text-code-white">(</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">&amp;</span><span class="">&#x27;static</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">unsafe</span> <span class="text-code-white">{</span> <span class="">&amp;</span><span class="">CONFIG</span> <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>The program runs and here is the output.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">Hello, world<span class="">!</span>
</span><span class="code-line">Debug value: <span class="text-code-red">false</span>
</span><span class="code-line">Recheck Debug value: <span class="text-code-red">true</span>
</span><span class="code-line">Recheck Debug value: <span class="text-code-red">true</span>
</span></code></pre></div>
<p>Cool. The <code>init</code> function is functioning as expected. If we recall <code>init</code> twice, however, nothing happens. We can pass variables to our closure. So everything is working just fine. Plus we got rid of the <code>lazy_static</code> crate. One thing to keep out of this mess.</p>
<p>Except, if you have a good eye, you should have noticed something that you probably won&#x27;t like much (at least if you agreed with our previous monologue). We are using <code>unsafe</code> code!</p>
<p>Well, according to Rust, this should be pretty safe.</p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">// Accessing a `static mut` is unsafe much of the time, but if we do so
</span><span class="code-line">// in a synchronized fashion (e.g., write once or read all) then we&#x27;re
</span><span class="code-line">// good to go!
</span></code></pre></div>
<p>But there is still something bugging me about it: First, we can only change the configuration one time. This might be enough but it is not quite what we want. Second, we are using <code>unsafe</code> blocks of code. While this is somewhat safe, it opens up the possibility that a developer handles the code unsafely. After all, you just opened a can of worms in a controlled environment. That might have risks since the environment might get out of our control as the code base grows and more developers are recruited.</p>
<p>Better keep the can of worms closed if we can afford it. Luckily, we have a wide range of sync objects to choose from. Let&#x27;s look at <code>RwLock</code>.</p>
<blockquote>
<p>This type of lock allows a number of readers or at most one writer at any point in time. The write portion of this lock typically allows modification of the underlying data (exclusive access) and the read portion of this lock typically allows for read-only access (shared access).</p>
</blockquote>
<p>Sounds too good to be true? This allows us, basically, to modify the global variables (from a single location) and access it from multiple locations. Well it does come with some complications, however.</p>
<blockquote>
<p>The priority policy of the lock is dependent on the underlying operating system&#x27;s implementation, and this type does not guarantee that any particular policy will be used.</p>
</blockquote>
<blockquote>
<p>The type parameter T represents the data that this lock protects. It is required that T satisfies Send to be shared across threads and Sync to allow concurrent access through readers. The RAII guards returned from the locking methods implement Deref (and DerefMut for the write methods) to allow access to the content of the lock.</p>
</blockquote>
<p>That&#x27;s some more gibberish out there; but this looks like something we should be able to manage. Let&#x27;s give it a try.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[macro_use]</span>
</span><span class="code-line"><span class="text-code-purple">extern</span> <span class="text-code-purple">crate</span> <span class="">lazy_static</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-purple">mod</span> <span class="">config</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">config<span class="text-code-white">::</span></span><span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">true</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">false</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>config.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>sync<span class="text-code-white">::</span></span><span class="">RwLock</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">#[derive(Debug)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">lazy_static!</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">ref</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">RwLock</span><span class="">&lt;</span><span class="">MyConfig</span><span class="">&gt;</span> <span class="">=</span> <span class="">RwLock</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">init</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="text-code-purple">bool</span><span class="">&gt;</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">Result</span><span class="">&lt;</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="text-code-purple">i32</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">let</span> <span class="text-code-purple">mut</span> w <span class="">=</span> <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">write</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="text-code-purple">match</span> custom_debug <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="">Some</span><span class="text-code-white">(</span>debug_value<span class="text-code-white">)</span> <span class="">=&gt;</span> <span class="">*</span>w <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> debug_value <span class="text-code-white">}</span><span class="text-code-white">,</span>
</span><span class="code-line">            <span class="">None</span> <span class="">=&gt;</span> <span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span>
</span><span class="code-line">        <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="">Ok</span><span class="text-code-white">(</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">let</span> m <span class="">=</span> <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">read</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="">dbg!</span><span class="text-code-white">(</span>m<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>This program requires <code>lazy_static</code> as a dependency. If we <code>cargo run</code> it, we will get the following output.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line"><span class="text-code-white">[</span>src/config.rs:26<span class="text-code-white">]</span> m <span class="">=</span> RwLockReadGuard <span class="text-code-white">{</span>
</span><span class="code-line">    lock: RwLock <span class="text-code-white">{</span>
</span><span class="code-line">        data: MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">            debug: false,
</span><span class="code-line">        <span class="text-code-white">}</span>,
</span><span class="code-line">    <span class="text-code-white">}</span>,
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">[</span>src/config.rs:26<span class="text-code-white">]</span> m <span class="">=</span> RwLockReadGuard <span class="text-code-white">{</span>
</span><span class="code-line">    lock: RwLock <span class="text-code-white">{</span>
</span><span class="code-line">        data: MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">            debug: true,
</span><span class="code-line">        <span class="text-code-white">}</span>,
</span><span class="code-line">    <span class="text-code-white">}</span>,
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">[</span>src/config.rs:26<span class="text-code-white">]</span> m <span class="">=</span> RwLockReadGuard <span class="text-code-white">{</span>
</span><span class="code-line">    lock: RwLock <span class="text-code-white">{</span>
</span><span class="code-line">        data: MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">            debug: false,
</span><span class="code-line">        <span class="text-code-white">}</span>,
</span><span class="code-line">    <span class="text-code-white">}</span>,
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Looks good? We have a static global variable <code>CONFIG</code>. Inside this global variable is a <code>RwLock&lt;MyConfig&gt;</code> object. We can mutate the inside of the <code>RwLock</code> by using the <code>write</code> function. We do this in the <code>init</code> function of <code>MyConfig</code>; and we can also pass variables.</p>
<p>So everything is good, right? Well, kind of. You might have noticed that we are not returning the <code>CONFIG</code> struct or a reference to it. Instead, we are displaying the content inside the function itself. But that might not be what you want, you might want to access the values from another place and access it directly.</p>
<p>We can try that but let&#x27;s first understand what <code>CONFIG.read().unwrap()</code> is returning. Using the <code>dbg!</code> command, we are getting the following.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line"><span class="text-code-white">[</span>src/config.rs:26<span class="text-code-white">]</span> m <span class="">=</span> RwLockReadGuard <span class="text-code-white">{</span>
</span><span class="code-line">    lock: RwLock <span class="text-code-white">{</span>
</span><span class="code-line">        data: MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">            debug: false,
</span><span class="code-line">        <span class="text-code-white">}</span>,
</span><span class="code-line">    <span class="text-code-white">}</span>,
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>So it is not our <code>MyConfig</code>. Or, it is our <code>MyConfig</code> but wrapped inside another structure of the type <code>RwLockReadGuard</code> and stored two levels deep (<code>lock</code> and <code>data</code> fields). The documentation for it is the following.</p>
<blockquote>
<p>RAII structure used to release the shared read access of a lock when dropped.</p>
</blockquote>
<blockquote>
<p>This structure is created by the read and try_read methods on RwLock.</p>
</blockquote>
<p>That&#x27;s more gibberish. What is <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a>?</p>
<blockquote>
<p>Resource acquisition is initialization (RAII)[1] is a programming idiom[2] used in several object-oriented languages to describe a particular language behavior. In RAII, holding a resource is a class invariant, and is tied to object lifetime: resource allocation (or acquisition) is done during object creation (specifically initialization), by the constructor, while resource deallocation (release) is done during object destruction (specifically finalization), by the destructor.</p>
</blockquote>
<p>There is another <a target="_blank" rel="noopener noreferrer" href="https://www.toptal.com/software/eliminating-garbage-collector">article</a> that has another definition.</p>
<blockquote>
<p>All that manual management was unpleasant, to say the least. In the mid-80s, Bjarne Stroustrup invented a new paradigm for his brand-new language, C++. He called it Resource Acquisition Is Initialization, and the fundamental insights were the following: objects can be specified to have constructors and destructors which are called automatically at appropriate times by the compiler, this provides a much more convenient way to manage the memory a given object requires, and the technique is also useful for resources which are not memory.</p>
</blockquote>
<p>So that&#x27;s good. But isn&#x27;t everything in Rust a RAII structure and what does it mean for our <code>RwLockReadGuard</code>? To see how this unfolds, let&#x27;s try returning our <code>RwLockReadGuard</code>. We will have to unlock every time we want to access the data but there is a price for everything, right?</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[macro_use]</span>
</span><span class="code-line"><span class="text-code-purple">extern</span> <span class="text-code-purple">crate</span> <span class="">lazy_static</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-purple">mod</span> <span class="">config</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">config<span class="text-code-white">::</span></span><span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-gray-400 italic">// Initialize the configuration</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">true</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Return &#x27;RwLockReadGuard&#x27;</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> a <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Display &#x27;MyConfig&#x27;</span>
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span><span class="">&amp;</span><span class="">*</span>a<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>config.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>sync<span class="text-code-white">::</span></span><span class="">RwLock</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>sync<span class="text-code-white">::</span></span><span class="">RwLockReadGuard</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">#[derive(Debug)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">lazy_static!</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">ref</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">RwLock</span><span class="">&lt;</span><span class="">MyConfig</span><span class="">&gt;</span> <span class="">=</span> <span class="">RwLock</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span> <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">init</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="text-code-purple">bool</span><span class="">&gt;</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">Result</span><span class="">&lt;</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="text-code-purple">i32</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="text-code-purple">let</span> <span class="text-code-purple">mut</span> w <span class="">=</span> <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">write</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="text-code-purple">match</span> custom_debug <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="">Some</span><span class="text-code-white">(</span>debug_value<span class="text-code-white">)</span> <span class="">=&gt;</span> <span class="">*</span>w <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> debug_value <span class="text-code-white">}</span><span class="text-code-white">,</span>
</span><span class="code-line">            <span class="">None</span> <span class="">=&gt;</span> <span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span>
</span><span class="code-line">        <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="">Ok</span><span class="text-code-white">(</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">RwLockReadGuard</span><span class="">&lt;</span><span class="">&#x27;static</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">let</span> m<span class="text-code-white">:</span> <span class="">RwLockReadGuard</span><span class="">&lt;</span><span class="">&#x27;static</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="">&gt;</span> <span class="">=</span> <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">read</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        m
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Run the following and we will get.</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line"><span class="text-code-white">[</span>src/main.rs:15<span class="text-code-white">]</span> <span class="">&amp;</span>*a <span class="">=</span> MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">    debug: true,
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>So that&#x27;s perfect, right? Let&#x27;s try to re-initialize our configuration struct.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[macro_use]</span>
</span><span class="code-line"><span class="text-code-purple">extern</span> <span class="text-code-purple">crate</span> <span class="">lazy_static</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-purple">mod</span> <span class="">config</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">config<span class="text-code-white">::</span></span><span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-gray-400 italic">// Initialize the configuration</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">true</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Return &#x27;RwLockReadGuard&#x27;</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> a <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Display &#x27;MyConfig&#x27;</span>
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span><span class="">&amp;</span><span class="">*</span>a<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Reinit MyConfig</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">false</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Return &#x27;RwLockReadGuard&#x27;</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> b <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Display &#x27;MyConfig&#x27;</span>
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span><span class="">&amp;</span><span class="">*</span>b<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Output</p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line"><span class="text-code-white">[</span>src/main.rs:15<span class="text-code-white">]</span> <span class="">&amp;</span>*a <span class="">=</span> MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">    debug: true,
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Hmm, not exactly the output we expect. Wait! The program didn&#x27;t quit. It is stuck there!</p>
<p>We tried to cheat our way out of this complexity by plowing through the different types and trying different things. But, obviously, we hit another roadblock. It&#x27;d be better to get an understanding of why our program suddenly halted and never returned. It is like our program is stuck in an infinite loop but there is no loop in our code. Or is there?</p>
<hr/>
<p>Remind me again: <em>Why are we here</em>?</p>
<p>Why are we going through all of this complexity? What is exactly wrong with simple <code>unsafe</code> code. Well, to understand that, you might need to witness the dangers of <code>unsafe</code> code in real life.</p>
<p>First, let&#x27;s remember that our problem only exists if we are working on multiple threads. This means multiple cores. Let&#x27;s look at this video from a Udacity online MOOC (<a target="_blank" rel="noopener noreferrer" href="https://www.udacity.com/course/high-performance-computer-architecture--ud007">High Performance Computer Architecture</a>). I would recommend you take the whole course later as it goes deeper on other related topics; but for now this video will do it.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=BMkW9Iwh80E"><img src="http://img.youtube.com/vi/BMkW9Iwh80E/0.jpg" alt="Synchronization Example"/></a></p>
<p>In a nutshell, our problem is due to the fact that two processes trying to access the same memory location (or variable) at the same time can result in a conflict. To ensure consistency, the processor has a set of operations named <em>atomic operations</em> that can guarantee the linearizability of execution. That&#x27;s why using <code>unsafe</code> code with <code>Once</code> is safe: <code>Once</code> ensures that our operation is linear.</p>
<p>Also, what are atomic operations? Amdan from Stackoverflow has a rather useful <a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/a/52196874/12637">explanation</a>. Basically, atomic operations are operations that don&#x27;t suffer from this conflict. They are executed by the processor directly. That might help explaining some of the gibberish above in the <code>RwLock</code> definition above.</p>
<p>Okay, let&#x27;s try a couple examples (actually three) and see why unsafe code can give inaccurate results or worse.</p>
<p>In the first example, we show how to use multi-threading by executing two threads together. This example is not related to the configuration code, so we can (and probably should) execute it in a different program.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span></span>thread<span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-gray-400 italic">// Executes Thread 1</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> thread1 <span class="">=</span> <span class="">thread<span class="text-code-white">::</span></span><span class="text-code-blue">spawn</span><span class="text-code-white">(</span><span class=""><span class="">|</span><span class="">|</span></span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">for</span> i <span class="text-code-purple">in</span> <span class="">1</span><span class="text-code-white">..</span><span class="">100</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Thread 1&quot;</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Executes Thread 2</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> thread2 <span class="">=</span> <span class="">thread<span class="text-code-white">::</span></span><span class="text-code-blue">spawn</span><span class="text-code-white">(</span><span class=""><span class="">|</span><span class="">|</span></span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">for</span> i <span class="text-code-purple">in</span> <span class="">1</span><span class="text-code-white">..</span><span class="">100</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Thread 2&quot;</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Makes sure our threads have executed and returned</span>
</span><span class="code-line">    thread1<span class="text-code-white">.</span><span class="text-code-blue">join</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    thread2<span class="text-code-white">.</span><span class="text-code-blue">join</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Execution completed&quot;</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>output</code></p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line"><span class="text-code-white">..</span>.
</span><span class="code-line">Thread <span class="">2</span>
</span><span class="code-line">Thread <span class="">2</span>
</span><span class="code-line">Thread <span class="">2</span>
</span><span class="code-line">Thread <span class="">1</span>
</span><span class="code-line">Thread <span class="">1</span>
</span><span class="code-line">Thread <span class="">1</span>
</span><span class="code-line"><span class="text-code-white">..</span>.
</span><span class="code-line">Thread <span class="">2</span>
</span><span class="code-line">Thread <span class="">2</span>
</span><span class="code-line">Execution completed
</span></code></pre></div>
<p>What our program does is launch two threads. Each thread is going to write to the terminal. Thread 1 will write &quot;Thread 1&quot; and Thread 2 will write &quot;Thread 2&quot;. Since our threads are executing at the same time, we get a mix of these two lines; and it is not predictable which will happen first.</p>
<p>You might notice here that we are using a new weird sign <code>||</code>. That denotes a closure. A <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/rust-by-example/fn/closures.html">closure</a> is very similar to an anonymous function with the benefit that it can capture variables from its environment. There are various articles about Rust closures but, for now, if you stick to the idea that they are anonymous functions, then that&#x27;s enough.</p>
<p>It is important to highlight that these threads are independent from our main thread or program. While these threads start executing as soon as we spawn them, they might not finish before our program exits. So we must force them to finish execution before our program exits with the <code>join</code> function.</p>
<p>Now that we are comfortable running multiple threads, let&#x27;s do more: Create a global variable and modify it from both threads. This might seem harmless but it is not something that Rust will allow <em>safely</em> without jumping through hoops. So let&#x27;s start with the simple and direct approach: Unsafe code. We will declare a global mutable variable, and then mutate it from inside each thread. The variable is a 32-bit integer and from inside the threads we will loop and increment this integer.</p>
<p>Same as before, this example can run on its own.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span></span>thread<span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">mut</span> <span class="">INC</span><span class="text-code-white">:</span> <span class="text-code-purple">i32</span> <span class="">=</span> <span class="">0</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> thread1 <span class="">=</span> <span class="">thread<span class="text-code-white">::</span></span><span class="text-code-blue">spawn</span><span class="text-code-white">(</span><span class=""><span class="">|</span><span class="">|</span></span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">for</span> i <span class="text-code-purple">in</span> <span class="">1</span><span class="text-code-white">..</span><span class="">1000</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="text-code-purple">unsafe</span> <span class="text-code-white">{</span>
</span><span class="code-line">                <span class="">INC</span> <span class="">=</span> <span class="">INC</span> <span class="">+</span> <span class="">1</span><span class="text-code-white">;</span>
</span><span class="code-line">            <span class="text-code-white">}</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">let</span> thread2 <span class="">=</span> <span class="">thread<span class="text-code-white">::</span></span><span class="text-code-blue">spawn</span><span class="text-code-white">(</span><span class=""><span class="">|</span><span class="">|</span></span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">for</span> i <span class="text-code-purple">in</span> <span class="">1</span><span class="text-code-white">..</span><span class="">1000</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="text-code-purple">unsafe</span> <span class="text-code-white">{</span>
</span><span class="code-line">                <span class="">INC</span> <span class="">=</span> <span class="">INC</span> <span class="">+</span> <span class="">1</span><span class="text-code-white">;</span>
</span><span class="code-line">            <span class="text-code-white">}</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    thread1<span class="text-code-white">.</span><span class="text-code-blue">join</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    thread2<span class="text-code-white">.</span><span class="text-code-blue">join</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">unsafe</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;{}&quot;</span><span class="text-code-white">,</span> <span class="">INC</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>Alright, let&#x27;s execute our program. We do 999 iteration in each thread, so we expect our integer to have the value of 1998.</p>
<p>First execution.</p>
<p><code>output</code></p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">1254
</span></code></pre></div>
<p>Hmm. That&#x27;s not our expectation, let&#x27;s try again.</p>
<p><code>output</code></p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">1443
</span></code></pre></div>
<p>Cool. We made a random number generator! (Slightly joking; it would be interesting to study how random these numbers are, though).</p>
<p>But why are our results not consistent? Well, it is the synchronization issue. The two threads are not synchronized and in multiple occasions (more than enough), they increment the value at the <em>exact</em> same time. When that happens, the value is only incremented once.</p>
<p>So how do we fix this problem? Well, this is exactly why the Rust team came up with the synchronization primitives.</p>
<p>Let&#x27;s try to use <code>RwLock</code> now.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[macro_use]</span>
</span><span class="code-line"><span class="text-code-purple">extern</span> <span class="text-code-purple">crate</span> <span class="">lazy_static</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span></span>thread<span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>sync<span class="text-code-white">::</span></span><span class="">RwLock</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">lazy_static!</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">ref</span> <span class="">INC</span><span class="text-code-white">:</span> <span class="">RwLock</span><span class="">&lt;</span><span class="text-code-purple">i32</span><span class="">&gt;</span> <span class="">=</span> <span class="">RwLock</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="">0</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> thread1 <span class="">=</span> <span class="">thread<span class="text-code-white">::</span></span><span class="text-code-blue">spawn</span><span class="text-code-white">(</span><span class=""><span class="">|</span><span class="">|</span></span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">for</span> i <span class="text-code-purple">in</span> <span class="">1</span><span class="text-code-white">..</span><span class="">1000</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="text-code-purple">let</span> <span class="text-code-purple">mut</span> w <span class="">=</span> <span class="">INC</span><span class="text-code-white">.</span><span class="text-code-blue">write</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">            <span class="">*</span>w <span class="">=</span> <span class="">*</span>w <span class="">+</span> <span class="">1</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">let</span> thread2 <span class="">=</span> <span class="">thread<span class="text-code-white">::</span></span><span class="text-code-blue">spawn</span><span class="text-code-white">(</span><span class=""><span class="">|</span><span class="">|</span></span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">for</span> i <span class="text-code-purple">in</span> <span class="">1</span><span class="text-code-white">..</span><span class="">1000</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="text-code-purple">let</span> <span class="text-code-purple">mut</span> w <span class="">=</span> <span class="">INC</span><span class="text-code-white">.</span><span class="text-code-blue">write</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">            <span class="">*</span>w <span class="">=</span> <span class="">*</span>w <span class="">+</span> <span class="">1</span><span class="text-code-white">;</span>
</span><span class="code-line">        <span class="text-code-white">}</span>
</span><span class="code-line">    <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    thread1<span class="text-code-white">.</span><span class="text-code-blue">join</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    thread2<span class="text-code-white">.</span><span class="text-code-blue">join</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">let</span> r <span class="">=</span> <span class="">INC</span><span class="text-code-white">.</span><span class="text-code-blue">read</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">println!</span><span class="text-code-white">(</span><span class="text-code-green">&quot;{}&quot;</span><span class="text-code-white">,</span> <span class="">*</span>r<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>output</code></p>
<div class="relative"><pre><code class="code-highlight"><span class="code-line">1998
</span></code></pre></div>
<p>Instead of mutating the global variable directly, we are mutating our type through <code>RwLock</code>. <code>RwLock</code> ensures that we are using atomic operations. If one thread is incrementing the variable, the other thread has to wait. You should have already noticed the name of <code>RwLock</code>. It is a lock. Go again through the definition and you might understand it more stuff now. That&#x27;s why in the previous <code>RwLock</code> example our program was stuck. It was waiting for <code>RwLock</code> to be unlocked so that it can access it again.</p>
<p>Alright, let&#x27;s make use of this knowledge and implement our final solution. For the fun of it, we are going to add a <code>String</code> field. Because, you know, bureaucracy!</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[macro_use]</span>
</span><span class="code-line"><span class="text-code-purple">extern</span> <span class="text-code-purple">crate</span> <span class="">lazy_static</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">mod</span> <span class="">config</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">config<span class="text-code-white">::</span></span><span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>ops<span class="text-code-white">::</span></span><span class="">Deref</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-gray-400 italic">// First, we get an RwLockReadGuard</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> guard <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Next, we deref the guard and get MyConfig</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> config <span class="">=</span> guard<span class="text-code-white">.</span><span class="text-code-blue">deref</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Freely access MyConfig by borrowing it</span>
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span><span class="">&amp;</span>config<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span><span class="">&amp;</span>config<span class="text-code-white">.</span>info<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// We drop the guard and unlock the RwLock</span>
</span><span class="code-line">    <span class="text-code-blue">drop</span><span class="text-code-white">(</span>guard<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Re-initialize our configuration</span>
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">true</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="">Some</span><span class="text-code-white">(</span><span class="">String</span><span class="text-code-white">::</span><span class="text-code-blue">from</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Updated&quot;</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-gray-400 italic">// Go through the same process again</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> guard <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">let</span> config <span class="">=</span> guard<span class="text-code-white">.</span><span class="text-code-blue">deref</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span><span class="">&amp;</span>config<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span><span class="">&amp;</span>config<span class="text-code-white">.</span>info<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-blue">drop</span><span class="text-code-white">(</span>guard<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>config.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>sync<span class="text-code-white">::</span></span><span class="">RwLock</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>sync<span class="text-code-white">::</span></span><span class="">RwLockReadGuard</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">#[derive(Debug)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> info<span class="text-code-white">:</span> <span class="">String</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">lazy_static!</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">ref</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">RwLock</span><span class="">&lt;</span><span class="">MyConfig</span><span class="">&gt;</span> <span class="">=</span> <span class="">RwLock</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span><span class="text-code-white">,</span> info<span class="text-code-white">:</span> <span class="">String</span><span class="text-code-white">::</span><span class="text-code-blue">from</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Some info&quot;</span><span class="text-code-white">)</span> <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">init</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="text-code-purple">bool</span><span class="">&gt;</span><span class="text-code-white">,</span> custom_info<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="">String</span><span class="">&gt;</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">Result</span><span class="">&lt;</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="text-code-purple">i32</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">let</span> <span class="text-code-purple">mut</span> w <span class="">=</span> <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">write</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="text-code-purple">match</span> <span class="text-code-white">(</span>custom_debug <span class="text-code-white">,</span> custom_info<span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span>debug_value<span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="">Some</span><span class="text-code-white">(</span>custom_info<span class="text-code-white">)</span><span class="text-code-white">)</span> <span class="">=&gt;</span> <span class="">*</span>w <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> debug_value<span class="text-code-white">,</span> info<span class="text-code-white">:</span> custom_info<span class="text-code-white">}</span><span class="text-code-white">,</span>
</span><span class="code-line">            _ <span class="">=&gt;</span> <span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span>
</span><span class="code-line">        <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="">Ok</span><span class="text-code-white">(</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">RwLockReadGuard</span><span class="">&lt;</span><span class="">&#x27;static</span><span class="text-code-white">,</span> <span class="">MyConfig</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">let</span> m <span class="">=</span> <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">read</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        m
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>output</code></p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line"><span class="text-code-white">[</span>src/main.rs:17<span class="text-code-white">]</span> <span class="">&amp;</span>config <span class="">=</span> MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">    debug: false,
</span><span class="code-line">    info: <span class="text-code-green">&quot;Some info&quot;</span>,
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">[</span>src/main.rs:18<span class="text-code-white">]</span> <span class="">&amp;</span>config.info <span class="">=</span> <span class="text-code-green">&quot;Some info&quot;</span>
</span><span class="code-line"><span class="text-code-white">[</span>src/main.rs:32<span class="text-code-white">]</span> <span class="">&amp;</span>config <span class="">=</span> MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">    debug: true,
</span><span class="code-line">    info: <span class="text-code-green">&quot;Updated&quot;</span>,
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">[</span>src/main.rs:33<span class="text-code-white">]</span> <span class="">&amp;</span>config.info <span class="">=</span> <span class="text-code-green">&quot;Updated&quot;</span>
</span></code></pre></div>
<p>Hooray! This works! It is a pain in the <strong>_ but it serves our purposes, and it is safe. That should be everything Rust stands for (At least, I&#x27;m certain of the pain in the _</strong> part)!</p>
<p>Alright, could this be simpler? We promised above to cover the <code>Copy</code> and <code>Clone</code> keywords, and this is the part where we do. Remember the Ownership/Borrowing concept we talked above at first? That you can&#x27;t take something you don&#x27;t own but you can borrow it? But what if you were able to <em>clone</em> it. Well, that makes you able to return the actual type.</p>
<p>There are types that don&#x27;t <em>derive</em> Copy. We won&#x27;t go into the details of why and how. Partly because we have already covered a lot on this topic but also because there are lots of good resources on this. The Rust Programming Language book does a good job on that: <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html">What is ownership</a></p>
<p>Let&#x27;s see how this would work.</p>
<p><code>main.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="">#[macro_use]</span>
</span><span class="code-line"><span class="text-code-purple">extern</span> <span class="text-code-purple">crate</span> <span class="">lazy_static</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">mod</span> <span class="">config</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">use</span> <span class="">config<span class="text-code-white">::</span></span><span class="">MyConfig</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">fn</span> <span class="">main</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">let</span> a <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span>a<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">init</span><span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span><span class="text-code-red">true</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="">Some</span><span class="text-code-white">(</span><span class="text-code-green">&quot;Updated&quot;</span><span class="text-code-white">)</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">let</span> a <span class="">=</span> <span class="">MyConfig</span><span class="text-code-white">::</span><span class="text-code-blue">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="">dbg!</span><span class="text-code-white">(</span>a<span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>config.rs</code></p>
<div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="text-code-purple">use</span> <span class="">std<span class="text-code-white">::</span>sync<span class="text-code-white">::</span></span><span class="">RwLock</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">#[derive(Debug, Clone, Copy)]</span>
</span><span class="code-line"><span class="text-code-purple">pub</span> <span class="text-code-purple">struct</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> debug<span class="text-code-white">:</span> <span class="text-code-purple">bool</span><span class="text-code-white">,</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> info<span class="text-code-white">:</span> <span class="">&amp;</span><span class="">&#x27;static</span> <span class="text-code-purple">str</span><span class="text-code-white">,</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="">lazy_static!</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">static</span> <span class="text-code-purple">ref</span> <span class="">CONFIG</span><span class="text-code-white">:</span> <span class="">RwLock</span><span class="">&lt;</span><span class="">MyConfig</span><span class="">&gt;</span> <span class="">=</span> <span class="">RwLock</span><span class="text-code-white">::</span><span class="text-code-blue">new</span><span class="text-code-white">(</span><span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> <span class="text-code-red">false</span><span class="text-code-white">,</span> info<span class="text-code-white">:</span> <span class="text-code-green">&quot;Some info&quot;</span> <span class="text-code-white">}</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="text-code-purple">impl</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">init</span><span class="text-code-white">(</span>custom_debug<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="text-code-purple">bool</span><span class="">&gt;</span><span class="text-code-white">,</span> custom_info<span class="text-code-white">:</span> <span class="">Option</span><span class="">&lt;</span><span class="">&amp;</span><span class="">&#x27;static</span> <span class="text-code-purple">str</span><span class="">&gt;</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">Result</span><span class="">&lt;</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="text-code-purple">i32</span><span class="">&gt;</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">let</span> <span class="text-code-purple">mut</span> w <span class="">=</span> <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">write</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="text-code-purple">match</span> <span class="text-code-white">(</span>custom_debug <span class="text-code-white">,</span> custom_info<span class="text-code-white">)</span> <span class="text-code-white">{</span>
</span><span class="code-line">            <span class="text-code-white">(</span><span class="">Some</span><span class="text-code-white">(</span>debug_value<span class="text-code-white">)</span><span class="text-code-white">,</span> <span class="">Some</span><span class="text-code-white">(</span>custom_info<span class="text-code-white">)</span><span class="text-code-white">)</span> <span class="">=&gt;</span> <span class="">*</span>w <span class="">=</span> <span class="">MyConfig</span> <span class="text-code-white">{</span> debug<span class="text-code-white">:</span> debug_value<span class="text-code-white">,</span> info<span class="text-code-white">:</span> custom_info<span class="text-code-white">}</span><span class="text-code-white">,</span>
</span><span class="code-line">            _ <span class="">=&gt;</span> <span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">,</span>
</span><span class="code-line">        <span class="text-code-white">}</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="">Ok</span><span class="text-code-white">(</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">)</span>
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="text-code-purple">pub</span> <span class="text-code-purple">fn</span> <span class="">global_config</span><span class="text-code-white">(</span><span class="text-code-white">)</span> <span class="text-code-white">-&gt;</span> <span class="">MyConfig</span> <span class="text-code-white">{</span>
</span><span class="code-line">        <span class="text-code-purple">let</span> m <span class="">=</span> <span class="">CONFIG</span><span class="text-code-white">.</span><span class="text-code-blue">read</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">.</span><span class="text-code-blue">unwrap</span><span class="text-code-white">(</span><span class="text-code-white">)</span><span class="text-code-white">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="text-gray-400 italic">// This doesn&#x27;t return *m but a copy of it</span>
</span><span class="code-line">        <span class="">*</span>m
</span><span class="code-line">    <span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p><code>output</code></p>
<div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line"><span class="text-code-white">[</span>src/main.rs:11<span class="text-code-white">]</span> a <span class="">=</span> MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">    debug: false,
</span><span class="code-line">    info: <span class="text-code-green">&quot;Some info&quot;</span>,
</span><span class="code-line"><span class="text-code-white">}</span>
</span><span class="code-line"><span class="text-code-white">[</span>src/main.rs:17<span class="text-code-white">]</span> a <span class="">=</span> MyConfig <span class="text-code-white">{</span>
</span><span class="code-line">    debug: true,
</span><span class="code-line">    info: <span class="text-code-green">&quot;Updated&quot;</span>,
</span><span class="code-line"><span class="text-code-white">}</span>
</span></code></pre></div>
<p>That&#x27;s convenient but you have to keep in mind that we are returning copies of the configuration and not the actual configuration.</p>
<hr/>
<p>I hope this introduction to Rust wasn&#x27;t overwhelming.</p></div></div><div class="text-sm font-medium leading-5 xl:col-start-1 xl:row-start-2"><dl class="py-4 space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-s font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2019-10-10T00:00:00.000Z">Thursday, October 10, 2019</time></dd></div></dl><div class="py-4"><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/rust/">Rust</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/programming/">Programming</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8"><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/vim/">The VIM Experience</a></div></div><div><h2 class="text-xs tracking-wide text-gray-500 uppercase dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/rust-2020/">Rust 2020: A better ecosystem</a></div></div></div><div class="py-4"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/archive/">← Back to the archive</a></div></div></div></div></article></div></main></div><footer><div class="flex flex-col items-center mt-16"><div class="flex mb-3 space-x-4"></div><div class="flex mb-2 space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Abid Omar</div><div> • </div><div>© 2021</div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var h=Object.create;var l=Object.defineProperty;var r=Object.getOwnPropertyDescriptor;var o=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=s=\u003el(s,\"__esModule\",{value:!0});var N=(s,e)=\u003e()=\u003e(e||s((e={exports:{}}).exports,e),e.exports),w=(s,e)=\u003e{i(s);for(var c in e)l(s,c,{get:e[c],enumerable:!0})},u=(s,e,c)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let n of o(e))!m.call(s,n)\u0026\u0026n!==\"default\"\u0026\u0026l(s,n,{get:()=\u003ee[n],enumerable:!(c=r(e,n))||c.enumerable});return s},x=s=\u003eu(i(l(s!=null?h(p(s)):{},\"default\",s\u0026\u0026s.__esModule\u0026\u0026\"default\"in s?{get:()=\u003es.default,enumerable:!0}:{value:s,enumerable:!0})),s);var d=N((C,t)=\u003e{t.exports=_jsx_runtime});var y={};w(y,{default:()=\u003eb,frontmatter:()=\u003eg});var a=x(d()),g={title:\"A brief introduction to Rust\",date:\"2019-10-10\",tags:[\"Rust\",\"Programming\"],draft:!1,summary:\"A brief introduction to Rust\",images:[],layout:\"PostLayout\"};function f(s){let e=Object.assign({p:\"p\",hr:\"hr\",em:\"em\",code:\"code\",a:\"a\",pre:\"pre\",span:\"span\",blockquote:\"blockquote\",ul:\"ul\",li:\"li\",img:\"img\",strong:\"strong\"},s.components),{wrapper:c}=e,n=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:\"This blog post will take a deep dive into the Rust world of mutability. By deep dive, it means the blog post is considerably long. So it will take time to go through the different examples. The topic we will dive through is specific but we will have to go through various Rust concepts: Ownership/Borrowing, Lifetimes, Unsafe, Sync, Closures, Macros and more. This might be intimidating and I think this is where many developers are put off.\"}),`\n`,(0,a.jsx)(e.p,{children:'This article assumes some familiarity with Rust; that is if you have successfully run a \"Hello World\" program, then you are qualified! If you have struggled with some of the hard concepts then this article could be a good introduction. It will not go deep for each one of these but will give you enough knowledge to help you understand the bigger picture.'}),`\n`,(0,a.jsx)(e.hr,{}),`\n`,(0,a.jsxs)(e.p,{children:[\"We will start from a \",(0,a.jsx)(e.em,{children:\"reasonably\"}),\" easy problem: We want to access a particular variable from any location in our program; by access, I mean both read and write access. That might seem like a straightforward thing to do, especially if you are coming from other languages like JavaScript. If we have a variable (and the browser is our sandbox), then we can make it global by attaching it to the \",(0,a.jsx)(e.code,{children:\"window\"}),\" object. So if we have \",(0,a.jsx)(e.code,{children:\"window.config\"}),\", we can access (both read and write) the \",(0,a.jsx)(e.code,{children:\"config\"}),\" variable from anywhere in our code.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"So our problem is we have this \",(0,a.jsx)(e.code,{children:\"config\"}),\" object but in Rust. The configuration object is a \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/rust-by-example/custom_types/structs.html\",children:\"struct\"}),\". It can be set and initialized somewhere in our program. The initialization bit is important as we will find out later. Our configuration could be simple default values set in the code, and updated later; or it could require reading files, exchanging data over the network, etc. So we want to be sure that we can do both.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"We have other requirements and although most of the use cases don't need these niceties, it is better to have them for the future (And these are the kind of problems that Rust is intended to solve). Like, for example, our program might also become multithreaded in the future, as we anticipate more cores in the CPU and less improvement in the clock rate.\"}),`\n`,(0,a.jsx)(e.p,{children:\"Things are already starting to confuse; so how about we start with a simple example and the most basic implementation of a configuration struct.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Hello, world!\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Debugging value: {}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Rechecking Debugging value: {}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"output\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Hello, world\",(0,a.jsx)(e.span,{className:\"\",children:\"!\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Debugging value: \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Rechecking Debugging value: \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Pretty simple: We use a function named \",(0,a.jsx)(e.code,{children:\"config\"}),\" to return an instance of our configuration. Inside \",(0,a.jsx)(e.code,{children:\"config\"}),\", we make a new \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\" instance for each call and then return it. (We could have placed this code in a different file and called it with \",(0,a.jsx)(e.code,{children:\"mod filename\"}),\"; we are going to do that later, so don't worry!).\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"So far so good. But there is a small issue here: Every time we call the \",(0,a.jsx)(e.code,{children:\"config\"}),\" function, we return a \",(0,a.jsx)(e.em,{children:\"new\"}),\" instance of \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\". Practically speaking, it is the \",(0,a.jsx)(e.em,{children:\"same\"}),\" configuration; but technically speaking, it is a \",(0,a.jsx)(e.em,{children:\"different\"}),\" object. Imagine, for instance, that our \",(0,a.jsx)(e.code,{children:\"config\"}),\" function was querying a database for a particular field. The \",(0,a.jsx)(e.code,{children:\"config\"}),\" function will be doing the query every time we call it. This is not good; after all we should only do it one time both for efficiency and consistency.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"What we want is a single initialization of our configuration. That initialization is safeguarded somewhere, and then we access it as many times as we want. Basically, a global variable accessible from the \",(0,a.jsx)(e.code,{children:\"config\"}),\" function or any other location in our program.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"This time, we will separate our program into two files: \",(0,a.jsx)(e.code,{children:\"main.rs\"}),\" and \",(0,a.jsx)(e.code,{children:\"config.rs\"}),\". The code could function from within \",(0,a.jsx)(e.code,{children:\"main.rs\"}),\" but the separation of concerns is helpful.\"]}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mod\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Hello, world!\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Debug: {}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Rechecking Debug: {}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"config.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Alright, a lot is going on here; especially if you are both new to and confused by the Rust syntax. But don't worry, we will explain it in details. First, we are still using a function to return our configuration; but this time it is attached to the \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\" struct. Think of a Rust struct like a JavaScript object or in OOP languages like a class where you can add both fields and methods to your struct. The method that returns our configuration is \",(0,a.jsx)(e.code,{children:\"global_config\"}),\".\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Let's go back further, this line deserves some explanation.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"language-rust code-highlight\",children:(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]})})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Creating a \",(0,a.jsx)(e.em,{children:\"global variable\"}),\" in Rust is pretty easy. We just use the \",(0,a.jsx)(e.code,{children:\"static\"}),\" keyword. Now, our variable \",(0,a.jsx)(e.em,{children:\"can be\"}),\" available anywhere in our program. In fact, this is what the rust-lang documentation says about the \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/rust-by-example/scope/lifetime/static_lifetime.html\",children:\"static\"}),\" keyword:\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"A 'static lifetime is the longest possible lifetime, and lasts for the lifetime of the running program.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Okay, that was a trap. What is a \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/rust-by-example/scope/lifetime.html\",children:\"lifetime\"}),\"? Well, you can go with the raw and naive definition: How long you will live. But that definition doesn't seem about our \",(0,a.jsx)(e.code,{children:\"static\"}),\" keyword, or is it? It is also way too simplistic. The rust-lang website will already throw words like \",(0,a.jsx)(e.em,{children:\"borrow checker\"}),\" at you. That's scary, so how about we stick to the raw definition for now: How long the variable will live.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"So what's \",(0,a.jsx)(e.code,{children:\"'static\"}),\"? It is the longest lifetime; which means the entirety of our program. It means our variable will be \",(0,a.jsx)(e.em,{children:\"alive\"}),\" and accessible as long as our program is running. The \",(0,a.jsx)(e.code,{children:\"static\"}),\" keyword doesn't mean our variable is a \",(0,a.jsx)(e.em,{children:\"constant\"}),\" but just that it has a \",(0,a.jsx)(e.code,{children:\"'static\"}),\" lifetime. A better word is \",(0,a.jsx)(e.em,{children:\"immortal\"}),\" but that doesn't sound geeky and cryptic enough and hence the choice of \",(0,a.jsx)(e.code,{children:\"'static\"}),\". If you are still confused, notice that \",(0,a.jsx)(e.code,{children:\"'static\"}),\" is the name of the lifetime while \",(0,a.jsx)(e.code,{children:\"static\"}),\" is a keyword that gives our variable a \",(0,a.jsx)(e.code,{children:\"'static\"}),\" lifetime.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Our configuration is initialized once and we declare a global variable named \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\". To access it, we use the function \",(0,a.jsx)(e.code,{children:\"global_config\"}),\" implemented in our struct; but since it is a global variable we could access it from anywhere really.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Let's dissect the \",(0,a.jsx)(e.code,{children:\"global_config\"}),\" function. If you are new to Rust, you might have already noticed the gibberish in that function. We are not returning \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\" in the function signature but adding a bunch of keywords; something must be going on.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"To understand what is going on, you might need to understand the Rust Ownership/Borrowing model. Don't worry, we will stick to the naive definition: You can't take/move what you don't own, but you can borrow it. You can't make changes on what you borrow unless you request permissions; and even then you are going to have to follow some rules.\"}),`\n`,(0,a.jsx)(e.p,{children:\"So let's test the constitution. If you run this line inside the main function.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"language-rust code-highlight\",children:(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" myconfig\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]})})}),`\n`,(0,a.jsx)(e.p,{children:\"On execution, we are going to get the following error.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"error\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),(0,a.jsx)(e.span,{className:\"\",children:\"E0507\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" cannot \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"move\"}),\" out of \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),` item\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,a.jsx)(e.span,{className:\"\",children:\"-\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" src\",(0,a.jsx)(e.span,{className:\"\",children:\"/\"}),\"main\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"rs\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),(0,a.jsx)(e.span,{className:\"\",children:\"9\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),(0,a.jsx)(e.span,{className:\"\",children:\"30\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"9\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"     \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" myconfig\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"                              \",(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),(0,a.jsx)(e.span,{className:\"\",children:\"^\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"                              \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"                              cannot \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"move\"}),\" out of \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),` item\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"                              help\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" consider borrowing here\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" `\",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),\"`\\n\"]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"We do not own \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\". The ruler, therefore, would not allow moving it but most importantly: There is no way around it. The ruler would also gives us a hint: consider borrowing.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Borrowing is actually pretty cool: We can access the object from where it is located; and that is basically it. But that serves our purposes, right? (Plus Rust doesn't charge us any interest!).\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"So this code is fine. (again we can run this code on \",(0,a.jsx)(e.code,{children:\"main.rs\"}),\")\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" myconfig\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"myconfig\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Notice that here we do neither own nor move \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\". We are barely \",(0,a.jsx)(e.em,{children:\"referencing\"}),\" it. The type of my \",(0,a.jsx)(e.code,{children:\"myconfig\"}),\" is \",(0,a.jsx)(e.code,{children:\"\u0026MyConfig\"}),\" and not \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\". A reference, and not the actual thing. To create a reference, we use an ampersand \",(0,a.jsx)(e.code,{children:\"\u0026\"}),\".\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"If you have been successfully following along, you almost did understand what the code in \",(0,a.jsx)(e.code,{children:\"global_config\"}),\" does. Except for one more sketchy keyword: \",(0,a.jsx)(e.code,{children:\"\u0026'static\"}),\". If we tried to return \",(0,a.jsx)(e.code,{children:\"\u0026MyConfig\"}),\" instead of \",(0,a.jsx)(e.code,{children:\"\u0026'static MyConfig\"}),\", we will get the following error.\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"error\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"E0106\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),`: missing lifetime specifier\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\" --\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),` src/config.rs:9:31\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"9\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"     pub fn global_config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" -\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"                               ^ help: consider giving it a \",(0,a.jsx)(e.span,{className:\"text-code-green\",children:\"'static lifetime: `\u0026'\"}),\"static`\\n\"]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" help: this function's \",(0,a.jsx)(e.span,{className:\"\",children:\"return\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"type\"}),\" contains a borrowed value, but there is no value \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),` it to be borrowed from\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"The ruler is asking for a lifetime to our reference. You might be wondering: Why, and what does that mean? And what does a reference mean in the first place?\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"The \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html\",children:\"Rust Programming Language book\"}),\" has a rather helpful definition.\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"These ampersands are references, and they allow you to refer to some value without taking ownership of it.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"The opposite of referencing by using \u0026 is dereferencing, which is accomplished with the dereference operator, *.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Okay, so referencing is actually \",(0,a.jsx)(e.em,{children:\"borrowing\"}),\". But what is a lifetime? \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/rust-by-example/scope/lifetime.html\",children:\"Rust By Example\"}),\" has an average explanation.\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"A lifetime is a construct the compiler (or more specifically, its borrow checker) uses to ensure all borrows are valid. Specifically, a variable's lifetime begins when it is created and ends when it is destroyed. While lifetimes and scopes are often referred to together, they are not the same.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"Take, for example, the case where we borrow a variable via \u0026. The borrow has a lifetime that is determined by where it is declared. As a result, the borrow is valid as long as it ends before the lender is destroyed. However, the scope of the borrow is determined by where the reference is used.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.p,{children:[\"What if \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\" is dropped from memory? Now, we know for certain that this will not happen because \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\" is \",(0,a.jsx)(e.em,{children:\"immortal\"}),\" but the compiler doesn't know that. In our signature, we are returning a reference to \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\" and not \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\"; so it is not clear how long the real object will live for. If that object is dropped, then our reference will fail. We need to ensure that our reference lives at most as the object it is \",(0,a.jsx)(e.em,{children:\"pointing\"}),\" at. Not more.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"In my opinion, the hard part about lifetimes is the unreadable gibberish that accompanies it. First, we need to define (or name) a lifetime. We do that before the function signature. We will make use of \",(0,a.jsx)(e.code,{children:\"\u003c,\u003e\"}),` and an apostrophe; that's pretty clean. To make it more confusing, let's name our lifetime \"a\" even though we can use a more meaningful names. If everybody on the community does that, it will greatly help beginners: They will think it is some sort of keyword out there. But as we will use it again in the returned value with an apostrophe, they will finally succumb and concede that it is pure wizardry.`]}),`\n`,(0,a.jsx)(e.p,{children:\"Look at this! This code actually runs!\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'a\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'a\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" myconfig \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),`myconfig\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Instead of defining a lifetime, we can assign the \",(0,a.jsx)(e.code,{children:\"'static\"}),\" lifetime. That makes sense since the item we are borrowing from has a \",(0,a.jsx)(e.code,{children:\"'static\"}),\" lifetime itself and should live for the entirety of the program. We don't need to define the \",(0,a.jsx)(e.code,{children:\"'static\"}),\" lifetime though, as it already is. If we replace the \",(0,a.jsx)(e.code,{children:\"'a\"}),\" with \",(0,a.jsx)(e.code,{children:\"'static\"}),\" and remove the definition, we will achieve our previous program.\"]}),`\n`,(0,a.jsx)(e.hr,{}),`\n`,(0,a.jsxs)(e.p,{children:[\"Let's move ahead. Now that your business is growing, your configuration is getting more sophisticated. In order to initialize the configuration, you need to run some tasks (like querying a database or reading from a file). Basically, you want to call a function that returns your configuration instead of having it \",(0,a.jsx)(e.em,{children:\"statically\"}),\" defined.\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"Self\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"This new code defines a function \",(0,a.jsx)(e.code,{children:\"new\"}),\"; which you might think of as a constructor. It will create a new instance of \",(0,a.jsx)(e.code,{children:\"Myconfig\"}),\" and returns it. Since it is implemented within the \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\" struct, it is basically returning an instance of itself. Thus, the use of the keyword \",(0,a.jsx)(e.code,{children:\"self\"}),\".\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Unluckily, this doesn't work. The ruler, again, complains.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"error\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"E0015\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\": calls \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"in\"}),` statics are limited to constant functions, tuple structs and tuple variants\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\" --\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),` src/config.rs:6:31\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"6\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\" pub static CONFIG: MyConfig \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" MyConfig::new\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`                               ^^^^^^^^^^^^^^^\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"In case you think this is restricting, you need to understand one more idea: Statics are evaluated at compile time; in other words they are \",(0,a.jsx)(e.em,{children:\"hard-coded\"}),\" into the binary. Functions, on the other hand, are only called at run time. This means Rust can't determine the value of our static variable at compile time; and therefore can't compile the program.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"This is a major roadblock and there seems to be no way around it. Since it is impossible to assign a value to a \",(0,a.jsx)(e.em,{children:\"non-mutable\"}),\" static variable at run time, we will have to resort to magic. If you are a scientist and don't believe in magic, then this is a good time.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"First, we need to add an external dependency named \",(0,a.jsx)(e.code,{children:\"lazy_static\"}),\" to the \",(0,a.jsx)(e.code,{children:\"Cargo.toml\"}),\" file.\"]}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"Cargo.toml\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-toml code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),(0,a.jsx)(e.span,{className:\"\",children:\"dependencies\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"=\"}),' \"',(0,a.jsx)(e.span,{className:\"\",children:\"1.3\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"\",children:\"0\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Next, we import the dependency on \",(0,a.jsx)(e.code,{children:\"main.rs\"}),\".\"]}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[macro_use]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"extern\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"crate\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"And now to the magical part, replace the previous definition with the following.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"config.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static!\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"ref\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Tada! Now our program works. Pretty cool, heh? It is not clear what kind of magic the \",(0,a.jsx)(e.code,{children:\"lazy_static\"}),\" did but it just works. So that was lucky!\"]}),`\n`,(0,a.jsx)(e.hr,{}),`\n`,(0,a.jsxs)(e.p,{children:[\"Except things are about to complicate a bit more. A new bureaucrat in the organization demands that he is able to pass the debug value to the configuration constructor. Bureaucrats want control and this particular one is not happy that debug can only be set from within the \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\" constructor since it is outside of his jurisdiction.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"So we change our constructor to allow him to sneak in.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"Self\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// We are just eluding him of power, we don't actually use the custom_debug variable.\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"This code is fine but it won't compile because the static variable will require that we pass an optional boolean value. In case you don't know what \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/option/index.html\",children:\"Option\"}),\"s are, this is a good time to introduce them. The bureaucrat is not certain that he wants to pass a debug value all the times. He just wants to have the option in case he feels like it. Rust, however, requires that parameters (declared in the function signature) are fully respected. That is, if we have a debug parameter, it needs to be there.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"To manage this bureaucracy, Rust introduces an \",(0,a.jsx)(e.code,{children:\"Option\"}),\" type: It encapsulates the real value if there is one; and if there is none it returns a type named \",(0,a.jsx)(e.code,{children:\"None\"}),\". Simple. It also has a set of functions to manage that additional bureaucracy overhead.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"To make our code compile, we can do the following.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static!\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"ref\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Notice that we are using a function named \",(0,a.jsx)(e.code,{children:\"Some\"}),\". This is because the value that we need to pass is not a \",(0,a.jsx)(e.code,{children:\"bool\"}),\" but an \",(0,a.jsx)(e.code,{children:\"Option\u003cbool\u003e\"}),\". The \",(0,a.jsx)(e.code,{children:\"Some\"}),\" function encapsulates our \",(0,a.jsx)(e.code,{children:\"bool\"}),\" inside an \",(0,a.jsx)(e.code,{children:\"Option\"}),\". So that was easy.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Except that bureaucrats can't access the \",(0,a.jsx)(e.code,{children:\"config.rs\"}),\" file. They need to pass the value from another place: \",(0,a.jsx)(e.code,{children:\"main.rs\"}),\". Since our \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\" is not defined there, we need to create a new function to accommodate. This is going to complicate our setup but we have to comply.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Easy, right?\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Result\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static!\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"ref\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"Ok\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Here we introduce, again, a new type: \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/result/\",children:\"Result\"}),\". \",(0,a.jsx)(e.code,{children:\"Result\"}),\" is similar to \",(0,a.jsx)(e.code,{children:\"Option\"}),\" but serves another purpose and the name should be self-explanatory. \",(0,a.jsx)(e.code,{children:\"Result\"}),\" could be either a success and return our result (in this case \",(0,a.jsx)(e.code,{children:\"()\"}),\") or a failure and return an error (in this case \",(0,a.jsx)(e.code,{children:\"i32\"}),\"). I'm not going to go through it but you can check the \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/result/\",children:\"Rust docs\"}),\".\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Unfortunately, this doesn't work. Even though \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\" has a static (infinite) lifetime, you can't access it outside the \",(0,a.jsx)(e.code,{children:\"init\"}),\" function. In order to be able to do that, you need to return it. But we don't want to do that; and neither that works (We do not own \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\").\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"If you think things started to overly complicate; then hold your breath. In the last example, we were not passing the \",(0,a.jsx)(e.code,{children:\"custom_debug\"}),\" variable; we were just accepting it in the function signature. Now that our bureaucrats found out our misdeed, we need to pass it to the \",(0,a.jsx)(e.code,{children:\"lazy_static!\"}),\" block; but if we do, we get the following error.\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"error\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"E0434\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\": can't capture dynamic environment \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"in\"}),` a fn item\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  --\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),` src/config.rs:12:61\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"12\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"             pub static ref CONFIG: MyConfig \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" MyConfig::new\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`                                                             ^^^^^^^^^^^^\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" help: use the \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),(0,a.jsx)(e.span,{className:\"\",children:\"||\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"..\"}),\". \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),` closure form instead\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Great, things are getting out of control; and Rust is throwing an unreadable error message. What is an \",(0,a.jsx)(e.em,{children:\"fn item\"}),\", a \",(0,a.jsx)(e.em,{children:\"dynamic environment\"}),\" and a \",(0,a.jsx)(e.em,{children:\"closure\"}),\"? That's a lot to take on a single error message and we already have another part of our program non-functioning. The truth is, we are coming to the reality that \",(0,a.jsx)(e.code,{children:\"lazy_static!\"}),\" is not magic. It is just a macro.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"What is a \",(0,a.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Macro_(computer_science)\",children:\"macro\"}),\"?\"]}),`\n`,(0,a.jsx)(e.p,{children:\"A macro is a way to generate Rust code for you. But what is this macro exactly generating? That could shed some light to what it does and maybe hint to better solutions.\"}),`\n`,(0,a.jsx)(e.p,{children:\"Well, it turns out that it is possible to know that. Using this command, we can output the final code that Rust is compiling.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"language-shell code-highlight\",children:(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"cargo rustc -- -Z unstable-options --pretty\",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),`expanded\n`]})})}),`\n`,(0,a.jsxs)(e.p,{children:[\"If you run this, you will see that a lot is going on. \",(0,a.jsx)(e.code,{children:\"println!\"}),\" is a macro. That means the final code is much more than that single line. For now, we will focus on the code generated by \",(0,a.jsx)(e.code,{children:\"lazy_static!\"}),\".\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[allow(missing_copy_implementations)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[allow(non_camel_case_types)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[allow(dead_code)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    __private_field\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[doc(hidden)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\"__private_field\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsxs)(e.span,{className:\"\",children:[\"lazy_static\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),\"__Deref \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"type\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"Target\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"deref\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"self\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"#[inline(always)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"__static_ref_initialize\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"#[inline(always)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"__stability\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"LAZY\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsxs)(e.span,{className:\"\",children:[\"lazy_static\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"lazy\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"Lazy\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsxs)(e.span,{className:\"\",children:[\"lazy_static\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"lazy\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"Lazy\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"\",children:\"INIT\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"LAZY\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"get\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"__static_ref_initialize\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"__stability\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsxs)(e.span,{className:\"\",children:[\"lazy_static\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"LazyStatic\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"initialize\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"lazy\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"Self\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" _ \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"lazy\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"Oops...\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"There is a lot going on here. First, \",(0,a.jsx)(e.code,{children:\"lazy_static!\"}),\" is creating a new type (\",(0,a.jsx)(e.code,{children:\"config::MyConfig::init::CONFIG\"}),\"). This can explain this weird error message when we try to return \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\".\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"error\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"E0308\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),`: mismatched types\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  --\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),` src/config.rs:15:12\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"15\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"         Ok\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"CONFIG\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"            ^^^^^^ expected struct \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"config::MyConfig\",(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),\", found struct \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"config::MyConfig::init::CONFIG\",(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" note: expected \",(0,a.jsx)(e.span,{className:\"\",children:\"type\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"config::MyConfig\",(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"              found \",(0,a.jsx)(e.span,{className:\"\",children:\"type\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"config::MyConfig::init::CONFIG\",(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Cool. We are no longer using the \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\" struct but another one that \",(0,a.jsx)(e.code,{children:\"lazy_static!\"}),\" invented. It looks like \",(0,a.jsx)(e.code,{children:\"lazy_static!\"}),\" has code that executes our function, gets the returned value and creates a new type that imitates our struct. But don't take my word for it. I just happen to know about Rust as much as you do!\"]}),`\n`,(0,a.jsx)(e.hr,{}),`\n`,(0,a.jsxs)(e.p,{children:[\"Remind me again: \",(0,a.jsx)(e.em,{children:\"Why are we here\"}),\"?\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"The thing is, our problem seems to be simple. Only if we were able to change the value of the static variable after declaring it. That will solve all of our headaches. Let us get rid of \",(0,a.jsx)(e.code,{children:\"lazy_static!\"}),\" and possibly enjoy the rest of the day with friends.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Who said we can't?\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mod\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Hello, world!\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Debug value: {}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Recheck Debug value: {}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"config.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mut\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Result\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"unsafe\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap_or\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"Ok\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"unsafe\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"output\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Hello, world\",(0,a.jsx)(e.span,{className:\"\",children:\"!\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Debug value: \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Recheck Debug value: \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Notice a few things here: \",(0,a.jsx)(e.code,{children:\"static\"}),\" means a \",(0,a.jsx)(e.code,{children:\"'static\"}),\" (infinite) lifetime. It doesn't mean we can't mutate the variable. It is not a constant. We can change it if we add the keyword \",(0,a.jsx)(e.code,{children:\"mut\"}),\". Rust doesn't consider it safe (Thus the \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html\",children:\"unsafe\"}),\" keyword) but what does Rust know about the life of the streets??! Our program works. There is \",(0,a.jsx)(e.a,{href:\"https://www.youtube.com/watch?v=RS7IzU2VJIQ\",children:\"plastic in the ocean\"}),\"; I mean, on the big scheme of things, this is a minor issue, right?\"]}),`\n`,(0,a.jsx)(e.hr,{}),`\n`,(0,a.jsx)(e.p,{children:\"But this is not what Rust stands for, is it? We need to live up to the hype, but how do we go about that?\"}),`\n`,(0,a.jsx)(e.p,{children:\"We can start by putting this line at the top of our program.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"language-rust code-highlight\",children:(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#![forbid(unsafe_code)]\"}),`\n`]})})}),`\n`,(0,a.jsx)(e.p,{children:\"Running the previous code will now result in an error.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"error: usage of an \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"unsafe\",(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),` block\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  --\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),` src/config.rs:10:9\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"10\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\" /         unsafe \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"11\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"             CONFIG.debug \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" custom_debug.unwrap_or\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"false\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"12\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\"         \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`_________^\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"   \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"Now we know what we want. We want a global variable that we can, at a certain point, mutate with external variables. But we must do that safely; and be ready for the future of multiple processors, cores and threads.\"}),`\n`,(0,a.jsx)(e.p,{children:\"Let's start with the global variable mutation. One might think that it is not possible to safely mutate static variables. And that's actually correct which is why the Rust team has come up with some solutions.\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"Hidden somewhere in one of Rust's types documentation (\",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/cell/struct.Cell.html\",children:\"Cell\"}),\"), we can read the following.\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"Rust memory safety is based on this rule: Given an object T, it is only possible to have one of the following:\"}),`\n`]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsxs)(e.ul,{children:[`\n`,(0,a.jsx)(e.li,{children:\"Having several immutable references (\u0026T) to the object (also known as aliasing).\"}),`\n`,(0,a.jsx)(e.li,{children:\"Having one mutable reference (\u0026mut T) to the object (also known as mutability).\"}),`\n`]}),`\n`]}),`\n`,(0,a.jsx)(e.p,{children:\"Yes, that's our problem right here.\"}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"This is enforced by the Rust compiler. However, there are situations where this rule is not flexible enough. Sometimes it is required to have multiple references to an object and yet mutate it.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"Shareable mutable containers exist to permit mutability in a controlled manner, even in the presence of aliasing. bla bla bla...\"}),`\n`]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Cool. That's our solution right there. The \",(0,a.jsx)(e.code,{children:\"Cell\"}),\"! Let's go and implement it.\"]}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mod\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"config.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"cell\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"Cell\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug, Copy, Clone)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Cell\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Cell\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Result\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"match\"}),\" custom_debug \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"debug_value\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"set\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" debug_value \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"None\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"Ok\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"get\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"output\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"error\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"E0277\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\": \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"std::cell::Cell\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),\"config::MyConfig\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),` cannot be shared between threads safely\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\" --\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),` src/config.rs:8:1\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"8\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\" pub static CONFIG: Cell\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),\"MyConfig\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" Cell::new\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug: \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),\" ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"std::cell::Cell\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),\"config::MyConfig\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),` cannot be shared between threads safely\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" help: the trait \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"std::marker::Sync\",(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),\" is not implemented \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"std::cell::Cell\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),\"config::MyConfig\",(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" note: shared static variables must have a \",(0,a.jsx)(e.span,{className:\"\",children:\"type\"}),\" that implements \",(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"`\"}),\"Sync\",(0,a.jsx)(e.span,{className:\"\",children:\"`\"})]}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"This doesn't work but it is important to note that this particular configuration, add a few complications: The \",(0,a.jsx)(e.code,{children:\"Clone\"}),\" and \",(0,a.jsx)(e.code,{children:\"Copy\"}),\" keywords. While they seem harmless now, they might be limiting for your future configurations complexity. In case you are wondering what they are about, we will get to them later on in this article.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"But, for now, the gist of it, is that \",(0,a.jsx)(e.code,{children:\"Cell\"}),\" is not thread-safe; whatever that means. We need a type like \",(0,a.jsx)(e.code,{children:\"Cell\"}),\" but that happens to be \",(0,a.jsx)(e.em,{children:\"thread-safe\"}),\".\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Browsing more through the Rust website, we find the \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/sync/atomic/\",children:\"atomic types\"}),\".\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"Atomic types provide primitive shared-memory communication between threads, and are the building blocks of other concurrent types.\"}),`\n`]}),`\n`,(0,a.jsx)(e.p,{children:\"Reading further into the documentation.\"}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"Atomic variables are safe to share between threads (they implement Sync) but they do not themselves provide the mechanism for sharing and follow the threading model of rust. The most common way to share an atomic variable is to put it into an Arc (an atomically-reference-counted shared pointer).\"}),`\n`]}),`\n`,(0,a.jsx)(e.p,{children:\"Atomic variables looks like they are the building block for higher-level types that might solve our problem. We should not use them (as per the advice of the documentation) and instead use the higher-level abstractions.\"}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"Most of the low-level synchronization primitives are quite error-prone and inconvenient to use, which is why the standard library also exposes some higher-level synchronization objects.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.p,{children:[\"These objects are \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Arc.html\",children:\"Arc\"}),\", \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Barrier.html\",children:\"Barrier\"}),\", \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Condvar.html\",children:\"Condvar\"}),\", \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Mutex.html\",children:\"Mutex\"}),\", \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Once.html\",children:\"Once\"}),\", and \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/std/sync/struct.RwLock.html\",children:\"RwLock\"}),\". That's a lot and might mean that the problem at hand is rather hard. Imagine you have two threads executing at the same time: You'd want a solid framework to let them share access to the same variable. That's basically what this mess is about. If we were to have a single-threaded application, things would be much simpler. But we live in a world where quantum tunneling is a real thing!\"]}),`\n`,(0,a.jsx)(e.p,{children:\"So which one do we need? We want multiple access to the global variable (configuration). There are several that can fit the bill. Each has its own quirks and limitations.\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"Let's look for example at \",(0,a.jsx)(e.code,{children:\"Once\"}),\".\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"A synchronization primitive which can be used to run a one-time global initialization. Useful for one-time initialization for FFI or related functionality. This type can only be constructed with the ONCE_INIT value or the equivalent Once::new constructor.\"}),`\n`]}),`\n`,(0,a.jsx)(e.p,{children:\"This sounds good if we want to do a single, one-time initialization of our configuration variable. But how is the code going to look like and what if we initialize twice?\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mod\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Hello, world!\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Debug value: {}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Recheck Debug value: {}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Recheck Debug value: {}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"config.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"sync\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"Once\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"INIT\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Once\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Once\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mut\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Result\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"INIT\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"call_once\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),(0,a.jsx)(e.span,{className:\"\",children:\"|\"})]}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"unsafe\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"match\"}),\" custom_debug \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"debug_value\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,a.jsx)(e.span,{className:\"\",children:\"None\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"Ok\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"unsafe\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"The program runs and here is the output.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Hello, world\",(0,a.jsx)(e.span,{className:\"\",children:\"!\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Debug value: \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Recheck Debug value: \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Recheck Debug value: \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Cool. The \",(0,a.jsx)(e.code,{children:\"init\"}),\" function is functioning as expected. If we recall \",(0,a.jsx)(e.code,{children:\"init\"}),\" twice, however, nothing happens. We can pass variables to our closure. So everything is working just fine. Plus we got rid of the \",(0,a.jsx)(e.code,{children:\"lazy_static\"}),\" crate. One thing to keep out of this mess.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Except, if you have a good eye, you should have noticed something that you probably won't like much (at least if you agreed with our previous monologue). We are using \",(0,a.jsx)(e.code,{children:\"unsafe\"}),\" code!\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Well, according to Rust, this should be pretty safe.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"code-highlight\",children:[(0,a.jsx)(e.span,{className:\"code-line\",children:\"// Accessing a `static mut` is unsafe much of the time, but if we do so\\n\"}),(0,a.jsx)(e.span,{className:\"code-line\",children:`// in a synchronized fashion (e.g., write once or read all) then we're\n`}),(0,a.jsx)(e.span,{className:\"code-line\",children:`// good to go!\n`})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"But there is still something bugging me about it: First, we can only change the configuration one time. This might be enough but it is not quite what we want. Second, we are using \",(0,a.jsx)(e.code,{children:\"unsafe\"}),\" blocks of code. While this is somewhat safe, it opens up the possibility that a developer handles the code unsafely. After all, you just opened a can of worms in a controlled environment. That might have risks since the environment might get out of our control as the code base grows and more developers are recruited.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Better keep the can of worms closed if we can afford it. Luckily, we have a wide range of sync objects to choose from. Let's look at \",(0,a.jsx)(e.code,{children:\"RwLock\"}),\".\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"This type of lock allows a number of readers or at most one writer at any point in time. The write portion of this lock typically allows modification of the underlying data (exclusive access) and the read portion of this lock typically allows for read-only access (shared access).\"}),`\n`]}),`\n`,(0,a.jsx)(e.p,{children:\"Sounds too good to be true? This allows us, basically, to modify the global variables (from a single location) and access it from multiple locations. Well it does come with some complications, however.\"}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"The priority policy of the lock is dependent on the underlying operating system's implementation, and this type does not guarantee that any particular policy will be used.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"The type parameter T represents the data that this lock protects. It is required that T satisfies Send to be shared across threads and Sync to allow concurrent access through readers. The RAII guards returned from the locking methods implement Deref (and DerefMut for the write methods) to allow access to the content of the lock.\"}),`\n`]}),`\n`,(0,a.jsx)(e.p,{children:\"That's some more gibberish out there; but this looks like something we should be able to manage. Let's give it a try.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[macro_use]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"extern\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"crate\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mod\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"config.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"sync\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static!\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"ref\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Result\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mut\"}),\" w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"write\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"match\"}),\" custom_debug \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"debug_value\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" debug_value \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"None\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"Ok\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" m \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"read\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"m\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"This program requires \",(0,a.jsx)(e.code,{children:\"lazy_static\"}),\" as a dependency. If we \",(0,a.jsx)(e.code,{children:\"cargo run\"}),\" it, we will get the following output.\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/config.rs:26\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" m \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" RwLockReadGuard \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    lock: RwLock \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        data: MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`            debug: false,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/config.rs:26\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" m \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" RwLockReadGuard \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    lock: RwLock \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        data: MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`            debug: true,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/config.rs:26\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" m \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" RwLockReadGuard \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    lock: RwLock \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        data: MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`            debug: false,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Looks good? We have a static global variable \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\". Inside this global variable is a \",(0,a.jsx)(e.code,{children:\"RwLock\u003cMyConfig\u003e\"}),\" object. We can mutate the inside of the \",(0,a.jsx)(e.code,{children:\"RwLock\"}),\" by using the \",(0,a.jsx)(e.code,{children:\"write\"}),\" function. We do this in the \",(0,a.jsx)(e.code,{children:\"init\"}),\" function of \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\"; and we can also pass variables.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"So everything is good, right? Well, kind of. You might have noticed that we are not returning the \",(0,a.jsx)(e.code,{children:\"CONFIG\"}),\" struct or a reference to it. Instead, we are displaying the content inside the function itself. But that might not be what you want, you might want to access the values from another place and access it directly.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"We can try that but let's first understand what \",(0,a.jsx)(e.code,{children:\"CONFIG.read().unwrap()\"}),\" is returning. Using the \",(0,a.jsx)(e.code,{children:\"dbg!\"}),\" command, we are getting the following.\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/config.rs:26\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" m \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" RwLockReadGuard \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    lock: RwLock \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        data: MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`            debug: false,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"So it is not our \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\". Or, it is our \",(0,a.jsx)(e.code,{children:\"MyConfig\"}),\" but wrapped inside another structure of the type \",(0,a.jsx)(e.code,{children:\"RwLockReadGuard\"}),\" and stored two levels deep (\",(0,a.jsx)(e.code,{children:\"lock\"}),\" and \",(0,a.jsx)(e.code,{children:\"data\"}),\" fields). The documentation for it is the following.\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"RAII structure used to release the shared read access of a lock when dropped.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"This structure is created by the read and try_read methods on RwLock.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.p,{children:[\"That's more gibberish. What is \",(0,a.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization\",children:\"RAII\"}),\"?\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"Resource acquisition is initialization (RAII)[1] is a programming idiom[2] used in several object-oriented languages to describe a particular language behavior. In RAII, holding a resource is a class invariant, and is tied to object lifetime: resource allocation (or acquisition) is done during object creation (specifically initialization), by the constructor, while resource deallocation (release) is done during object destruction (specifically finalization), by the destructor.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.p,{children:[\"There is another \",(0,a.jsx)(e.a,{href:\"https://www.toptal.com/software/eliminating-garbage-collector\",children:\"article\"}),\" that has another definition.\"]}),`\n`,(0,a.jsxs)(e.blockquote,{children:[`\n`,(0,a.jsx)(e.p,{children:\"All that manual management was unpleasant, to say the least. In the mid-80s, Bjarne Stroustrup invented a new paradigm for his brand-new language, C++. He called it Resource Acquisition Is Initialization, and the fundamental insights were the following: objects can be specified to have constructors and destructors which are called automatically at appropriate times by the compiler, this provides a much more convenient way to manage the memory a given object requires, and the technique is also useful for resources which are not memory.\"}),`\n`]}),`\n`,(0,a.jsxs)(e.p,{children:[\"So that's good. But isn't everything in Rust a RAII structure and what does it mean for our \",(0,a.jsx)(e.code,{children:\"RwLockReadGuard\"}),\"? To see how this unfolds, let's try returning our \",(0,a.jsx)(e.code,{children:\"RwLockReadGuard\"}),\". We will have to unlock every time we want to access the data but there is a price for everything, right?\"]}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[macro_use]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"extern\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"crate\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mod\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Initialize the configuration\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Return 'RwLockReadGuard'\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" a \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Display 'MyConfig'\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"a\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"config.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"sync\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"sync\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"RwLockReadGuard\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static!\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"ref\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Result\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mut\"}),\" w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"write\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"match\"}),\" custom_debug \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"debug_value\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" debug_value \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"None\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"Ok\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLockReadGuard\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" m\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLockReadGuard\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"read\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsx)(e.span,{className:\"code-line\",children:`        m\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"Run the following and we will get.\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/main.rs:15\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"*a \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`    debug: true,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"So that's perfect, right? Let's try to re-initialize our configuration struct.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[macro_use]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"extern\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"crate\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mod\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Initialize the configuration\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Return 'RwLockReadGuard'\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" a \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Display 'MyConfig'\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"a\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Reinit MyConfig\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Return 'RwLockReadGuard'\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" b \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Display 'MyConfig'\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"b\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"Output\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/main.rs:15\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"*a \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`    debug: true,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"Hmm, not exactly the output we expect. Wait! The program didn't quit. It is stuck there!\"}),`\n`,(0,a.jsx)(e.p,{children:\"We tried to cheat our way out of this complexity by plowing through the different types and trying different things. But, obviously, we hit another roadblock. It'd be better to get an understanding of why our program suddenly halted and never returned. It is like our program is stuck in an infinite loop but there is no loop in our code. Or is there?\"}),`\n`,(0,a.jsx)(e.hr,{}),`\n`,(0,a.jsxs)(e.p,{children:[\"Remind me again: \",(0,a.jsx)(e.em,{children:\"Why are we here\"}),\"?\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Why are we going through all of this complexity? What is exactly wrong with simple \",(0,a.jsx)(e.code,{children:\"unsafe\"}),\" code. Well, to understand that, you might need to witness the dangers of \",(0,a.jsx)(e.code,{children:\"unsafe\"}),\" code in real life.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"First, let's remember that our problem only exists if we are working on multiple threads. This means multiple cores. Let's look at this video from a Udacity online MOOC (\",(0,a.jsx)(e.a,{href:\"https://www.udacity.com/course/high-performance-computer-architecture--ud007\",children:\"High Performance Computer Architecture\"}),\"). I would recommend you take the whole course later as it goes deeper on other related topics; but for now this video will do it.\"]}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:\"https://www.youtube.com/watch?v=BMkW9Iwh80E\",children:(0,a.jsx)(e.img,{src:\"http://img.youtube.com/vi/BMkW9Iwh80E/0.jpg\",alt:\"Synchronization Example\"})})}),`\n`,(0,a.jsxs)(e.p,{children:[\"In a nutshell, our problem is due to the fact that two processes trying to access the same memory location (or variable) at the same time can result in a conflict. To ensure consistency, the processor has a set of operations named \",(0,a.jsx)(e.em,{children:\"atomic operations\"}),\" that can guarantee the linearizability of execution. That's why using \",(0,a.jsx)(e.code,{children:\"unsafe\"}),\" code with \",(0,a.jsx)(e.code,{children:\"Once\"}),\" is safe: \",(0,a.jsx)(e.code,{children:\"Once\"}),\" ensures that our operation is linear.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Also, what are atomic operations? Amdan from Stackoverflow has a rather useful \",(0,a.jsx)(e.a,{href:\"https://stackoverflow.com/a/52196874/12637\",children:\"explanation\"}),\". Basically, atomic operations are operations that don't suffer from this conflict. They are executed by the processor directly. That might help explaining some of the gibberish above in the \",(0,a.jsx)(e.code,{children:\"RwLock\"}),\" definition above.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Okay, let's try a couple examples (actually three) and see why unsafe code can give inaccurate results or worse.\"}),`\n`,(0,a.jsx)(e.p,{children:\"In the first example, we show how to use multi-threading by executing two threads together. This example is not related to the configuration code, so we can (and probably should) execute it in a different program.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),\"thread\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Executes Thread 1\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" thread1 \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"thread\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"spawn\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),(0,a.jsx)(e.span,{className:\"\",children:\"|\"})]}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),\" i \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"in\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"..\"}),(0,a.jsx)(e.span,{className:\"\",children:\"100\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Thread 1\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Executes Thread 2\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" thread2 \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"thread\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"spawn\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),(0,a.jsx)(e.span,{className:\"\",children:\"|\"})]}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),\" i \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"in\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"..\"}),(0,a.jsx)(e.span,{className:\"\",children:\"100\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Thread 2\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Makes sure our threads have executed and returned\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    thread1\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"join\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    thread2\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"join\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Execution completed\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"output\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"..\"}),`.\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Thread \",(0,a.jsx)(e.span,{className:\"\",children:\"2\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Thread \",(0,a.jsx)(e.span,{className:\"\",children:\"2\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Thread \",(0,a.jsx)(e.span,{className:\"\",children:\"2\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Thread \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Thread \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Thread \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"..\"}),`.\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Thread \",(0,a.jsx)(e.span,{className:\"\",children:\"2\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"Thread \",(0,a.jsx)(e.span,{className:\"\",children:\"2\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`Execution completed\n`})]})}),`\n`,(0,a.jsx)(e.p,{children:'What our program does is launch two threads. Each thread is going to write to the terminal. Thread 1 will write \"Thread 1\" and Thread 2 will write \"Thread 2\". Since our threads are executing at the same time, we get a mix of these two lines; and it is not predictable which will happen first.'}),`\n`,(0,a.jsxs)(e.p,{children:[\"You might notice here that we are using a new weird sign \",(0,a.jsx)(e.code,{children:\"||\"}),\". That denotes a closure. A \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/rust-by-example/fn/closures.html\",children:\"closure\"}),\" is very similar to an anonymous function with the benefit that it can capture variables from its environment. There are various articles about Rust closures but, for now, if you stick to the idea that they are anonymous functions, then that's enough.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"It is important to highlight that these threads are independent from our main thread or program. While these threads start executing as soon as we spawn them, they might not finish before our program exits. So we must force them to finish execution before our program exits with the \",(0,a.jsx)(e.code,{children:\"join\"}),\" function.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Now that we are comfortable running multiple threads, let's do more: Create a global variable and modify it from both threads. This might seem harmless but it is not something that Rust will allow \",(0,a.jsx)(e.em,{children:\"safely\"}),\" without jumping through hoops. So let's start with the simple and direct approach: Unsafe code. We will declare a global mutable variable, and then mutate it from inside each thread. The variable is a 32-bit integer and from inside the threads we will loop and increment this integer.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Same as before, this example can run on its own.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),\"thread\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mut\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"0\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" thread1 \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"thread\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"spawn\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),(0,a.jsx)(e.span,{className:\"\",children:\"|\"})]}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),\" i \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"in\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"..\"}),(0,a.jsx)(e.span,{className:\"\",children:\"1000\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"unsafe\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"+\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" thread2 \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"thread\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"spawn\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),(0,a.jsx)(e.span,{className:\"\",children:\"|\"})]}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),\" i \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"in\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"..\"}),(0,a.jsx)(e.span,{className:\"\",children:\"1000\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"unsafe\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"+\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    thread1\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"join\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    thread2\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"join\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"unsafe\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"{}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"Alright, let's execute our program. We do 999 iteration in each thread, so we expect our integer to have the value of 1998.\"}),`\n`,(0,a.jsx)(e.p,{children:\"First execution.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"output\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"code-highlight\",children:(0,a.jsx)(e.span,{className:\"code-line\",children:`1254\n`})})}),`\n`,(0,a.jsx)(e.p,{children:\"Hmm. That's not our expectation, let's try again.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"output\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"code-highlight\",children:(0,a.jsx)(e.span,{className:\"code-line\",children:`1443\n`})})}),`\n`,(0,a.jsx)(e.p,{children:\"Cool. We made a random number generator! (Slightly joking; it would be interesting to study how random these numbers are, though).\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"But why are our results not consistent? Well, it is the synchronization issue. The two threads are not synchronized and in multiple occasions (more than enough), they increment the value at the \",(0,a.jsx)(e.em,{children:\"exact\"}),\" same time. When that happens, the value is only incremented once.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"So how do we fix this problem? Well, this is exactly why the Rust team came up with the synchronization primitives.\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"Let's try to use \",(0,a.jsx)(e.code,{children:\"RwLock\"}),\" now.\"]}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[macro_use]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"extern\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"crate\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),\"thread\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"sync\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static!\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"ref\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"0\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" thread1 \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"thread\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"spawn\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),(0,a.jsx)(e.span,{className:\"\",children:\"|\"})]}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),\" i \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"in\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"..\"}),(0,a.jsx)(e.span,{className:\"\",children:\"1000\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mut\"}),\" w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"write\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"w \",(0,a.jsx)(e.span,{className:\"\",children:\"+\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" thread2 \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"thread\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"spawn\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsxs)(e.span,{className:\"\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"|\"}),(0,a.jsx)(e.span,{className:\"\",children:\"|\"})]}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"for\"}),\" i \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"in\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"..\"}),(0,a.jsx)(e.span,{className:\"\",children:\"1000\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mut\"}),\" w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"write\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"w \",(0,a.jsx)(e.span,{className:\"\",children:\"+\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"1\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    thread1\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"join\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    thread2\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"join\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" r \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"INC\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"read\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"println!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"{}\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"r\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"output\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"code-highlight\",children:(0,a.jsx)(e.span,{className:\"code-line\",children:`1998\n`})})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Instead of mutating the global variable directly, we are mutating our type through \",(0,a.jsx)(e.code,{children:\"RwLock\"}),\". \",(0,a.jsx)(e.code,{children:\"RwLock\"}),\" ensures that we are using atomic operations. If one thread is incrementing the variable, the other thread has to wait. You should have already noticed the name of \",(0,a.jsx)(e.code,{children:\"RwLock\"}),\". It is a lock. Go again through the definition and you might understand it more stuff now. That's why in the previous \",(0,a.jsx)(e.code,{children:\"RwLock\"}),\" example our program was stuck. It was waiting for \",(0,a.jsx)(e.code,{children:\"RwLock\"}),\" to be unlocked so that it can access it again.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Alright, let's make use of this knowledge and implement our final solution. For the fun of it, we are going to add a \",(0,a.jsx)(e.code,{children:\"String\"}),\" field. Because, you know, bureaucracy!\"]}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[macro_use]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"extern\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"crate\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mod\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"ops\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"Deref\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// First, we get an RwLockReadGuard\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" guard \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Next, we deref the guard and get MyConfig\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" config \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" guard\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"deref\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Freely access MyConfig by borrowing it\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// We drop the guard and unlock the RwLock\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"drop\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"guard\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Re-initialize our configuration\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"String\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"from\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Updated\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// Go through the same process again\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" guard \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" config \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" guard\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"deref\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),\"info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"drop\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"guard\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"config.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"sync\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"sync\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"RwLockReadGuard\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"String\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static!\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"ref\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"String\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"from\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Some info\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" custom_info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"String\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Result\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mut\"}),\" w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"write\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"match\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" custom_info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"debug_value\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" debug_value\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" custom_info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            _ \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"Ok\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLockReadGuard\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" m \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"read\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsx)(e.span,{className:\"code-line\",children:`        m\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"output\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/main.rs:17\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"config \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`    debug: false,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    info: \",(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Some info\"'}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/main.rs:18\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"config.info \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Some info\"'}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/main.rs:32\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"config \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`    debug: true,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    info: \",(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Updated\"'}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/main.rs:33\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),\"config.info \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Updated\"'}),`\n`]})]})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Hooray! This works! It is a pain in the \",(0,a.jsx)(e.strong,{children:\"_ but it serves our purposes, and it is safe. That should be everything Rust stands for (At least, I'm certain of the pain in the _\"}),\" part)!\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"Alright, could this be simpler? We promised above to cover the \",(0,a.jsx)(e.code,{children:\"Copy\"}),\" and \",(0,a.jsx)(e.code,{children:\"Clone\"}),\" keywords, and this is the part where we do. Remember the Ownership/Borrowing concept we talked above at first? That you can't take something you don't own but you can borrow it? But what if you were able to \",(0,a.jsx)(e.em,{children:\"clone\"}),\" it. Well, that makes you able to return the actual type.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"There are types that don't \",(0,a.jsx)(e.em,{children:\"derive\"}),\" Copy. We won't go into the details of why and how. Partly because we have already covered a lot on this topic but also because there are lots of good resources on this. The Rust Programming Language book does a good job on that: \",(0,a.jsx)(e.a,{href:\"https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html\",children:\"What is ownership\"})]}),`\n`,(0,a.jsx)(e.p,{children:\"Let's see how this would work.\"}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"main.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[macro_use]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"extern\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"crate\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mod\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"config\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"main\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" a \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"a\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"true\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Updated\"'}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" a \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"\",children:\"dbg!\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"a\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"config.rs\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"use\"}),\" \",(0,a.jsxs)(e.span,{className:\"\",children:[\"std\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),\"sync\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"})]}),(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"#[derive(Debug, Clone, Copy)]\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"struct\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"str\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"\",children:\"lazy_static!\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"ref\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"RwLock\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"::\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"new\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-red\",children:\"false\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Some info\"'}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"impl\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"init\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"bool\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" custom_info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Option\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u0026\"}),(0,a.jsx)(e.span,{className:\"\",children:\"'static\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"str\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Result\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003c\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"i32\"}),(0,a.jsx)(e.span,{className:\"\",children:\"\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"mut\"}),\" w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"write\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"match\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_debug \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" custom_info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"debug_value\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"Some\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),\"custom_info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),\"w \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),\" debug\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" debug_value\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),\" info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\":\"}),\" custom_info\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"            _ \",(0,a.jsx)(e.span,{className:\"\",children:\"=\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\",\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"Ok\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"pub\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"fn\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"global_config\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"-\u003e\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"MyConfig\"}),\" \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-code-purple\",children:\"let\"}),\" m \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" \",(0,a.jsx)(e.span,{className:\"\",children:\"CONFIG\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"read\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\".\"}),(0,a.jsx)(e.span,{className:\"text-code-blue\",children:\"unwrap\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"(\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\")\"}),(0,a.jsx)(e.span,{className:\"text-code-white\",children:\";\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"text-gray-400 italic\",children:\"// This doesn't return *m but a copy of it\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,a.jsx)(e.span,{className:\"\",children:\"*\"}),`m\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:(0,a.jsx)(e.code,{children:\"output\"})}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/main.rs:11\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" a \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`    debug: false,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    info: \",(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Some info\"'}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"[\"}),\"src/main.rs:17\",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"]\"}),\" a \",(0,a.jsx)(e.span,{className:\"\",children:\"=\"}),\" MyConfig \",(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"{\"}),`\n`]}),(0,a.jsx)(e.span,{className:\"code-line\",children:`    debug: true,\n`}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[\"    info: \",(0,a.jsx)(e.span,{className:\"text-code-green\",children:'\"Updated\"'}),`,\n`]}),(0,a.jsxs)(e.span,{className:\"code-line\",children:[(0,a.jsx)(e.span,{className:\"text-code-white\",children:\"}\"}),`\n`]})]})}),`\n`,(0,a.jsx)(e.p,{children:\"That's convenient but you have to keep in mind that we are returning copies of the configuration and not the actual configuration.\"}),`\n`,(0,a.jsx)(e.hr,{}),`\n`,(0,a.jsx)(e.p,{children:\"I hope this introduction to Rust wasn't overwhelming.\"})]});return c?(0,a.jsx)(c,Object.assign({},s,{children:n})):n}var b=f;return y;})();\n;return Component.default;","toc":[],"frontMatter":{"readingTime":{"text":"39 min read","minutes":38.965,"time":2337900,"words":7793},"slug":"rust-intro","fileName":"rust-intro.md","title":"A brief introduction to Rust","date":"2019-10-10T00:00:00.000Z","tags":["Rust","Programming"],"draft":false,"summary":"A brief introduction to Rust","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.205,"time":12300,"words":41},"slug":["default"],"fileName":"default.md","name":"Abid Omar","avatar":"/static/images/avatar.png","occupation":"Entrepreneur","company":"Aderbal","email":"contact@omarabid.com","github":"https://github.com/omarabid","date":null}],"prev":{"title":"The VIM Experience","date":"2019-04-27T00:00:00.000Z","tags":["vim","productivity"],"draft":false,"summary":"7 years journey with VIM","images":[],"layout":"PostLayout","slug":"vim"},"next":{"title":"Rust 2020: A better ecosystem","date":"2019-11-01T00:00:00.000Z","tags":["Rust","Programming"],"draft":false,"summary":"Suggestions for Rust 2020","images":[],"layout":"PostLayout","slug":"rust-2020"}},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["rust-intro"]},"buildId":"KYIboEi8iEOtO3qwukdDm","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>