<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="alternate" type="application/rss+xml" title="Personal website and blog of Omar Abid. - RSS feed" href="https://omarabid.com/rust-introfeed.xml"/><title>A brief introduction to Rust</title><meta name="robots" content="follow, index"/><meta name="description" content="A brief introduction to Rust"/><meta property="og:url" content="https://omarabid.com/rust-intro"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Omar Abid"/><meta property="og:description" content="A brief introduction to Rust"/><meta property="og:title" content="A brief introduction to Rust"/><link rel="icon" href="favicon.svg" sizes="any" type="image/svg+xml"/><meta property="og:image" content="https://omarabid.com/static/images/twitter-card.png"/><meta property="article:published_time" content="2019-10-10T00:00:00.000Z"/><link rel="canonical" href="https://omarabid.com/rust-intro"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://omarabid.com/blog/rust-intro"
  },
  "headline": "A brief introduction to Rust",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://omarabid.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2019-10-10T00:00:00.000Z",
  "dateModified": "2019-10-10T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Abid Omar"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Omar Abid",
    "logo": {
      "@type": "ImageObject",
      "url": "https://omarabid.com/static/images/logo.svg"
    }
  },
  "description": "A brief introduction to Rust"
}</script><meta name="next-head-count" content="16"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/461e19abfe062792.css" as="style"/><link rel="stylesheet" href="/_next/static/css/461e19abfe062792.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-63157d71ad419e09.js" defer=""></script><script src="/_next/static/chunks/main-cf84626044a46074.js" defer=""></script><script src="/_next/static/chunks/pages/_app-243597ec1113984d.js" defer=""></script><script src="/_next/static/chunks/107-42815f5dc001e4d9.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-9f28a767fb677fac.js" defer=""></script><script src="/_next/static/0qN_KK8eLo_6RbAp1z1lJ/_buildManifest.js" defer=""></script><script src="/_next/static/0qN_KK8eLo_6RbAp1z1lJ/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap">@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_GNsFVQ.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_D1sFVQ.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_A9sFVQ.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_ONrFVQ.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9eCBsR6Z2vfE9aq3bL0fxyUs4tcw4W_NprFVQ.woff) format('woff')}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0NSDqFGedCMX.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh2dSDqFGedCMX.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0dSDqFGedCMX.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3tSDqFGedCMX.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh09SDqFGedCMX.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3dSDqFGedA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0NSDqFGedCMX.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh2dSDqFGedCMX.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0dSDqFGedCMX.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3tSDqFGedCMX.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh09SDqFGedCMX.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3dSDqFGedA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0NSDqFGedCMX.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh2dSDqFGedCMX.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0dSDqFGedCMX.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3tSDqFGedCMX.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh09SDqFGedCMX.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3dSDqFGedA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0NSDqFGedCMX.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh2dSDqFGedCMX.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0dSDqFGedCMX.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3tSDqFGedCMX.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh09SDqFGedCMX.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3dSDqFGedA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0NSDqFGedCMX.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh2dSDqFGedCMX.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh0dSDqFGedCMX.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3tSDqFGedCMX.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh09SDqFGedCMX.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Fira Code';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/firacode/v21/uU9NCBsR6Z2vfE9aq3bh3dSDqFGedA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style><style data-href="https://fonts.googleapis.com/css2?family=Biryani&display=swap">@font-face{font-family:'Biryani';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/biryani/v13/hv-WlzNxIFoO84YdTU8.woff) format('woff')}@font-face{font-family:'Biryani';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/biryani/v13/hv-WlzNxIFoO84YdfUoTPBp6X-pHXg.woff2) format('woff2');unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF}@font-face{font-family:'Biryani';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/biryani/v13/hv-WlzNxIFoO84YdfUUTPBp6X-pHXg.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Biryani';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/biryani/v13/hv-WlzNxIFoO84YdfUsTPBp6X-o.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><header class="relative flex flex-wrap content-center justify-center pt-44 pb-12"><div class="flex items-center justify-between"><h1 class="font-logo text-4xl uppercase"><a aria-label="Omar Abid Personal Blog" href="/">Omar Abid</a></h1></div><div class="absolute right-0"><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button></div></header><div class="flex flex-col justify-between"><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><article><div><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">A brief introduction to Rust</h1></div></header><div class="divide-y divide-gray-200 pt-10 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none text-xl dark:prose-dark"><p>This blog post will take a deep dive into the Rust world of mutability. By deep dive, it means the blog post is considerably long. So it will take time to go through the different examples. The topic we will dive through is specific but we will have to go through various Rust concepts: Ownership/Borrowing, Lifetimes, Unsafe, Sync, Closures, Macros and more. This might be intimidating and I think this is where many developers are put off.</p><p>This article assumes some familiarity with Rust; that is if you have successfully run a &quot;Hello World&quot; program, then you are qualified! If you have struggled with some of the hard concepts then this article could be a good introduction. It will not go deep for each one of these but will give you enough knowledge to help you understand the bigger picture.</p><hr/><p>We will start from a <em>reasonably</em> easy problem: We want to access a particular variable from any location in our program; by access, I mean both read and write access. That might seem like a straightforward thing to do, especially if you are coming from other languages like JavaScript. If we have a variable (and the browser is our sandbox), then we can make it global by attaching it to the <code>window</code> object. So if we have <code>window.config</code>, we can access (both read and write) the <code>config</code> variable from anywhere in our code.</p><p>So our problem is we have this <code>config</code> object but in Rust. The configuration object is a <a href="https://doc.rust-lang.org/rust-by-example/custom_types/structs.html">struct</a>. It can be set and initialized somewhere in our program. The initialization bit is important as we will find out later. Our configuration could be simple default values set in the code, and updated later; or it could require reading files, exchanging data over the network, etc. So we want to be sure that we can do both.</p><p>We have other requirements and although most of the use cases don&#x27;t need these niceties, it is better to have them for the future (And these are the kind of problems that Rust is intended to solve). Like, for example, our program might also become multithreaded in the future, as we anticipate more cores in the CPU and less improvement in the clock rate.</p><p>Things are already starting to confuse; so how about we start with a simple example and the most basic implementation of a configuration struct.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Debugging value: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Rechecking Debugging value: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>output</code></p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">Hello, world<span class="token operator">!</span>
</span><span class="code-line">Debugging value: <span class="token boolean">false</span>
</span><span class="code-line">Rechecking Debugging value: <span class="token boolean">false</span>
</span></code></pre></div><p>Pretty simple: We use a function named <code>config</code> to return an instance of our configuration. Inside <code>config</code>, we make a new <code>MyConfig</code> instance for each call and then return it. (We could have placed this code in a different file and called it with <code>mod filename</code>; we are going to do that later, so don&#x27;t worry!).</p><p>So far so good. But there is a small issue here: Every time we call the <code>config</code> function, we return a <em>new</em> instance of <code>MyConfig</code>. Practically speaking, it is the <em>same</em> configuration; but technically speaking, it is a <em>different</em> object. Imagine, for instance, that our <code>config</code> function was querying a database for a particular field. The <code>config</code> function will be doing the query every time we call it. This is not good; after all we should only do it one time both for efficiency and consistency.</p><p>What we want is a single initialization of our configuration. That initialization is safeguarded somewhere, and then we access it as many times as we want. Basically, a global variable accessible from the <code>config</code> function or any other location in our program.</p><p>This time, we will separate our program into two files: <code>main.rs</code> and <code>config.rs</code>. The code could function from within <code>main.rs</code> but the separation of concerns is helpful.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">config</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Debug: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Rechecking Debug: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>config.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">static</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;static</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token operator">&amp;</span><span class="token constant">CONFIG</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Alright, a lot is going on here; especially if you are both new to and confused by the Rust syntax. But don&#x27;t worry, we will explain it in details. First, we are still using a function to return our configuration; but this time it is attached to the <code>MyConfig</code> struct. Think of a Rust struct like a JavaScript object or in OOP languages like a class where you can add both fields and methods to your struct. The method that returns our configuration is <code>global_config</code>.</p><p>Let&#x27;s go back further, this line deserves some explanation.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">static</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Creating a <em>global variable</em> in Rust is pretty easy. We just use the <code>static</code> keyword. Now, our variable <em>can be</em> available anywhere in our program. In fact, this is what the rust-lang documentation says about the <a href="https://doc.rust-lang.org/rust-by-example/scope/lifetime/static_lifetime.html">static</a> keyword:</p><blockquote><p>A &#x27;static lifetime is the longest possible lifetime, and lasts for the lifetime of the running program.</p></blockquote><p>Okay, that was a trap. What is a <a href="https://doc.rust-lang.org/rust-by-example/scope/lifetime.html">lifetime</a>? Well, you can go with the raw and naive definition: How long you will live. But that definition doesn&#x27;t seem about our <code>static</code> keyword, or is it? It is also way too simplistic. The rust-lang website will already throw words like <em>borrow checker</em> at you. That&#x27;s scary, so how about we stick to the raw definition for now: How long the variable will live.</p><p>So what&#x27;s <code>&#x27;static</code>? It is the longest lifetime; which means the entirety of our program. It means our variable will be <em>alive</em> and accessible as long as our program is running. The <code>static</code> keyword doesn&#x27;t mean our variable is a <em>constant</em> but just that it has a <code>&#x27;static</code> lifetime. A better word is <em>immortal</em> but that doesn&#x27;t sound geeky and cryptic enough and hence the choice of <code>&#x27;static</code>. If you are still confused, notice that <code>&#x27;static</code> is the name of the lifetime while <code>static</code> is a keyword that gives our variable a <code>&#x27;static</code> lifetime.</p><p>Our configuration is initialized once and we declare a global variable named <code>CONFIG</code>. To access it, we use the function <code>global_config</code> implemented in our struct; but since it is a global variable we could access it from anywhere really.</p><p>Let&#x27;s dissect the <code>global_config</code> function. If you are new to Rust, you might have already noticed the gibberish in that function. We are not returning <code>MyConfig</code> in the function signature but adding a bunch of keywords; something must be going on.</p><p>To understand what is going on, you might need to understand the Rust Ownership/Borrowing model. Don&#x27;t worry, we will stick to the naive definition: You can&#x27;t take/move what you don&#x27;t own, but you can borrow it. You can&#x27;t make changes on what you borrow unless you request permissions; and even then you are going to have to follow some rules.</p><p>So let&#x27;s test the constitution. If you run this line inside the main function.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">let</span> myconfig<span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token constant">CONFIG</span><span class="token punctuation">;</span>
</span></code></pre></div><p>On execution, we are going to get the following error.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">error<span class="token punctuation">[</span><span class="token constant">E0507</span><span class="token punctuation">]</span><span class="token punctuation">:</span> cannot <span class="token keyword">move</span> out of <span class="token keyword">static</span> item
</span><span class="code-line"> <span class="token operator">-</span><span class="token punctuation">-&gt;</span> src<span class="token operator">/</span>main<span class="token punctuation">.</span>rs<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">30</span>
</span><span class="code-line">  <span class="token operator">|</span>
</span><span class="code-line"><span class="token number">9</span> <span class="token operator">|</span>     <span class="token keyword">let</span> myconfig<span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token constant">CONFIG</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token operator">|</span>                              <span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span>
</span><span class="code-line">  <span class="token operator">|</span>                              <span class="token operator">|</span>
</span><span class="code-line">  <span class="token operator">|</span>                              cannot <span class="token keyword">move</span> out of <span class="token keyword">static</span> item
</span><span class="code-line">  <span class="token operator">|</span>                              help<span class="token punctuation">:</span> consider borrowing here<span class="token punctuation">:</span> `<span class="token operator">&amp;</span><span class="token namespace">config<span class="token punctuation">::</span></span><span class="token constant">CONFIG</span>`
</span></code></pre></div><p>We do not own <code>CONFIG</code>. The ruler, therefore, would not allow moving it but most importantly: There is no way around it. The ruler would also gives us a hint: consider borrowing.</p><p>Borrowing is actually pretty cool: We can access the object from where it is located; and that is basically it. But that serves our purposes, right? (Plus Rust doesn&#x27;t charge us any interest!).</p><p>So this code is fine. (again we can run this code on <code>main.rs</code>)</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line">  <span class="token keyword">let</span> myconfig<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token namespace">config<span class="token punctuation">::</span></span><span class="token constant">CONFIG</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token property macro">dbg!</span><span class="token punctuation">(</span>myconfig<span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Notice that here we do neither own nor move <code>CONFIG</code>. We are barely <em>referencing</em> it. The type of my <code>myconfig</code> is <code>&amp;MyConfig</code> and not <code>MyConfig</code>. A reference, and not the actual thing. To create a reference, we use an ampersand <code>&amp;</code>.</p><p>If you have been successfully following along, you almost did understand what the code in <code>global_config</code> does. Except for one more sketchy keyword: <code>&amp;&#x27;static</code>. If we tried to return <code>&amp;MyConfig</code> instead of <code>&amp;&#x27;static MyConfig</code>, we will get the following error.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">error<span class="token punctuation">[</span>E0106<span class="token punctuation">]</span>: missing lifetime specifier
</span><span class="code-line"> --<span class="token operator">&gt;</span> src/config.rs:9:31
</span><span class="code-line">  <span class="token operator">|</span>
</span><span class="code-line"><span class="token number">9</span> <span class="token operator">|</span>     pub fn global_config<span class="token punctuation">(</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token operator">|</span>                               ^ help: consider giving it a <span class="token string">&#x27;static lifetime: `&amp;&#x27;</span>static`
</span><span class="code-line">  <span class="token operator">|</span>
</span><span class="code-line">  <span class="token operator">=</span> help: this function&#x27;s <span class="token class-name builtin">return</span> <span class="token class-name builtin">type</span> contains a borrowed value, but there is no value <span class="token keyword">for</span> it to be borrowed from
</span></code></pre></div><p>The ruler is asking for a lifetime to our reference. You might be wondering: Why, and what does that mean? And what does a reference mean in the first place?</p><p>The <a href="https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html">Rust Programming Language book</a> has a rather helpful definition.</p><blockquote><p>These ampersands are references, and they allow you to refer to some value without taking ownership of it.</p></blockquote><blockquote><p>The opposite of referencing by using &amp; is dereferencing, which is accomplished with the dereference operator, *.</p></blockquote><p>Okay, so referencing is actually <em>borrowing</em>. But what is a lifetime? <a href="https://doc.rust-lang.org/rust-by-example/scope/lifetime.html">Rust By Example</a> has an average explanation.</p><blockquote><p>A lifetime is a construct the compiler (or more specifically, its borrow checker) uses to ensure all borrows are valid. Specifically, a variable&#x27;s lifetime begins when it is created and ends when it is destroyed. While lifetimes and scopes are often referred to together, they are not the same.</p></blockquote><blockquote><p>Take, for example, the case where we borrow a variable via &amp;. The borrow has a lifetime that is determined by where it is declared. As a result, the borrow is valid as long as it ends before the lender is destroyed. However, the scope of the borrow is determined by where the reference is used.</p></blockquote><p>What if <code>CONFIG</code> is dropped from memory? Now, we know for certain that this will not happen because <code>CONFIG</code> is <em>immortal</em> but the compiler doesn&#x27;t know that. In our signature, we are returning a reference to <code>MyConfig</code> and not <code>CONFIG</code>; so it is not clear how long the real object will live for. If that object is dropped, then our reference will fail. We need to ensure that our reference lives at most as the object it is <em>pointing</em> at. Not more.</p><p>In my opinion, the hard part about lifetimes is the unreadable gibberish that accompanies it. First, we need to define (or name) a lifetime. We do that before the function signature. We will make use of <code>&lt;,&gt;</code> and an apostrophe; that&#x27;s pretty clean. To make it more confusing, let&#x27;s name our lifetime &quot;a&quot; even though we can use a more meaningful names. If everybody on the community does that, it will greatly help beginners: They will think it is some sort of keyword out there. But as we will use it again in the returned value with an apostrophe, they will finally succumb and concede that it is pure wizardry.</p><p>Look at this! This code actually runs!</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"> <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;a</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> myconfig <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token operator">&amp;</span>myconfig
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><p>Instead of defining a lifetime, we can assign the <code>&#x27;static</code> lifetime. That makes sense since the item we are borrowing from has a <code>&#x27;static</code> lifetime itself and should live for the entirety of the program. We don&#x27;t need to define the <code>&#x27;static</code> lifetime though, as it already is. If we replace the <code>&#x27;a</code> with <code>&#x27;static</code> and remove the definition, we will achieve our previous program.</p><hr/><p>Let&#x27;s move ahead. Now that your business is growing, your configuration is getting more sophisticated. In order to initialize the configuration, you need to run some tasks (like querying a database or reading from a file). Basically, you want to call a function that returns your configuration instead of having it <em>statically</em> defined.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;static</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token operator">&amp;</span><span class="token constant">CONFIG</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>This new code defines a function <code>new</code>; which you might think of as a constructor. It will create a new instance of <code>Myconfig</code> and returns it. Since it is implemented within the <code>MyConfig</code> struct, it is basically returning an instance of itself. Thus, the use of the keyword <code>self</code>.</p><p>Unluckily, this doesn&#x27;t work. The ruler, again, complains.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">error<span class="token punctuation">[</span>E0015<span class="token punctuation">]</span>: calls <span class="token keyword">in</span> statics are limited to constant functions, tuple structs and tuple variants
</span><span class="code-line"> --<span class="token operator">&gt;</span> src/config.rs:6:31
</span><span class="code-line">  <span class="token operator">|</span>
</span><span class="code-line"><span class="token number">6</span> <span class="token operator">|</span> pub static CONFIG: MyConfig <span class="token operator">=</span> MyConfig::new<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token operator">|</span>                               ^^^^^^^^^^^^^^^
</span></code></pre></div><p>In case you think this is restricting, you need to understand one more idea: Statics are evaluated at compile time; in other words they are <em>hard-coded</em> into the binary. Functions, on the other hand, are only called at run time. This means Rust can&#x27;t determine the value of our static variable at compile time; and therefore can&#x27;t compile the program.</p><p>This is a major roadblock and there seems to be no way around it. Since it is impossible to assign a value to a <em>non-mutable</em> static variable at run time, we will have to resort to magic. If you are a scientist and don&#x27;t believe in magic, then this is a good time.</p><p>First, we need to add an external dependency named <code>lazy_static</code> to the <code>Cargo.toml</code> file.</p><p><code>Cargo.toml</code></p><div class="relative"><pre><code class="code-highlight language-toml"><span class="code-line"><span class="token punctuation">[</span><span class="token class-name table">dependencies</span><span class="token punctuation">]</span>
</span><span class="code-line"><span class="token property key">lazy_static</span> <span class="token punctuation">=</span> &quot;<span class="token number">1.3</span><span class="token punctuation">.</span><span class="token number">0</span>
</span></code></pre></div><p>Next, we import the dependency on <code>main.rs</code>.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[macro_use]</span>
</span><span class="code-line"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token namespace module-declaration">lazy_static</span><span class="token punctuation">;</span>
</span></code></pre></div><p>And now to the magical part, replace the previous definition with the following.</p><p><code>config.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token property macro">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Tada! Now our program works. Pretty cool, heh? It is not clear what kind of magic the <code>lazy_static</code> did but it just works. So that was lucky!</p><hr/><p>Except things are about to complicate a bit more. A new bureaucrat in the organization demands that he is able to pass the debug value to the configuration constructor. Bureaucrats want control and this particular one is not happy that debug can only be set from within the <code>MyConfig</code> constructor since it is outside of his jurisdiction.</p><p>So we change our constructor to allow him to sneak in.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">new</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// We are just eluding him of power, we don&#x27;t actually use the custom_debug variable.</span>
</span><span class="code-line">        <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span></code></pre></div><p>This code is fine but it won&#x27;t compile because the static variable will require that we pass an optional boolean value. In case you don&#x27;t know what <a href="https://doc.rust-lang.org/std/option/index.html">Option</a>s are, this is a good time to introduce them. The bureaucrat is not certain that he wants to pass a debug value all the times. He just wants to have the option in case he feels like it. Rust, however, requires that parameters (declared in the function signature) are fully respected. That is, if we have a debug parameter, it needs to be there.</p><p>To manage this bureaucracy, Rust introduces an <code>Option</code> type: It encapsulates the real value if there is one; and if there is none it returns a type named <code>None</code>. Simple. It also has a set of functions to manage that additional bureaucracy overhead.</p><p>To make our code compile, we can do the following.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token property macro">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Notice that we are using a function named <code>Some</code>. This is because the value that we need to pass is not a <code>bool</code> but an <code>Option&lt;bool&gt;</code>. The <code>Some</code> function encapsulates our <code>bool</code> inside an <code>Option</code>. So that was easy.</p><p>Except that bureaucrats can&#x27;t access the <code>config.rs</code> file. They need to pass the value from another place: <code>main.rs</code>. Since our <code>CONFIG</code> is not defined there, we need to create a new function to accommodate. This is going to complicate our setup but we have to comply.</p><p>Easy, right?</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">init</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property macro">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Here we introduce, again, a new type: <a href="https://doc.rust-lang.org/std/result/">Result</a>. <code>Result</code> is similar to <code>Option</code> but serves another purpose and the name should be self-explanatory. <code>Result</code> could be either a success and return our result (in this case <code>()</code>) or a failure and return an error (in this case <code>i32</code>). I&#x27;m not going to go through it but you can check the <a href="https://doc.rust-lang.org/std/result/">Rust docs</a>.</p><p>Unfortunately, this doesn&#x27;t work. Even though <code>CONFIG</code> has a static (infinite) lifetime, you can&#x27;t access it outside the <code>init</code> function. In order to be able to do that, you need to return it. But we don&#x27;t want to do that; and neither that works (We do not own <code>CONFIG</code>).</p><p>If you think things started to overly complicate; then hold your breath. In the last example, we were not passing the <code>custom_debug</code> variable; we were just accepting it in the function signature. Now that our bureaucrats found out our misdeed, we need to pass it to the <code>lazy_static!</code> block; but if we do, we get the following error.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">error<span class="token punctuation">[</span>E0434<span class="token punctuation">]</span>: can&#x27;t capture dynamic environment <span class="token keyword">in</span> a fn item
</span><span class="code-line">  --<span class="token operator">&gt;</span> src/config.rs:12:61
</span><span class="code-line">   <span class="token operator">|</span>
</span><span class="code-line"><span class="token number">12</span> <span class="token operator">|</span>             pub static ref CONFIG: MyConfig <span class="token operator">=</span> MyConfig::new<span class="token punctuation">(</span>custom_debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">   <span class="token operator">|</span>                                                             ^^^^^^^^^^^^
</span><span class="code-line">   <span class="token operator">|</span>
</span><span class="code-line">   <span class="token operator">=</span> help: use the <span class="token variable"><span class="token variable">`</span><span class="token operator">||</span> <span class="token punctuation">{</span> <span class="token punctuation">..</span>. <span class="token punctuation">}</span><span class="token variable">`</span></span> closure form instead
</span></code></pre></div><p>Great, things are getting out of control; and Rust is throwing an unreadable error message. What is an <em>fn item</em>, a <em>dynamic environment</em> and a <em>closure</em>? That&#x27;s a lot to take on a single error message and we already have another part of our program non-functioning. The truth is, we are coming to the reality that <code>lazy_static!</code> is not magic. It is just a macro.</p><p>What is a <a href="https://en.wikipedia.org/wiki/Macro_(computer_science)">macro</a>?</p><p>A macro is a way to generate Rust code for you. But what is this macro exactly generating? That could shed some light to what it does and maybe hint to better solutions.</p><p>Well, it turns out that it is possible to know that. Using this command, we can output the final code that Rust is compiling.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token function">cargo</span> rustc -- <span class="token variable parameter">-Z</span> unstable-options <span class="token variable parameter">--pretty</span><span class="token operator">=</span>expanded
</span></code></pre></div><p>If you run this, you will see that a lot is going on. <code>println!</code> is a macro. That means the final code is much more than that single line. For now, we will focus on the code generated by <code>lazy_static!</code>.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[allow(missing_copy_implementations)]</span>
</span><span class="code-line"><span class="token attr-name attribute">#[allow(non_camel_case_types)]</span>
</span><span class="code-line"><span class="token attr-name attribute">#[allow(dead_code)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">CONFIG</span> <span class="token punctuation">{</span>
</span><span class="code-line">    __private_field<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token attr-name attribute">#[doc(hidden)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token constant">CONFIG</span> <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">{</span>__private_field<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token punctuation">::</span><span class="token namespace">lazy_static<span class="token punctuation">::</span></span>__Deref <span class="token keyword">for</span> <span class="token constant">CONFIG</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">type</span>
</span><span class="code-line">    <span class="token class-name type-definition">Target</span>
</span><span class="code-line">    <span class="token operator">=</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function function-definition">deref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token attr-name attribute">#[inline(always)]</span>
</span><span class="code-line">        <span class="token keyword">fn</span> <span class="token function function-definition">__static_ref_initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token attr-name attribute">#[inline(always)]</span>
</span><span class="code-line">        <span class="token keyword">fn</span> <span class="token function function-definition">__stability</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;static</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">static</span> <span class="token constant">LAZY</span><span class="token punctuation">:</span> <span class="token punctuation">::</span><span class="token namespace">lazy_static<span class="token punctuation">::</span>lazy<span class="token punctuation">::</span></span><span class="token class-name">Lazy</span><span class="token operator">&lt;</span><span class="token class-name">MyConfig</span><span class="token operator">&gt;</span> <span class="token operator">=</span>
</span><span class="code-line">                <span class="token punctuation">::</span><span class="token namespace">lazy_static<span class="token punctuation">::</span>lazy<span class="token punctuation">::</span></span><span class="token class-name">Lazy</span><span class="token punctuation">::</span><span class="token constant">INIT</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token constant">LAZY</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>__static_ref_initialize<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token function">__stability</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token punctuation">::</span><span class="token namespace">lazy_static<span class="token punctuation">::</span></span><span class="token class-name">LazyStatic</span> <span class="token keyword">for</span> <span class="token constant">CONFIG</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">fn</span> <span class="token function function-definition">initialize</span><span class="token punctuation">(</span>lazy<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">let</span> _ <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token operator">*</span>lazy<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Oops...</p><p>There is a lot going on here. First, <code>lazy_static!</code> is creating a new type (<code>config::MyConfig::init::CONFIG</code>). This can explain this weird error message when we try to return <code>CONFIG</code>.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">error<span class="token punctuation">[</span>E0308<span class="token punctuation">]</span>: mismatched types
</span><span class="code-line">  --<span class="token operator">&gt;</span> src/config.rs:15:12
</span><span class="code-line">   <span class="token operator">|</span>
</span><span class="code-line"><span class="token number">15</span> <span class="token operator">|</span>         Ok<span class="token punctuation">(</span>CONFIG<span class="token punctuation">)</span>
</span><span class="code-line">   <span class="token operator">|</span>            ^^^^^^ expected struct <span class="token variable"><span class="token variable">`</span>config::MyConfig<span class="token variable">`</span></span>, found struct <span class="token variable"><span class="token variable">`</span>config::MyConfig::init::CONFIG<span class="token variable">`</span></span>
</span><span class="code-line">   <span class="token operator">|</span>
</span><span class="code-line">   <span class="token operator">=</span> note: expected <span class="token class-name builtin">type</span> <span class="token variable"><span class="token variable">`</span>config::MyConfig<span class="token variable">`</span></span>
</span><span class="code-line">              found <span class="token class-name builtin">type</span> <span class="token variable"><span class="token variable">`</span>config::MyConfig::init::CONFIG<span class="token variable">`</span></span>
</span></code></pre></div><p>Cool. We are no longer using the <code>MyConfig</code> struct but another one that <code>lazy_static!</code> invented. It looks like <code>lazy_static!</code> has code that executes our function, gets the returned value and creates a new type that imitates our struct. But don&#x27;t take my word for it. I just happen to know about Rust as much as you do!</p><hr/><p>Remind me again: <em>Why are we here</em>?</p><p>The thing is, our problem seems to be simple. Only if we were able to change the value of the static variable after declaring it. That will solve all of our headaches. Let us get rid of <code>lazy_static!</code> and possibly enjoy the rest of the day with friends.</p><p>Who said we can&#x27;t?</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">config</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Debug value: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Recheck Debug value: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>config.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">mut</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">init</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token constant">CONFIG</span><span class="token punctuation">.</span>debug <span class="token operator">=</span> custom_debug<span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;static</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token operator">&amp;</span><span class="token constant">CONFIG</span> <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>output</code></p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">Hello, world<span class="token operator">!</span>
</span><span class="code-line">Debug value: <span class="token boolean">false</span>
</span><span class="code-line">Recheck Debug value: <span class="token boolean">true</span>
</span></code></pre></div><p>Notice a few things here: <code>static</code> means a <code>&#x27;static</code> (infinite) lifetime. It doesn&#x27;t mean we can&#x27;t mutate the variable. It is not a constant. We can change it if we add the keyword <code>mut</code>. Rust doesn&#x27;t consider it safe (Thus the <a href="https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html">unsafe</a> keyword) but what does Rust know about the life of the streets??! Our program works. There is <a href="https://www.youtube.com/watch?v=RS7IzU2VJIQ">plastic in the ocean</a>; I mean, on the big scheme of things, this is a minor issue, right?</p><hr/><p>But this is not what Rust stands for, is it? We need to live up to the hype, but how do we go about that?</p><p>We can start by putting this line at the top of our program.</p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#![forbid(unsafe_code)]</span>
</span></code></pre></div><p>Running the previous code will now result in an error.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">error: usage of an <span class="token variable"><span class="token variable">`</span>unsafe<span class="token variable">`</span></span> block
</span><span class="code-line">  --<span class="token operator">&gt;</span> src/config.rs:10:9
</span><span class="code-line">   <span class="token operator">|</span>
</span><span class="code-line"><span class="token number">10</span> <span class="token operator">|</span> /         unsafe <span class="token punctuation">{</span>
</span><span class="code-line"><span class="token number">11</span> <span class="token operator">|</span> <span class="token operator">|</span>             CONFIG.debug <span class="token operator">=</span> custom_debug.unwrap_or<span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token number">12</span> <span class="token operator">|</span> <span class="token operator">|</span>         <span class="token punctuation">}</span>
</span><span class="code-line">   <span class="token operator">|</span> <span class="token operator">|</span>_________^
</span><span class="code-line">   <span class="token operator">|</span>
</span></code></pre></div><p>Now we know what we want. We want a global variable that we can, at a certain point, mutate with external variables. But we must do that safely; and be ready for the future of multiple processors, cores and threads.</p><p>Let&#x27;s start with the global variable mutation. One might think that it is not possible to safely mutate static variables. And that&#x27;s actually correct which is why the Rust team has come up with some solutions.</p><p>Hidden somewhere in one of Rust&#x27;s types documentation (<a href="https://doc.rust-lang.org/std/cell/struct.Cell.html">Cell</a>), we can read the following.</p><blockquote><p>Rust memory safety is based on this rule: Given an object T, it is only possible to have one of the following:</p></blockquote><blockquote><ul><li>Having several immutable references (&amp;T) to the object (also known as aliasing).</li><li>Having one mutable reference (&amp;mut T) to the object (also known as mutability).</li></ul></blockquote><p>Yes, that&#x27;s our problem right here.</p><blockquote><p>This is enforced by the Rust compiler. However, there are situations where this rule is not flexible enough. Sometimes it is required to have multiple references to an object and yet mutate it.</p></blockquote><blockquote><p>Shareable mutable containers exist to permit mutability in a controlled manner, even in the presence of aliasing. bla bla bla...</p></blockquote><p>Cool. That&#x27;s our solution right there. The <code>Cell</code>! Let&#x27;s go and implement it.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">config</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span><span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>config.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cell<span class="token punctuation">::</span></span><span class="token class-name">Cell</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attr-name attribute">#[derive(Debug, Copy, Clone)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">Cell</span><span class="token operator">&lt;</span><span class="token class-name">MyConfig</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">Cell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">init</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">match</span> custom_debug <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Some</span><span class="token punctuation">(</span>debug_value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> debug_value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>output</code></p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">error<span class="token punctuation">[</span>E0277<span class="token punctuation">]</span>: <span class="token variable"><span class="token variable">`</span>std::cell::Cell<span class="token operator">&lt;</span>config::MyConfig<span class="token operator">&gt;</span><span class="token variable">`</span></span> cannot be shared between threads safely
</span><span class="code-line"> --<span class="token operator">&gt;</span> src/config.rs:8:1
</span><span class="code-line">  <span class="token operator">|</span>
</span><span class="code-line"><span class="token number">8</span> <span class="token operator">|</span> pub static CONFIG: Cell<span class="token operator">&lt;</span>MyConfig<span class="token operator">&gt;</span> <span class="token operator">=</span> Cell::new<span class="token punctuation">(</span>MyConfig <span class="token punctuation">{</span> debug: <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token operator">|</span> ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ <span class="token variable"><span class="token variable">`</span>std::cell::Cell<span class="token operator">&lt;</span>config::MyConfig<span class="token operator">&gt;</span><span class="token variable">`</span></span> cannot be shared between threads safely
</span><span class="code-line">  <span class="token operator">|</span>
</span><span class="code-line">  <span class="token operator">=</span> help: the trait <span class="token variable"><span class="token variable">`</span>std::marker::Sync<span class="token variable">`</span></span> is not implemented <span class="token keyword">for</span> <span class="token variable"><span class="token variable">`</span>std::cell::Cell<span class="token operator">&lt;</span>config::MyConfig<span class="token operator">&gt;</span><span class="token variable">`</span></span>
</span><span class="code-line">  <span class="token operator">=</span> note: shared static variables must have a <span class="token class-name builtin">type</span> that implements <span class="token variable"><span class="token variable">`</span>Sync<span class="token variable">`</span></span>
</span></code></pre></div><p>This doesn&#x27;t work but it is important to note that this particular configuration, add a few complications: The <code>Clone</code> and <code>Copy</code> keywords. While they seem harmless now, they might be limiting for your future configurations complexity. In case you are wondering what they are about, we will get to them later on in this article.</p><p>But, for now, the gist of it, is that <code>Cell</code> is not thread-safe; whatever that means. We need a type like <code>Cell</code> but that happens to be <em>thread-safe</em>.</p><p>Browsing more through the Rust website, we find the <a href="https://doc.rust-lang.org/std/sync/atomic/">atomic types</a>.</p><blockquote><p>Atomic types provide primitive shared-memory communication between threads, and are the building blocks of other concurrent types.</p></blockquote><p>Reading further into the documentation.</p><blockquote><p>Atomic variables are safe to share between threads (they implement Sync) but they do not themselves provide the mechanism for sharing and follow the threading model of rust. The most common way to share an atomic variable is to put it into an Arc (an atomically-reference-counted shared pointer).</p></blockquote><p>Atomic variables looks like they are the building block for higher-level types that might solve our problem. We should not use them (as per the advice of the documentation) and instead use the higher-level abstractions.</p><blockquote><p>Most of the low-level synchronization primitives are quite error-prone and inconvenient to use, which is why the standard library also exposes some higher-level synchronization objects.</p></blockquote><p>These objects are <a href="https://doc.rust-lang.org/std/sync/struct.Arc.html">Arc</a>, <a href="https://doc.rust-lang.org/std/sync/struct.Barrier.html">Barrier</a>, <a href="https://doc.rust-lang.org/std/sync/struct.Condvar.html">Condvar</a>, <a href="https://doc.rust-lang.org/std/sync/struct.Mutex.html">Mutex</a>, <a href="https://doc.rust-lang.org/std/sync/struct.Once.html">Once</a>, and <a href="https://doc.rust-lang.org/std/sync/struct.RwLock.html">RwLock</a>. That&#x27;s a lot and might mean that the problem at hand is rather hard. Imagine you have two threads executing at the same time: You&#x27;d want a solid framework to let them share access to the same variable. That&#x27;s basically what this mess is about. If we were to have a single-threaded application, things would be much simpler. But we live in a world where quantum tunneling is a real thing!</p><p>So which one do we need? We want multiple access to the global variable (configuration). There are several that can fit the bill. Each has its own quirks and limitations.</p><p>Let&#x27;s look for example at <code>Once</code>.</p><blockquote><p>A synchronization primitive which can be used to run a one-time global initialization. Useful for one-time initialization for FFI or related functionality. This type can only be constructed with the ONCE_INIT value or the equivalent Once::new constructor.</p></blockquote><p>This sounds good if we want to do a single, one-time initialization of our configuration variable. But how is the code going to look like and what if we initialize twice?</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">config</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Debug value: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Recheck Debug value: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Recheck Debug value: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>config.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Once</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token constant">INIT</span><span class="token punctuation">:</span> <span class="token class-name">Once</span> <span class="token operator">=</span> <span class="token class-name">Once</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">mut</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">MyConfig</span> <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">init</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token constant">INIT</span><span class="token punctuation">.</span><span class="token function">call_once</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">match</span> custom_debug <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token class-name">Some</span><span class="token punctuation">(</span>debug_value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">CONFIG</span> <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;static</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> <span class="token operator">&amp;</span><span class="token constant">CONFIG</span> <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>The program runs and here is the output.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line">Hello, world<span class="token operator">!</span>
</span><span class="code-line">Debug value: <span class="token boolean">false</span>
</span><span class="code-line">Recheck Debug value: <span class="token boolean">true</span>
</span><span class="code-line">Recheck Debug value: <span class="token boolean">true</span>
</span></code></pre></div><p>Cool. The <code>init</code> function is functioning as expected. If we recall <code>init</code> twice, however, nothing happens. We can pass variables to our closure. So everything is working just fine. Plus we got rid of the <code>lazy_static</code> crate. One thing to keep out of this mess.</p><p>Except, if you have a good eye, you should have noticed something that you probably won&#x27;t like much (at least if you agreed with our previous monologue). We are using <code>unsafe</code> code!</p><p>Well, according to Rust, this should be pretty safe.</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">// Accessing a `static mut` is unsafe much of the time, but if we do so
</span><span class="code-line">// in a synchronized fashion (e.g., write once or read all) then we&#x27;re
</span><span class="code-line">// good to go!
</span></code></pre></div><p>But there is still something bugging me about it: First, we can only change the configuration one time. This might be enough but it is not quite what we want. Second, we are using <code>unsafe</code> blocks of code. While this is somewhat safe, it opens up the possibility that a developer handles the code unsafely. After all, you just opened a can of worms in a controlled environment. That might have risks since the environment might get out of our control as the code base grows and more developers are recruited.</p><p>Better keep the can of worms closed if we can afford it. Luckily, we have a wide range of sync objects to choose from. Let&#x27;s look at <code>RwLock</code>.</p><blockquote><p>This type of lock allows a number of readers or at most one writer at any point in time. The write portion of this lock typically allows modification of the underlying data (exclusive access) and the read portion of this lock typically allows for read-only access (shared access).</p></blockquote><p>Sounds too good to be true? This allows us, basically, to modify the global variables (from a single location) and access it from multiple locations. Well it does come with some complications, however.</p><blockquote><p>The priority policy of the lock is dependent on the underlying operating system&#x27;s implementation, and this type does not guarantee that any particular policy will be used.</p></blockquote><blockquote><p>The type parameter T represents the data that this lock protects. It is required that T satisfies Send to be shared across threads and Sync to allow concurrent access through readers. The RAII guards returned from the locking methods implement Deref (and DerefMut for the write methods) to allow access to the content of the lock.</p></blockquote><p>That&#x27;s some more gibberish out there; but this looks like something we should be able to manage. Let&#x27;s give it a try.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[macro_use]</span>
</span><span class="code-line"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token namespace module-declaration">lazy_static</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">config</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>config.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token property macro">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">MyConfig</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">init</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> <span class="token keyword">mut</span> w <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">match</span> custom_debug <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Some</span><span class="token punctuation">(</span>debug_value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">*</span>w <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> debug_value <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token property macro">dbg!</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>This program requires <code>lazy_static</code> as a dependency. If we <code>cargo run</code> it, we will get the following output.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token punctuation">[</span>src/config.rs:26<span class="token punctuation">]</span> m <span class="token operator">=</span> RwLockReadGuard <span class="token punctuation">{</span>
</span><span class="code-line">    lock: RwLock <span class="token punctuation">{</span>
</span><span class="code-line">        data: MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">            debug: false,
</span><span class="code-line">        <span class="token punctuation">}</span>,
</span><span class="code-line">    <span class="token punctuation">}</span>,
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">[</span>src/config.rs:26<span class="token punctuation">]</span> m <span class="token operator">=</span> RwLockReadGuard <span class="token punctuation">{</span>
</span><span class="code-line">    lock: RwLock <span class="token punctuation">{</span>
</span><span class="code-line">        data: MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">            debug: true,
</span><span class="code-line">        <span class="token punctuation">}</span>,
</span><span class="code-line">    <span class="token punctuation">}</span>,
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">[</span>src/config.rs:26<span class="token punctuation">]</span> m <span class="token operator">=</span> RwLockReadGuard <span class="token punctuation">{</span>
</span><span class="code-line">    lock: RwLock <span class="token punctuation">{</span>
</span><span class="code-line">        data: MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">            debug: false,
</span><span class="code-line">        <span class="token punctuation">}</span>,
</span><span class="code-line">    <span class="token punctuation">}</span>,
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Looks good? We have a static global variable <code>CONFIG</code>. Inside this global variable is a <code>RwLock&lt;MyConfig&gt;</code> object. We can mutate the inside of the <code>RwLock</code> by using the <code>write</code> function. We do this in the <code>init</code> function of <code>MyConfig</code>; and we can also pass variables.</p><p>So everything is good, right? Well, kind of. You might have noticed that we are not returning the <code>CONFIG</code> struct or a reference to it. Instead, we are displaying the content inside the function itself. But that might not be what you want, you might want to access the values from another place and access it directly.</p><p>We can try that but let&#x27;s first understand what <code>CONFIG.read().unwrap()</code> is returning. Using the <code>dbg!</code> command, we are getting the following.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token punctuation">[</span>src/config.rs:26<span class="token punctuation">]</span> m <span class="token operator">=</span> RwLockReadGuard <span class="token punctuation">{</span>
</span><span class="code-line">    lock: RwLock <span class="token punctuation">{</span>
</span><span class="code-line">        data: MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">            debug: false,
</span><span class="code-line">        <span class="token punctuation">}</span>,
</span><span class="code-line">    <span class="token punctuation">}</span>,
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>So it is not our <code>MyConfig</code>. Or, it is our <code>MyConfig</code> but wrapped inside another structure of the type <code>RwLockReadGuard</code> and stored two levels deep (<code>lock</code> and <code>data</code> fields). The documentation for it is the following.</p><blockquote><p>RAII structure used to release the shared read access of a lock when dropped.</p></blockquote><blockquote><p>This structure is created by the read and try_read methods on RwLock.</p></blockquote><p>That&#x27;s more gibberish. What is <a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a>?</p><blockquote><p>Resource acquisition is initialization (RAII)[1] is a programming idiom[2] used in several object-oriented languages to describe a particular language behavior. In RAII, holding a resource is a class invariant, and is tied to object lifetime: resource allocation (or acquisition) is done during object creation (specifically initialization), by the constructor, while resource deallocation (release) is done during object destruction (specifically finalization), by the destructor.</p></blockquote><p>There is another <a href="https://www.toptal.com/software/eliminating-garbage-collector">article</a> that has another definition.</p><blockquote><p>All that manual management was unpleasant, to say the least. In the mid-80s, Bjarne Stroustrup invented a new paradigm for his brand-new language, C++. He called it Resource Acquisition Is Initialization, and the fundamental insights were the following: objects can be specified to have constructors and destructors which are called automatically at appropriate times by the compiler, this provides a much more convenient way to manage the memory a given object requires, and the technique is also useful for resources which are not memory.</p></blockquote><p>So that&#x27;s good. But isn&#x27;t everything in Rust a RAII structure and what does it mean for our <code>RwLockReadGuard</code>? To see how this unfolds, let&#x27;s try returning our <code>RwLockReadGuard</code>. We will have to unlock every time we want to access the data but there is a price for everything, right?</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[macro_use]</span>
</span><span class="code-line"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token namespace module-declaration">lazy_static</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">config</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// Initialize the configuration</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Return &#x27;RwLockReadGuard&#x27;</span>
</span><span class="code-line">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Display &#x27;MyConfig&#x27;</span>
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>config.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">RwLockReadGuard</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token property macro">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">MyConfig</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">init</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">let</span> <span class="token keyword">mut</span> w <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">match</span> custom_debug <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Some</span><span class="token punctuation">(</span>debug_value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">*</span>w <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> debug_value <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">RwLockReadGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> m<span class="token punctuation">:</span> <span class="token class-name">RwLockReadGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        m
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Run the following and we will get.</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token punctuation">[</span>src/main.rs:15<span class="token punctuation">]</span> <span class="token operator">&amp;</span>*a <span class="token operator">=</span> MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">    debug: true,
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>So that&#x27;s perfect, right? Let&#x27;s try to re-initialize our configuration struct.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[macro_use]</span>
</span><span class="code-line"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token namespace module-declaration">lazy_static</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">config</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// Initialize the configuration</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Return &#x27;RwLockReadGuard&#x27;</span>
</span><span class="code-line">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Display &#x27;MyConfig&#x27;</span>
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Reinit MyConfig</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Return &#x27;RwLockReadGuard&#x27;</span>
</span><span class="code-line">    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Display &#x27;MyConfig&#x27;</span>
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Output</p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token punctuation">[</span>src/main.rs:15<span class="token punctuation">]</span> <span class="token operator">&amp;</span>*a <span class="token operator">=</span> MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">    debug: true,
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Hmm, not exactly the output we expect. Wait! The program didn&#x27;t quit. It is stuck there!</p><p>We tried to cheat our way out of this complexity by plowing through the different types and trying different things. But, obviously, we hit another roadblock. It&#x27;d be better to get an understanding of why our program suddenly halted and never returned. It is like our program is stuck in an infinite loop but there is no loop in our code. Or is there?</p><hr/><p>Remind me again: <em>Why are we here</em>?</p><p>Why are we going through all of this complexity? What is exactly wrong with simple <code>unsafe</code> code. Well, to understand that, you might need to witness the dangers of <code>unsafe</code> code in real life.</p><p>First, let&#x27;s remember that our problem only exists if we are working on multiple threads. This means multiple cores. Let&#x27;s look at this video from a Udacity online MOOC (<a href="https://www.udacity.com/course/high-performance-computer-architecture--ud007">High Performance Computer Architecture</a>). I would recommend you take the whole course later as it goes deeper on other related topics; but for now this video will do it.</p><p><a href="https://www.youtube.com/watch?v=BMkW9Iwh80E"><img alt="Synchronization Example" src="http://img.youtube.com/vi/BMkW9Iwh80E/0.jpg"/></a></p><p>In a nutshell, our problem is due to the fact that two processes trying to access the same memory location (or variable) at the same time can result in a conflict. To ensure consistency, the processor has a set of operations named <em>atomic operations</em> that can guarantee the linearizability of execution. That&#x27;s why using <code>unsafe</code> code with <code>Once</code> is safe: <code>Once</code> ensures that our operation is linear.</p><p>Also, what are atomic operations? Amdan from Stackoverflow has a rather useful <a href="https://stackoverflow.com/a/52196874/12637">explanation</a>. Basically, atomic operations are operations that don&#x27;t suffer from this conflict. They are executed by the processor directly. That might help explaining some of the gibberish above in the <code>RwLock</code> definition above.</p><p>Okay, let&#x27;s try a couple examples (actually three) and see why unsafe code can give inaccurate results or worse.</p><p>In the first example, we show how to use multi-threading by executing two threads together. This example is not related to the configuration code, so we can (and probably should) execute it in a different program.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// Executes Thread 1</span>
</span><span class="code-line">    <span class="token keyword">let</span> thread1 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">100</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Thread 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Executes Thread 2</span>
</span><span class="code-line">    <span class="token keyword">let</span> thread2 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">100</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Thread 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Makes sure our threads have executed and returned</span>
</span><span class="code-line">    thread1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    thread2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Execution completed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>output</code></p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">Thread <span class="token number">2</span>
</span><span class="code-line">Thread <span class="token number">2</span>
</span><span class="code-line">Thread <span class="token number">2</span>
</span><span class="code-line">Thread <span class="token number">1</span>
</span><span class="code-line">Thread <span class="token number">1</span>
</span><span class="code-line">Thread <span class="token number">1</span>
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">Thread <span class="token number">2</span>
</span><span class="code-line">Thread <span class="token number">2</span>
</span><span class="code-line">Execution completed
</span></code></pre></div><p>What our program does is launch two threads. Each thread is going to write to the terminal. Thread 1 will write &quot;Thread 1&quot; and Thread 2 will write &quot;Thread 2&quot;. Since our threads are executing at the same time, we get a mix of these two lines; and it is not predictable which will happen first.</p><p>You might notice here that we are using a new weird sign <code>||</code>. That denotes a closure. A <a href="https://doc.rust-lang.org/rust-by-example/fn/closures.html">closure</a> is very similar to an anonymous function with the benefit that it can capture variables from its environment. There are various articles about Rust closures but, for now, if you stick to the idea that they are anonymous functions, then that&#x27;s enough.</p><p>It is important to highlight that these threads are independent from our main thread or program. While these threads start executing as soon as we spawn them, they might not finish before our program exits. So we must force them to finish execution before our program exits with the <code>join</code> function.</p><p>Now that we are comfortable running multiple threads, let&#x27;s do more: Create a global variable and modify it from both threads. This might seem harmless but it is not something that Rust will allow <em>safely</em> without jumping through hoops. So let&#x27;s start with the simple and direct approach: Unsafe code. We will declare a global mutable variable, and then mutate it from inside each thread. The variable is a 32-bit integer and from inside the threads we will loop and increment this integer.</p><p>Same as before, this example can run on its own.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">mut</span> <span class="token constant">INC</span><span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> thread1 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">1000</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token constant">INC</span> <span class="token operator">=</span> <span class="token constant">INC</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> thread2 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">1000</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token constant">INC</span> <span class="token operator">=</span> <span class="token constant">INC</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    thread1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    thread2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> <span class="token constant">INC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Alright, let&#x27;s execute our program. We do 999 iteration in each thread, so we expect our integer to have the value of 1998.</p><p>First execution.</p><p><code>output</code></p><div class="relative"><pre><code class="code-highlight"><span class="code-line">1254
</span></code></pre></div><p>Hmm. That&#x27;s not our expectation, let&#x27;s try again.</p><p><code>output</code></p><div class="relative"><pre><code class="code-highlight"><span class="code-line">1443
</span></code></pre></div><p>Cool. We made a random number generator! (Slightly joking; it would be interesting to study how random these numbers are, though).</p><p>But why are our results not consistent? Well, it is the synchronization issue. The two threads are not synchronized and in multiple occasions (more than enough), they increment the value at the <em>exact</em> same time. When that happens, the value is only incremented once.</p><p>So how do we fix this problem? Well, this is exactly why the Rust team came up with the synchronization primitives.</p><p>Let&#x27;s try to use <code>RwLock</code> now.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[macro_use]</span>
</span><span class="code-line"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token namespace module-declaration">lazy_static</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token property macro">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">INC</span><span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> thread1 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">1000</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">let</span> <span class="token keyword">mut</span> w <span class="token operator">=</span> <span class="token constant">INC</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token operator">*</span>w <span class="token operator">=</span> <span class="token operator">*</span>w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> thread2 <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation closure-punctuation">|</span><span class="token punctuation closure-punctuation">|</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">1000</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">let</span> <span class="token keyword">mut</span> w <span class="token operator">=</span> <span class="token constant">INC</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token operator">*</span>w <span class="token operator">=</span> <span class="token operator">*</span>w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    thread1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    thread2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token constant">INC</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token property macro">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>output</code></p><div class="relative"><pre><code class="code-highlight"><span class="code-line">1998
</span></code></pre></div><p>Instead of mutating the global variable directly, we are mutating our type through <code>RwLock</code>. <code>RwLock</code> ensures that we are using atomic operations. If one thread is incrementing the variable, the other thread has to wait. You should have already noticed the name of <code>RwLock</code>. It is a lock. Go again through the definition and you might understand it more stuff now. That&#x27;s why in the previous <code>RwLock</code> example our program was stuck. It was waiting for <code>RwLock</code> to be unlocked so that it can access it again.</p><p>Alright, let&#x27;s make use of this knowledge and implement our final solution. For the fun of it, we are going to add a <code>String</code> field. Because, you know, bureaucracy!</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[macro_use]</span>
</span><span class="code-line"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token namespace module-declaration">lazy_static</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">config</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">Deref</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// First, we get an RwLockReadGuard</span>
</span><span class="code-line">    <span class="token keyword">let</span> guard <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Next, we deref the guard and get MyConfig</span>
</span><span class="code-line">    <span class="token keyword">let</span> config <span class="token operator">=</span> guard<span class="token punctuation">.</span><span class="token function">deref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Freely access MyConfig by borrowing it</span>
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>config<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// We drop the guard and unlock the RwLock</span>
</span><span class="code-line">    <span class="token function">drop</span><span class="token punctuation">(</span>guard<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Re-initialize our configuration</span>
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Updated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// Go through the same process again</span>
</span><span class="code-line">    <span class="token keyword">let</span> guard <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> config <span class="token operator">=</span> guard<span class="token punctuation">.</span><span class="token function">deref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>config<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">drop</span><span class="token punctuation">(</span>guard<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>config.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">RwLockReadGuard</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attr-name attribute">#[derive(Debug)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">pub</span> info<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token property macro">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">MyConfig</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> info<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Some info&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">init</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> custom_info<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> <span class="token keyword">mut</span> w <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">match</span> <span class="token punctuation">(</span>custom_debug <span class="token punctuation">,</span> custom_info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span>debug_value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>custom_info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">*</span>w <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> debug_value<span class="token punctuation">,</span> info<span class="token punctuation">:</span> custom_info<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">            _ <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">RwLockReadGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#x27;static</span><span class="token punctuation">,</span> <span class="token class-name">MyConfig</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        m
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>output</code></p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token punctuation">[</span>src/main.rs:17<span class="token punctuation">]</span> <span class="token operator">&amp;</span>config <span class="token operator">=</span> MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">    debug: false,
</span><span class="code-line">    info: <span class="token string">&quot;Some info&quot;</span>,
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">[</span>src/main.rs:18<span class="token punctuation">]</span> <span class="token operator">&amp;</span>config.info <span class="token operator">=</span> <span class="token string">&quot;Some info&quot;</span>
</span><span class="code-line"><span class="token punctuation">[</span>src/main.rs:32<span class="token punctuation">]</span> <span class="token operator">&amp;</span>config <span class="token operator">=</span> MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">    debug: true,
</span><span class="code-line">    info: <span class="token string">&quot;Updated&quot;</span>,
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">[</span>src/main.rs:33<span class="token punctuation">]</span> <span class="token operator">&amp;</span>config.info <span class="token operator">=</span> <span class="token string">&quot;Updated&quot;</span>
</span></code></pre></div><p>Hooray! This works! It is a pain in the <strong>_ but it serves our purposes, and it is safe. That should be everything Rust stands for (At least, I&#x27;m certain of the pain in the _</strong> part)!</p><p>Alright, could this be simpler? We promised above to cover the <code>Copy</code> and <code>Clone</code> keywords, and this is the part where we do. Remember the Ownership/Borrowing concept we talked above at first? That you can&#x27;t take something you don&#x27;t own but you can borrow it? But what if you were able to <em>clone</em> it. Well, that makes you able to return the actual type.</p><p>There are types that don&#x27;t <em>derive</em> Copy. We won&#x27;t go into the details of why and how. Partly because we have already covered a lot on this topic but also because there are lots of good resources on this. The Rust Programming Language book does a good job on that: <a href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html">What is ownership</a></p><p>Let&#x27;s see how this would work.</p><p><code>main.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token attr-name attribute">#[macro_use]</span>
</span><span class="code-line"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token namespace module-declaration">lazy_static</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token namespace module-declaration">config</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">config<span class="token punctuation">::</span></span><span class="token class-name">MyConfig</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function function-definition">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Updated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token class-name">MyConfig</span><span class="token punctuation">::</span><span class="token function">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token property macro">dbg!</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>config.rs</code></p><div class="relative"><pre><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attr-name attribute">#[derive(Debug, Clone, Copy)]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token class-name type-definition">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> debug<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">pub</span> info<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;static</span> <span class="token keyword">str</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token property macro">lazy_static!</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">CONFIG</span><span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">MyConfig</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> info<span class="token punctuation">:</span> <span class="token string">&quot;Some info&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">impl</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">init</span><span class="token punctuation">(</span>custom_debug<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> custom_info<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;static</span> <span class="token keyword">str</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> <span class="token keyword">mut</span> w <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">match</span> <span class="token punctuation">(</span>custom_debug <span class="token punctuation">,</span> custom_info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span>debug_value<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>custom_info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">*</span>w <span class="token operator">=</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span> debug<span class="token punctuation">:</span> debug_value<span class="token punctuation">,</span> info<span class="token punctuation">:</span> custom_info<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">            _ <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function function-definition">global_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">MyConfig</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">// This doesn&#x27;t return *m but a copy of it</span>
</span><span class="code-line">        <span class="token operator">*</span>m
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>output</code></p><div class="relative"><pre><code class="code-highlight language-shell"><span class="code-line"><span class="token punctuation">[</span>src/main.rs:11<span class="token punctuation">]</span> a <span class="token operator">=</span> MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">    debug: false,
</span><span class="code-line">    info: <span class="token string">&quot;Some info&quot;</span>,
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">[</span>src/main.rs:17<span class="token punctuation">]</span> a <span class="token operator">=</span> MyConfig <span class="token punctuation">{</span>
</span><span class="code-line">    debug: true,
</span><span class="code-line">    info: <span class="token string">&quot;Updated&quot;</span>,
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>That&#x27;s convenient but you have to keep in mind that we are returning copies of the configuration and not the actual configuration.</p><hr/><p>I hope this introduction to Rust wasn&#x27;t overwhelming.</p></div></div><div class="text-sm font-medium leading-5 xl:col-start-1 xl:row-start-2"><dl class="space-y-10 py-4"><div><dt class="sr-only">Published on</dt><dd class="text-s font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2019-10-10T00:00:00.000Z">Thursday, October 10, 2019</time></dd></div></dl><div class="py-4"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/rust">Rust</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/programming">Programming</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/vim">The VIM Experience</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/rust-2020">Rust 2020: A better ecosystem</a></div></div></div><div class="py-4"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/archive">← Back to the archive</a></div></div></div></div></article><div class="border-primary/10 mt-16 border-t pt-8 sm:mt-20 lg:mt-24 lg:flex lg:items-center lg:justify-between"><div><h3 class="text-primary text-sm font-semibold leading-6">Subscribe by email</h3><p class="text-primary mt-2 text-sm leading-6">Get new publications from this blog directly to your email.</p></div><iframe src="https://embeds.beehiiv.com/fd13ecd4-9bb1-46bb-a4cb-44e2dccc40dc?slim=true" data-test-id="beehiiv-embed" height="52" title="Newsletter" frameBorder="0" scrolling="no" style="margin:0;padding-left:4rem;border-radius:0px !important;background-color:transparent;width:100%"></iframe></div></div></main></div><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Omar Abid</div><div> • </div><div>© 2023</div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var p=Object.create;var l=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var k=(a,n)=\u003e()=\u003e(n||a((n={exports:{}}).exports,n),n.exports),g=(a,n)=\u003e{for(var s in n)l(a,s,{get:n[s],enumerable:!0})},o=(a,n,s,t)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let c of m(n))!N.call(a,c)\u0026\u0026c!==s\u0026\u0026l(a,c,{get:()=\u003en[c],enumerable:!(t=h(n,c))||t.enumerable});return a};var f=(a,n,s)=\u003e(s=a!=null?p(u(a)):{},o(n||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),y=a=\u003eo(l({},\"__esModule\",{value:!0}),a);var r=k((_,i)=\u003e{i.exports=_jsx_runtime});var C={};g(C,{default:()=\u003ev,frontmatter:()=\u003ew});var e=f(r()),w={title:\"A brief introduction to Rust\",date:\"2019-10-10\",tags:[\"Rust\",\"Programming\"],draft:!1,summary:\"A brief introduction to Rust\",images:[],layout:\"PostLayout\"};function d(a){let n=Object.assign({p:\"p\",hr:\"hr\",em:\"em\",code:\"code\",a:\"a\",pre:\"pre\",span:\"span\",blockquote:\"blockquote\",ul:\"ul\",li:\"li\",img:\"img\",strong:\"strong\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"This blog post will take a deep dive into the Rust world of mutability. By deep dive, it means the blog post is considerably long. So it will take time to go through the different examples. The topic we will dive through is specific but we will have to go through various Rust concepts: Ownership/Borrowing, Lifetimes, Unsafe, Sync, Closures, Macros and more. This might be intimidating and I think this is where many developers are put off.\"}),(0,e.jsx)(n.p,{children:'This article assumes some familiarity with Rust; that is if you have successfully run a \"Hello World\" program, then you are qualified! If you have struggled with some of the hard concepts then this article could be a good introduction. It will not go deep for each one of these but will give you enough knowledge to help you understand the bigger picture.'}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.p,{children:[\"We will start from a \",(0,e.jsx)(n.em,{children:\"reasonably\"}),\" easy problem: We want to access a particular variable from any location in our program; by access, I mean both read and write access. That might seem like a straightforward thing to do, especially if you are coming from other languages like JavaScript. If we have a variable (and the browser is our sandbox), then we can make it global by attaching it to the \",(0,e.jsx)(n.code,{children:\"window\"}),\" object. So if we have \",(0,e.jsx)(n.code,{children:\"window.config\"}),\", we can access (both read and write) the \",(0,e.jsx)(n.code,{children:\"config\"}),\" variable from anywhere in our code.\"]}),(0,e.jsxs)(n.p,{children:[\"So our problem is we have this \",(0,e.jsx)(n.code,{children:\"config\"}),\" object but in Rust. The configuration object is a \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/rust-by-example/custom_types/structs.html\",children:\"struct\"}),\". It can be set and initialized somewhere in our program. The initialization bit is important as we will find out later. Our configuration could be simple default values set in the code, and updated later; or it could require reading files, exchanging data over the network, etc. So we want to be sure that we can do both.\"]}),(0,e.jsx)(n.p,{children:\"We have other requirements and although most of the use cases don't need these niceties, it is better to have them for the future (And these are the kind of problems that Rust is intended to solve). Like, for example, our program might also become multithreaded in the future, as we anticipate more cores in the CPU and less improvement in the clock rate.\"}),(0,e.jsx)(n.p,{children:\"Things are already starting to confuse; so how about we start with a simple example and the most basic implementation of a configuration struct.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Hello, world!\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Debugging value: {}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Rechecking Debugging value: {}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"output\"})}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Hello, world\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Debugging value: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Rechecking Debugging value: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Pretty simple: We use a function named \",(0,e.jsx)(n.code,{children:\"config\"}),\" to return an instance of our configuration. Inside \",(0,e.jsx)(n.code,{children:\"config\"}),\", we make a new \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\" instance for each call and then return it. (We could have placed this code in a different file and called it with \",(0,e.jsx)(n.code,{children:\"mod filename\"}),\"; we are going to do that later, so don't worry!).\"]}),(0,e.jsxs)(n.p,{children:[\"So far so good. But there is a small issue here: Every time we call the \",(0,e.jsx)(n.code,{children:\"config\"}),\" function, we return a \",(0,e.jsx)(n.em,{children:\"new\"}),\" instance of \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\". Practically speaking, it is the \",(0,e.jsx)(n.em,{children:\"same\"}),\" configuration; but technically speaking, it is a \",(0,e.jsx)(n.em,{children:\"different\"}),\" object. Imagine, for instance, that our \",(0,e.jsx)(n.code,{children:\"config\"}),\" function was querying a database for a particular field. The \",(0,e.jsx)(n.code,{children:\"config\"}),\" function will be doing the query every time we call it. This is not good; after all we should only do it one time both for efficiency and consistency.\"]}),(0,e.jsxs)(n.p,{children:[\"What we want is a single initialization of our configuration. That initialization is safeguarded somewhere, and then we access it as many times as we want. Basically, a global variable accessible from the \",(0,e.jsx)(n.code,{children:\"config\"}),\" function or any other location in our program.\"]}),(0,e.jsxs)(n.p,{children:[\"This time, we will separate our program into two files: \",(0,e.jsx)(n.code,{children:\"main.rs\"}),\" and \",(0,e.jsx)(n.code,{children:\"config.rs\"}),\". The code could function from within \",(0,e.jsx)(n.code,{children:\"main.rs\"}),\" but the separation of concerns is helpful.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Hello, world!\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Debug: {}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Rechecking Debug: {}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"config.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Alright, a lot is going on here; especially if you are both new to and confused by the Rust syntax. But don't worry, we will explain it in details. First, we are still using a function to return our configuration; but this time it is attached to the \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\" struct. Think of a Rust struct like a JavaScript object or in OOP languages like a class where you can add both fields and methods to your struct. The method that returns our configuration is \",(0,e.jsx)(n.code,{children:\"global_config\"}),\".\"]}),(0,e.jsx)(n.p,{children:\"Let's go back further, this line deserves some explanation.\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsx)(n.code,{className:\"language-rust code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,e.jsxs)(n.p,{children:[\"Creating a \",(0,e.jsx)(n.em,{children:\"global variable\"}),\" in Rust is pretty easy. We just use the \",(0,e.jsx)(n.code,{children:\"static\"}),\" keyword. Now, our variable \",(0,e.jsx)(n.em,{children:\"can be\"}),\" available anywhere in our program. In fact, this is what the rust-lang documentation says about the \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/rust-by-example/scope/lifetime/static_lifetime.html\",children:\"static\"}),\" keyword:\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"A 'static lifetime is the longest possible lifetime, and lasts for the lifetime of the running program.\"})}),(0,e.jsxs)(n.p,{children:[\"Okay, that was a trap. What is a \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/rust-by-example/scope/lifetime.html\",children:\"lifetime\"}),\"? Well, you can go with the raw and naive definition: How long you will live. But that definition doesn't seem about our \",(0,e.jsx)(n.code,{children:\"static\"}),\" keyword, or is it? It is also way too simplistic. The rust-lang website will already throw words like \",(0,e.jsx)(n.em,{children:\"borrow checker\"}),\" at you. That's scary, so how about we stick to the raw definition for now: How long the variable will live.\"]}),(0,e.jsxs)(n.p,{children:[\"So what's \",(0,e.jsx)(n.code,{children:\"'static\"}),\"? It is the longest lifetime; which means the entirety of our program. It means our variable will be \",(0,e.jsx)(n.em,{children:\"alive\"}),\" and accessible as long as our program is running. The \",(0,e.jsx)(n.code,{children:\"static\"}),\" keyword doesn't mean our variable is a \",(0,e.jsx)(n.em,{children:\"constant\"}),\" but just that it has a \",(0,e.jsx)(n.code,{children:\"'static\"}),\" lifetime. A better word is \",(0,e.jsx)(n.em,{children:\"immortal\"}),\" but that doesn't sound geeky and cryptic enough and hence the choice of \",(0,e.jsx)(n.code,{children:\"'static\"}),\". If you are still confused, notice that \",(0,e.jsx)(n.code,{children:\"'static\"}),\" is the name of the lifetime while \",(0,e.jsx)(n.code,{children:\"static\"}),\" is a keyword that gives our variable a \",(0,e.jsx)(n.code,{children:\"'static\"}),\" lifetime.\"]}),(0,e.jsxs)(n.p,{children:[\"Our configuration is initialized once and we declare a global variable named \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\". To access it, we use the function \",(0,e.jsx)(n.code,{children:\"global_config\"}),\" implemented in our struct; but since it is a global variable we could access it from anywhere really.\"]}),(0,e.jsxs)(n.p,{children:[\"Let's dissect the \",(0,e.jsx)(n.code,{children:\"global_config\"}),\" function. If you are new to Rust, you might have already noticed the gibberish in that function. We are not returning \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\" in the function signature but adding a bunch of keywords; something must be going on.\"]}),(0,e.jsx)(n.p,{children:\"To understand what is going on, you might need to understand the Rust Ownership/Borrowing model. Don't worry, we will stick to the naive definition: You can't take/move what you don't own, but you can borrow it. You can't make changes on what you borrow unless you request permissions; and even then you are going to have to follow some rules.\"}),(0,e.jsx)(n.p,{children:\"So let's test the constitution. If you run this line inside the main function.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsx)(n.code,{className:\"language-rust code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" myconfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"On execution, we are going to get the following error.\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"error\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"E0507\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" cannot \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"move\"}),\" out of \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),` item\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" src\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\"main\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"rs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"9\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"30\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"9\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" myconfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                              \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"^\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                              \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                              cannot \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"move\"}),\" out of \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),` item\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                              help\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" consider borrowing here\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" `\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),\"`\\n\"]})]})}),(0,e.jsxs)(n.p,{children:[\"We do not own \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\". The ruler, therefore, would not allow moving it but most importantly: There is no way around it. The ruler would also gives us a hint: consider borrowing.\"]}),(0,e.jsx)(n.p,{children:\"Borrowing is actually pretty cool: We can access the object from where it is located; and that is basically it. But that serves our purposes, right? (Plus Rust doesn't charge us any interest!).\"}),(0,e.jsxs)(n.p,{children:[\"So this code is fine. (again we can run this code on \",(0,e.jsx)(n.code,{children:\"main.rs\"}),\")\"]}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" myconfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"myconfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Notice that here we do neither own nor move \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\". We are barely \",(0,e.jsx)(n.em,{children:\"referencing\"}),\" it. The type of my \",(0,e.jsx)(n.code,{children:\"myconfig\"}),\" is \",(0,e.jsx)(n.code,{children:\"\u0026MyConfig\"}),\" and not \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\". A reference, and not the actual thing. To create a reference, we use an ampersand \",(0,e.jsx)(n.code,{children:\"\u0026\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"If you have been successfully following along, you almost did understand what the code in \",(0,e.jsx)(n.code,{children:\"global_config\"}),\" does. Except for one more sketchy keyword: \",(0,e.jsx)(n.code,{children:\"\u0026'static\"}),\". If we tried to return \",(0,e.jsx)(n.code,{children:\"\u0026MyConfig\"}),\" instead of \",(0,e.jsx)(n.code,{children:\"\u0026'static MyConfig\"}),\", we will get the following error.\"]}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"error\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"E0106\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`: missing lifetime specifier\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" --\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` src/config.rs:9:31\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"9\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"     pub fn global_config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" -\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                               ^ help: consider giving it a \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'static lifetime: `\u0026'\"}),\"static`\\n\"]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" help: this function's \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"type\"}),\" contains a borrowed value, but there is no value \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` it to be borrowed from\n`]})]})}),(0,e.jsx)(n.p,{children:\"The ruler is asking for a lifetime to our reference. You might be wondering: Why, and what does that mean? And what does a reference mean in the first place?\"}),(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html\",children:\"Rust Programming Language book\"}),\" has a rather helpful definition.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"These ampersands are references, and they allow you to refer to some value without taking ownership of it.\"})}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"The opposite of referencing by using \u0026 is dereferencing, which is accomplished with the dereference operator, *.\"})}),(0,e.jsxs)(n.p,{children:[\"Okay, so referencing is actually \",(0,e.jsx)(n.em,{children:\"borrowing\"}),\". But what is a lifetime? \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/rust-by-example/scope/lifetime.html\",children:\"Rust By Example\"}),\" has an average explanation.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"A lifetime is a construct the compiler (or more specifically, its borrow checker) uses to ensure all borrows are valid. Specifically, a variable's lifetime begins when it is created and ends when it is destroyed. While lifetimes and scopes are often referred to together, they are not the same.\"})}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Take, for example, the case where we borrow a variable via \u0026. The borrow has a lifetime that is determined by where it is declared. As a result, the borrow is valid as long as it ends before the lender is destroyed. However, the scope of the borrow is determined by where the reference is used.\"})}),(0,e.jsxs)(n.p,{children:[\"What if \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\" is dropped from memory? Now, we know for certain that this will not happen because \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\" is \",(0,e.jsx)(n.em,{children:\"immortal\"}),\" but the compiler doesn't know that. In our signature, we are returning a reference to \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\" and not \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\"; so it is not clear how long the real object will live for. If that object is dropped, then our reference will fail. We need to ensure that our reference lives at most as the object it is \",(0,e.jsx)(n.em,{children:\"pointing\"}),\" at. Not more.\"]}),(0,e.jsxs)(n.p,{children:[\"In my opinion, the hard part about lifetimes is the unreadable gibberish that accompanies it. First, we need to define (or name) a lifetime. We do that before the function signature. We will make use of \",(0,e.jsx)(n.code,{children:\"\u003c,\u003e\"}),` and an apostrophe; that's pretty clean. To make it more confusing, let's name our lifetime \"a\" even though we can use a more meaningful names. If everybody on the community does that, it will greatly help beginners: They will think it is some sort of keyword out there. But as we will use it again in the returned value with an apostrophe, they will finally succumb and concede that it is pure wizardry.`]}),(0,e.jsx)(n.p,{children:\"Look at this! This code actually runs!\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'a\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'a\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" myconfig \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),`myconfig\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Instead of defining a lifetime, we can assign the \",(0,e.jsx)(n.code,{children:\"'static\"}),\" lifetime. That makes sense since the item we are borrowing from has a \",(0,e.jsx)(n.code,{children:\"'static\"}),\" lifetime itself and should live for the entirety of the program. We don't need to define the \",(0,e.jsx)(n.code,{children:\"'static\"}),\" lifetime though, as it already is. If we replace the \",(0,e.jsx)(n.code,{children:\"'a\"}),\" with \",(0,e.jsx)(n.code,{children:\"'static\"}),\" and remove the definition, we will achieve our previous program.\"]}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.p,{children:[\"Let's move ahead. Now that your business is growing, your configuration is getting more sophisticated. In order to initialize the configuration, you need to run some tasks (like querying a database or reading from a file). Basically, you want to call a function that returns your configuration instead of having it \",(0,e.jsx)(n.em,{children:\"statically\"}),\" defined.\"]}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"Self\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"This new code defines a function \",(0,e.jsx)(n.code,{children:\"new\"}),\"; which you might think of as a constructor. It will create a new instance of \",(0,e.jsx)(n.code,{children:\"Myconfig\"}),\" and returns it. Since it is implemented within the \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\" struct, it is basically returning an instance of itself. Thus, the use of the keyword \",(0,e.jsx)(n.code,{children:\"self\"}),\".\"]}),(0,e.jsx)(n.p,{children:\"Unluckily, this doesn't work. The ruler, again, complains.\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"error\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"E0015\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\": calls \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),` statics are limited to constant functions, tuple structs and tuple variants\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" --\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` src/config.rs:6:31\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" pub static CONFIG: MyConfig \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MyConfig::new\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`                               ^^^^^^^^^^^^^^^\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"In case you think this is restricting, you need to understand one more idea: Statics are evaluated at compile time; in other words they are \",(0,e.jsx)(n.em,{children:\"hard-coded\"}),\" into the binary. Functions, on the other hand, are only called at run time. This means Rust can't determine the value of our static variable at compile time; and therefore can't compile the program.\"]}),(0,e.jsxs)(n.p,{children:[\"This is a major roadblock and there seems to be no way around it. Since it is impossible to assign a value to a \",(0,e.jsx)(n.em,{children:\"non-mutable\"}),\" static variable at run time, we will have to resort to magic. If you are a scientist and don't believe in magic, then this is a good time.\"]}),(0,e.jsxs)(n.p,{children:[\"First, we need to add an external dependency named \",(0,e.jsx)(n.code,{children:\"lazy_static\"}),\" to the \",(0,e.jsx)(n.code,{children:\"Cargo.toml\"}),\" file.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"Cargo.toml\"})}),(0,e.jsx)(n.pre,{className:\"language-toml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-toml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token class-name table\",children:\"dependencies\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property key\",children:\"lazy_static\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),' \"',(0,e.jsx)(n.span,{className:\"token number\",children:\"1.3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Next, we import the dependency on \",(0,e.jsx)(n.code,{children:\"main.rs\"}),\".\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[macro_use]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extern\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"crate\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"lazy_static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"And now to the magical part, replace the previous definition with the following.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"config.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property macro\",children:\"lazy_static!\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ref\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Tada! Now our program works. Pretty cool, heh? It is not clear what kind of magic the \",(0,e.jsx)(n.code,{children:\"lazy_static\"}),\" did but it just works. So that was lucky!\"]}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.p,{children:[\"Except things are about to complicate a bit more. A new bureaucrat in the organization demands that he is able to pass the debug value to the configuration constructor. Bureaucrats want control and this particular one is not happy that debug can only be set from within the \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\" constructor since it is outside of his jurisdiction.\"]}),(0,e.jsx)(n.p,{children:\"So we change our constructor to allow him to sneak in.\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"Self\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// We are just eluding him of power, we don't actually use the custom_debug variable.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"This code is fine but it won't compile because the static variable will require that we pass an optional boolean value. In case you don't know what \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/option/index.html\",children:\"Option\"}),\"s are, this is a good time to introduce them. The bureaucrat is not certain that he wants to pass a debug value all the times. He just wants to have the option in case he feels like it. Rust, however, requires that parameters (declared in the function signature) are fully respected. That is, if we have a debug parameter, it needs to be there.\"]}),(0,e.jsxs)(n.p,{children:[\"To manage this bureaucracy, Rust introduces an \",(0,e.jsx)(n.code,{children:\"Option\"}),\" type: It encapsulates the real value if there is one; and if there is none it returns a type named \",(0,e.jsx)(n.code,{children:\"None\"}),\". Simple. It also has a set of functions to manage that additional bureaucracy overhead.\"]}),(0,e.jsx)(n.p,{children:\"To make our code compile, we can do the following.\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property macro\",children:\"lazy_static!\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ref\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Notice that we are using a function named \",(0,e.jsx)(n.code,{children:\"Some\"}),\". This is because the value that we need to pass is not a \",(0,e.jsx)(n.code,{children:\"bool\"}),\" but an \",(0,e.jsx)(n.code,{children:\"Option\u003cbool\u003e\"}),\". The \",(0,e.jsx)(n.code,{children:\"Some\"}),\" function encapsulates our \",(0,e.jsx)(n.code,{children:\"bool\"}),\" inside an \",(0,e.jsx)(n.code,{children:\"Option\"}),\". So that was easy.\"]}),(0,e.jsxs)(n.p,{children:[\"Except that bureaucrats can't access the \",(0,e.jsx)(n.code,{children:\"config.rs\"}),\" file. They need to pass the value from another place: \",(0,e.jsx)(n.code,{children:\"main.rs\"}),\". Since our \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\" is not defined there, we need to create a new function to accommodate. This is going to complicate our setup but we have to comply.\"]}),(0,e.jsx)(n.p,{children:\"Easy, right?\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Result\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"lazy_static!\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ref\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Here we introduce, again, a new type: \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/result/\",children:\"Result\"}),\". \",(0,e.jsx)(n.code,{children:\"Result\"}),\" is similar to \",(0,e.jsx)(n.code,{children:\"Option\"}),\" but serves another purpose and the name should be self-explanatory. \",(0,e.jsx)(n.code,{children:\"Result\"}),\" could be either a success and return our result (in this case \",(0,e.jsx)(n.code,{children:\"()\"}),\") or a failure and return an error (in this case \",(0,e.jsx)(n.code,{children:\"i32\"}),\"). I'm not going to go through it but you can check the \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/result/\",children:\"Rust docs\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"Unfortunately, this doesn't work. Even though \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\" has a static (infinite) lifetime, you can't access it outside the \",(0,e.jsx)(n.code,{children:\"init\"}),\" function. In order to be able to do that, you need to return it. But we don't want to do that; and neither that works (We do not own \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\").\"]}),(0,e.jsxs)(n.p,{children:[\"If you think things started to overly complicate; then hold your breath. In the last example, we were not passing the \",(0,e.jsx)(n.code,{children:\"custom_debug\"}),\" variable; we were just accepting it in the function signature. Now that our bureaucrats found out our misdeed, we need to pass it to the \",(0,e.jsx)(n.code,{children:\"lazy_static!\"}),\" block; but if we do, we get the following error.\"]}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"error\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"E0434\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\": can't capture dynamic environment \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),` a fn item\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` src/config.rs:12:61\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"             pub static ref CONFIG: MyConfig \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MyConfig::new\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`                                                             ^^^^^^^^^^^^\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" help: use the \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),\". \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),` closure form instead\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Great, things are getting out of control; and Rust is throwing an unreadable error message. What is an \",(0,e.jsx)(n.em,{children:\"fn item\"}),\", a \",(0,e.jsx)(n.em,{children:\"dynamic environment\"}),\" and a \",(0,e.jsx)(n.em,{children:\"closure\"}),\"? That's a lot to take on a single error message and we already have another part of our program non-functioning. The truth is, we are coming to the reality that \",(0,e.jsx)(n.code,{children:\"lazy_static!\"}),\" is not magic. It is just a macro.\"]}),(0,e.jsxs)(n.p,{children:[\"What is a \",(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Macro_(computer_science)\",children:\"macro\"}),\"?\"]}),(0,e.jsx)(n.p,{children:\"A macro is a way to generate Rust code for you. But what is this macro exactly generating? That could shed some light to what it does and maybe hint to better solutions.\"}),(0,e.jsx)(n.p,{children:\"Well, it turns out that it is possible to know that. Using this command, we can output the final code that Rust is compiling.\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-shell\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cargo\"}),\" rustc -- \",(0,e.jsx)(n.span,{className:\"token variable parameter\",children:\"-Z\"}),\" unstable-options \",(0,e.jsx)(n.span,{className:\"token variable parameter\",children:\"--pretty\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`expanded\n`]})})}),(0,e.jsxs)(n.p,{children:[\"If you run this, you will see that a lot is going on. \",(0,e.jsx)(n.code,{children:\"println!\"}),\" is a macro. That means the final code is much more than that single line. For now, we will focus on the code generated by \",(0,e.jsx)(n.code,{children:\"lazy_static!\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[allow(missing_copy_implementations)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[allow(non_camel_case_types)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[allow(dead_code)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"CONFIG\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    __private_field\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[doc(hidden)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"__private_field\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"lazy_static\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),\"__Deref \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"Target\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"deref\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"self\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[inline(always)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"__static_ref_initialize\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[inline(always)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"__stability\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"LAZY\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"lazy_static\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"lazy\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Lazy\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"lazy_static\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"lazy\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Lazy\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"INIT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"LAZY\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"__static_ref_initialize\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token function\",children:\"__stability\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"lazy_static\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"LazyStatic\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"initialize\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"lazy\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"Self\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" _ \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"lazy\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Oops...\"}),(0,e.jsxs)(n.p,{children:[\"There is a lot going on here. First, \",(0,e.jsx)(n.code,{children:\"lazy_static!\"}),\" is creating a new type (\",(0,e.jsx)(n.code,{children:\"config::MyConfig::init::CONFIG\"}),\"). This can explain this weird error message when we try to return \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"error\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"E0308\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`: mismatched types\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` src/config.rs:15:12\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"15\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"         Ok\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"CONFIG\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"            ^^^^^^ expected struct \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"config::MyConfig\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),\", found struct \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"config::MyConfig::init::CONFIG\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" note: expected \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"type\"}),\" \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"config::MyConfig\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              found \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"type\"}),\" \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"config::MyConfig::init::CONFIG\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Cool. We are no longer using the \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\" struct but another one that \",(0,e.jsx)(n.code,{children:\"lazy_static!\"}),\" invented. It looks like \",(0,e.jsx)(n.code,{children:\"lazy_static!\"}),\" has code that executes our function, gets the returned value and creates a new type that imitates our struct. But don't take my word for it. I just happen to know about Rust as much as you do!\"]}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.p,{children:[\"Remind me again: \",(0,e.jsx)(n.em,{children:\"Why are we here\"}),\"?\"]}),(0,e.jsxs)(n.p,{children:[\"The thing is, our problem seems to be simple. Only if we were able to change the value of the static variable after declaring it. That will solve all of our headaches. Let us get rid of \",(0,e.jsx)(n.code,{children:\"lazy_static!\"}),\" and possibly enjoy the rest of the day with friends.\"]}),(0,e.jsx)(n.p,{children:\"Who said we can't?\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Hello, world!\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Debug value: {}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Recheck Debug value: {}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"config.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mut\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Result\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsafe\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap_or\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsafe\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"output\"})}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Hello, world\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Debug value: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Recheck Debug value: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Notice a few things here: \",(0,e.jsx)(n.code,{children:\"static\"}),\" means a \",(0,e.jsx)(n.code,{children:\"'static\"}),\" (infinite) lifetime. It doesn't mean we can't mutate the variable. It is not a constant. We can change it if we add the keyword \",(0,e.jsx)(n.code,{children:\"mut\"}),\". Rust doesn't consider it safe (Thus the \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html\",children:\"unsafe\"}),\" keyword) but what does Rust know about the life of the streets??! Our program works. There is \",(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=RS7IzU2VJIQ\",children:\"plastic in the ocean\"}),\"; I mean, on the big scheme of things, this is a minor issue, right?\"]}),(0,e.jsx)(n.hr,{}),(0,e.jsx)(n.p,{children:\"But this is not what Rust stands for, is it? We need to live up to the hype, but how do we go about that?\"}),(0,e.jsx)(n.p,{children:\"We can start by putting this line at the top of our program.\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsx)(n.code,{className:\"language-rust code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#![forbid(unsafe_code)]\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"Running the previous code will now result in an error.\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"error: usage of an \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"unsafe\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),` block\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  --\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` src/config.rs:10:9\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" /         unsafe \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"11\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"             CONFIG.debug \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" custom_debug.unwrap_or\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"false\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"12\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`_________^\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Now we know what we want. We want a global variable that we can, at a certain point, mutate with external variables. But we must do that safely; and be ready for the future of multiple processors, cores and threads.\"}),(0,e.jsx)(n.p,{children:\"Let's start with the global variable mutation. One might think that it is not possible to safely mutate static variables. And that's actually correct which is why the Rust team has come up with some solutions.\"}),(0,e.jsxs)(n.p,{children:[\"Hidden somewhere in one of Rust's types documentation (\",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/cell/struct.Cell.html\",children:\"Cell\"}),\"), we can read the following.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Rust memory safety is based on this rule: Given an object T, it is only possible to have one of the following:\"})}),(0,e.jsx)(n.blockquote,{children:(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Having several immutable references (\u0026T) to the object (also known as aliasing).\"}),(0,e.jsx)(n.li,{children:\"Having one mutable reference (\u0026mut T) to the object (also known as mutability).\"})]})}),(0,e.jsx)(n.p,{children:\"Yes, that's our problem right here.\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"This is enforced by the Rust compiler. However, there are situations where this rule is not flexible enough. Sometimes it is required to have multiple references to an object and yet mutate it.\"})}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Shareable mutable containers exist to permit mutability in a controlled manner, even in the presence of aliasing. bla bla bla...\"})}),(0,e.jsxs)(n.p,{children:[\"Cool. That's our solution right there. The \",(0,e.jsx)(n.code,{children:\"Cell\"}),\"! Let's go and implement it.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"config.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"cell\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Cell\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug, Copy, Clone)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Cell\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Cell\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Result\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"match\"}),\" custom_debug \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"debug_value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"set\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" debug_value \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"None\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"output\"})}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"error\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"E0277\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\": \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"std::cell::Cell\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"config::MyConfig\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),` cannot be shared between threads safely\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" --\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` src/config.rs:8:1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" pub static CONFIG: Cell\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"MyConfig\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" Cell::new\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"std::cell::Cell\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"config::MyConfig\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),` cannot be shared between threads safely\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" help: the trait \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"std::marker::Sync\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),\" is not implemented \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"std::cell::Cell\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"config::MyConfig\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" note: shared static variables must have a \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"type\"}),\" that implements \",(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"}),\"Sync\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"`\"})]}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"This doesn't work but it is important to note that this particular configuration, add a few complications: The \",(0,e.jsx)(n.code,{children:\"Clone\"}),\" and \",(0,e.jsx)(n.code,{children:\"Copy\"}),\" keywords. While they seem harmless now, they might be limiting for your future configurations complexity. In case you are wondering what they are about, we will get to them later on in this article.\"]}),(0,e.jsxs)(n.p,{children:[\"But, for now, the gist of it, is that \",(0,e.jsx)(n.code,{children:\"Cell\"}),\" is not thread-safe; whatever that means. We need a type like \",(0,e.jsx)(n.code,{children:\"Cell\"}),\" but that happens to be \",(0,e.jsx)(n.em,{children:\"thread-safe\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"Browsing more through the Rust website, we find the \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/sync/atomic/\",children:\"atomic types\"}),\".\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Atomic types provide primitive shared-memory communication between threads, and are the building blocks of other concurrent types.\"})}),(0,e.jsx)(n.p,{children:\"Reading further into the documentation.\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Atomic variables are safe to share between threads (they implement Sync) but they do not themselves provide the mechanism for sharing and follow the threading model of rust. The most common way to share an atomic variable is to put it into an Arc (an atomically-reference-counted shared pointer).\"})}),(0,e.jsx)(n.p,{children:\"Atomic variables looks like they are the building block for higher-level types that might solve our problem. We should not use them (as per the advice of the documentation) and instead use the higher-level abstractions.\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Most of the low-level synchronization primitives are quite error-prone and inconvenient to use, which is why the standard library also exposes some higher-level synchronization objects.\"})}),(0,e.jsxs)(n.p,{children:[\"These objects are \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Arc.html\",children:\"Arc\"}),\", \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Barrier.html\",children:\"Barrier\"}),\", \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Condvar.html\",children:\"Condvar\"}),\", \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Mutex.html\",children:\"Mutex\"}),\", \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/sync/struct.Once.html\",children:\"Once\"}),\", and \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/sync/struct.RwLock.html\",children:\"RwLock\"}),\". That's a lot and might mean that the problem at hand is rather hard. Imagine you have two threads executing at the same time: You'd want a solid framework to let them share access to the same variable. That's basically what this mess is about. If we were to have a single-threaded application, things would be much simpler. But we live in a world where quantum tunneling is a real thing!\"]}),(0,e.jsx)(n.p,{children:\"So which one do we need? We want multiple access to the global variable (configuration). There are several that can fit the bill. Each has its own quirks and limitations.\"}),(0,e.jsxs)(n.p,{children:[\"Let's look for example at \",(0,e.jsx)(n.code,{children:\"Once\"}),\".\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"A synchronization primitive which can be used to run a one-time global initialization. Useful for one-time initialization for FFI or related functionality. This type can only be constructed with the ONCE_INIT value or the equivalent Once::new constructor.\"})}),(0,e.jsx)(n.p,{children:\"This sounds good if we want to do a single, one-time initialization of our configuration variable. But how is the code going to look like and what if we initialize twice?\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Hello, world!\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Debug value: {}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Recheck Debug value: {}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Recheck Debug value: {}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"config.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Once\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INIT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Once\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Once\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mut\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Result\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INIT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"call_once\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token closure-params\",children:[(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsafe\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"match\"}),\" custom_debug \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"debug_value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"None\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsafe\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"The program runs and here is the output.\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Hello, world\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Debug value: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Recheck Debug value: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Recheck Debug value: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Cool. The \",(0,e.jsx)(n.code,{children:\"init\"}),\" function is functioning as expected. If we recall \",(0,e.jsx)(n.code,{children:\"init\"}),\" twice, however, nothing happens. We can pass variables to our closure. So everything is working just fine. Plus we got rid of the \",(0,e.jsx)(n.code,{children:\"lazy_static\"}),\" crate. One thing to keep out of this mess.\"]}),(0,e.jsxs)(n.p,{children:[\"Except, if you have a good eye, you should have noticed something that you probably won't like much (at least if you agreed with our previous monologue). We are using \",(0,e.jsx)(n.code,{children:\"unsafe\"}),\" code!\"]}),(0,e.jsx)(n.p,{children:\"Well, according to Rust, this should be pretty safe.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:\"// Accessing a `static mut` is unsafe much of the time, but if we do so\\n\"}),(0,e.jsx)(n.span,{className:\"code-line\",children:`// in a synchronized fashion (e.g., write once or read all) then we're\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`// good to go!\n`})]})}),(0,e.jsxs)(n.p,{children:[\"But there is still something bugging me about it: First, we can only change the configuration one time. This might be enough but it is not quite what we want. Second, we are using \",(0,e.jsx)(n.code,{children:\"unsafe\"}),\" blocks of code. While this is somewhat safe, it opens up the possibility that a developer handles the code unsafely. After all, you just opened a can of worms in a controlled environment. That might have risks since the environment might get out of our control as the code base grows and more developers are recruited.\"]}),(0,e.jsxs)(n.p,{children:[\"Better keep the can of worms closed if we can afford it. Luckily, we have a wide range of sync objects to choose from. Let's look at \",(0,e.jsx)(n.code,{children:\"RwLock\"}),\".\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"This type of lock allows a number of readers or at most one writer at any point in time. The write portion of this lock typically allows modification of the underlying data (exclusive access) and the read portion of this lock typically allows for read-only access (shared access).\"})}),(0,e.jsx)(n.p,{children:\"Sounds too good to be true? This allows us, basically, to modify the global variables (from a single location) and access it from multiple locations. Well it does come with some complications, however.\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"The priority policy of the lock is dependent on the underlying operating system's implementation, and this type does not guarantee that any particular policy will be used.\"})}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"The type parameter T represents the data that this lock protects. It is required that T satisfies Send to be shared across threads and Sync to allow concurrent access through readers. The RAII guards returned from the locking methods implement Deref (and DerefMut for the write methods) to allow access to the content of the lock.\"})}),(0,e.jsx)(n.p,{children:\"That's some more gibberish out there; but this looks like something we should be able to manage. Let's give it a try.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[macro_use]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extern\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"crate\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"lazy_static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"config.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property macro\",children:\"lazy_static!\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ref\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Result\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mut\"}),\" w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"write\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"match\"}),\" custom_debug \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"debug_value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" debug_value \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"None\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" m \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"read\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"m\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"This program requires \",(0,e.jsx)(n.code,{children:\"lazy_static\"}),\" as a dependency. If we \",(0,e.jsx)(n.code,{children:\"cargo run\"}),\" it, we will get the following output.\"]}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/config.rs:26\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" m \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" RwLockReadGuard \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    lock: RwLock \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        data: MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            debug: false,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/config.rs:26\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" m \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" RwLockReadGuard \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    lock: RwLock \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        data: MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            debug: true,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/config.rs:26\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" m \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" RwLockReadGuard \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    lock: RwLock \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        data: MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            debug: false,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Looks good? We have a static global variable \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\". Inside this global variable is a \",(0,e.jsx)(n.code,{children:\"RwLock\u003cMyConfig\u003e\"}),\" object. We can mutate the inside of the \",(0,e.jsx)(n.code,{children:\"RwLock\"}),\" by using the \",(0,e.jsx)(n.code,{children:\"write\"}),\" function. We do this in the \",(0,e.jsx)(n.code,{children:\"init\"}),\" function of \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\"; and we can also pass variables.\"]}),(0,e.jsxs)(n.p,{children:[\"So everything is good, right? Well, kind of. You might have noticed that we are not returning the \",(0,e.jsx)(n.code,{children:\"CONFIG\"}),\" struct or a reference to it. Instead, we are displaying the content inside the function itself. But that might not be what you want, you might want to access the values from another place and access it directly.\"]}),(0,e.jsxs)(n.p,{children:[\"We can try that but let's first understand what \",(0,e.jsx)(n.code,{children:\"CONFIG.read().unwrap()\"}),\" is returning. Using the \",(0,e.jsx)(n.code,{children:\"dbg!\"}),\" command, we are getting the following.\"]}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/config.rs:26\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" m \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" RwLockReadGuard \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    lock: RwLock \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        data: MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            debug: false,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"So it is not our \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\". Or, it is our \",(0,e.jsx)(n.code,{children:\"MyConfig\"}),\" but wrapped inside another structure of the type \",(0,e.jsx)(n.code,{children:\"RwLockReadGuard\"}),\" and stored two levels deep (\",(0,e.jsx)(n.code,{children:\"lock\"}),\" and \",(0,e.jsx)(n.code,{children:\"data\"}),\" fields). The documentation for it is the following.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"RAII structure used to release the shared read access of a lock when dropped.\"})}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"This structure is created by the read and try_read methods on RwLock.\"})}),(0,e.jsxs)(n.p,{children:[\"That's more gibberish. What is \",(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization\",children:\"RAII\"}),\"?\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Resource acquisition is initialization (RAII)[1] is a programming idiom[2] used in several object-oriented languages to describe a particular language behavior. In RAII, holding a resource is a class invariant, and is tied to object lifetime: resource allocation (or acquisition) is done during object creation (specifically initialization), by the constructor, while resource deallocation (release) is done during object destruction (specifically finalization), by the destructor.\"})}),(0,e.jsxs)(n.p,{children:[\"There is another \",(0,e.jsx)(n.a,{href:\"https://www.toptal.com/software/eliminating-garbage-collector\",children:\"article\"}),\" that has another definition.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"All that manual management was unpleasant, to say the least. In the mid-80s, Bjarne Stroustrup invented a new paradigm for his brand-new language, C++. He called it Resource Acquisition Is Initialization, and the fundamental insights were the following: objects can be specified to have constructors and destructors which are called automatically at appropriate times by the compiler, this provides a much more convenient way to manage the memory a given object requires, and the technique is also useful for resources which are not memory.\"})}),(0,e.jsxs)(n.p,{children:[\"So that's good. But isn't everything in Rust a RAII structure and what does it mean for our \",(0,e.jsx)(n.code,{children:\"RwLockReadGuard\"}),\"? To see how this unfolds, let's try returning our \",(0,e.jsx)(n.code,{children:\"RwLockReadGuard\"}),\". We will have to unlock every time we want to access the data but there is a price for everything, right?\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[macro_use]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extern\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"crate\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"lazy_static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Initialize the configuration\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Return 'RwLockReadGuard'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" a \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Display 'MyConfig'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"a\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"config.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLockReadGuard\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property macro\",children:\"lazy_static!\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ref\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Result\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mut\"}),\" w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"write\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"match\"}),\" custom_debug \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"debug_value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" debug_value \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"None\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLockReadGuard\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" m\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLockReadGuard\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"read\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        m\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Run the following and we will get.\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/main.rs:15\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"*a \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    debug: true,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"So that's perfect, right? Let's try to re-initialize our configuration struct.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[macro_use]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extern\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"crate\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"lazy_static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Initialize the configuration\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Return 'RwLockReadGuard'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" a \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Display 'MyConfig'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"a\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Reinit MyConfig\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Return 'RwLockReadGuard'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" b \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Display 'MyConfig'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"b\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Output\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/main.rs:15\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"*a \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    debug: true,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Hmm, not exactly the output we expect. Wait! The program didn't quit. It is stuck there!\"}),(0,e.jsx)(n.p,{children:\"We tried to cheat our way out of this complexity by plowing through the different types and trying different things. But, obviously, we hit another roadblock. It'd be better to get an understanding of why our program suddenly halted and never returned. It is like our program is stuck in an infinite loop but there is no loop in our code. Or is there?\"}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.p,{children:[\"Remind me again: \",(0,e.jsx)(n.em,{children:\"Why are we here\"}),\"?\"]}),(0,e.jsxs)(n.p,{children:[\"Why are we going through all of this complexity? What is exactly wrong with simple \",(0,e.jsx)(n.code,{children:\"unsafe\"}),\" code. Well, to understand that, you might need to witness the dangers of \",(0,e.jsx)(n.code,{children:\"unsafe\"}),\" code in real life.\"]}),(0,e.jsxs)(n.p,{children:[\"First, let's remember that our problem only exists if we are working on multiple threads. This means multiple cores. Let's look at this video from a Udacity online MOOC (\",(0,e.jsx)(n.a,{href:\"https://www.udacity.com/course/high-performance-computer-architecture--ud007\",children:\"High Performance Computer Architecture\"}),\"). I would recommend you take the whole course later as it goes deeper on other related topics; but for now this video will do it.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=BMkW9Iwh80E\",children:(0,e.jsx)(n.img,{alt:\"Synchronization Example\",src:\"http://img.youtube.com/vi/BMkW9Iwh80E/0.jpg\"})})}),(0,e.jsxs)(n.p,{children:[\"In a nutshell, our problem is due to the fact that two processes trying to access the same memory location (or variable) at the same time can result in a conflict. To ensure consistency, the processor has a set of operations named \",(0,e.jsx)(n.em,{children:\"atomic operations\"}),\" that can guarantee the linearizability of execution. That's why using \",(0,e.jsx)(n.code,{children:\"unsafe\"}),\" code with \",(0,e.jsx)(n.code,{children:\"Once\"}),\" is safe: \",(0,e.jsx)(n.code,{children:\"Once\"}),\" ensures that our operation is linear.\"]}),(0,e.jsxs)(n.p,{children:[\"Also, what are atomic operations? Amdan from Stackoverflow has a rather useful \",(0,e.jsx)(n.a,{href:\"https://stackoverflow.com/a/52196874/12637\",children:\"explanation\"}),\". Basically, atomic operations are operations that don't suffer from this conflict. They are executed by the processor directly. That might help explaining some of the gibberish above in the \",(0,e.jsx)(n.code,{children:\"RwLock\"}),\" definition above.\"]}),(0,e.jsx)(n.p,{children:\"Okay, let's try a couple examples (actually three) and see why unsafe code can give inaccurate results or worse.\"}),(0,e.jsx)(n.p,{children:\"In the first example, we show how to use multi-threading by executing two threads together. This example is not related to the configuration code, so we can (and probably should) execute it in a different program.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),\"thread\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Executes Thread 1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" thread1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"thread\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token function\",children:\"spawn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token closure-params\",children:[(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"100\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Thread 1\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Executes Thread 2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" thread2 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"thread\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token function\",children:\"spawn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token closure-params\",children:[(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"100\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Thread 2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Makes sure our threads have executed and returned\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    thread1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"join\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    thread2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"join\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Execution completed\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"output\"})}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Thread \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Thread \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Thread \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Thread \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Thread \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Thread \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Thread \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Thread \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Execution completed\n`})]})}),(0,e.jsx)(n.p,{children:'What our program does is launch two threads. Each thread is going to write to the terminal. Thread 1 will write \"Thread 1\" and Thread 2 will write \"Thread 2\". Since our threads are executing at the same time, we get a mix of these two lines; and it is not predictable which will happen first.'}),(0,e.jsxs)(n.p,{children:[\"You might notice here that we are using a new weird sign \",(0,e.jsx)(n.code,{children:\"||\"}),\". That denotes a closure. A \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/rust-by-example/fn/closures.html\",children:\"closure\"}),\" is very similar to an anonymous function with the benefit that it can capture variables from its environment. There are various articles about Rust closures but, for now, if you stick to the idea that they are anonymous functions, then that's enough.\"]}),(0,e.jsxs)(n.p,{children:[\"It is important to highlight that these threads are independent from our main thread or program. While these threads start executing as soon as we spawn them, they might not finish before our program exits. So we must force them to finish execution before our program exits with the \",(0,e.jsx)(n.code,{children:\"join\"}),\" function.\"]}),(0,e.jsxs)(n.p,{children:[\"Now that we are comfortable running multiple threads, let's do more: Create a global variable and modify it from both threads. This might seem harmless but it is not something that Rust will allow \",(0,e.jsx)(n.em,{children:\"safely\"}),\" without jumping through hoops. So let's start with the simple and direct approach: Unsafe code. We will declare a global mutable variable, and then mutate it from inside each thread. The variable is a 32-bit integer and from inside the threads we will loop and increment this integer.\"]}),(0,e.jsx)(n.p,{children:\"Same as before, this example can run on its own.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),\"thread\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mut\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" thread1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"thread\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token function\",children:\"spawn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token closure-params\",children:[(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsafe\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" thread2 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"thread\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token function\",children:\"spawn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token closure-params\",children:[(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsafe\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    thread1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"join\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    thread2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"join\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"unsafe\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"{}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Alright, let's execute our program. We do 999 iteration in each thread, so we expect our integer to have the value of 1998.\"}),(0,e.jsx)(n.p,{children:\"First execution.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"output\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`1254\n`})})}),(0,e.jsx)(n.p,{children:\"Hmm. That's not our expectation, let's try again.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"output\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`1443\n`})})}),(0,e.jsx)(n.p,{children:\"Cool. We made a random number generator! (Slightly joking; it would be interesting to study how random these numbers are, though).\"}),(0,e.jsxs)(n.p,{children:[\"But why are our results not consistent? Well, it is the synchronization issue. The two threads are not synchronized and in multiple occasions (more than enough), they increment the value at the \",(0,e.jsx)(n.em,{children:\"exact\"}),\" same time. When that happens, the value is only incremented once.\"]}),(0,e.jsx)(n.p,{children:\"So how do we fix this problem? Well, this is exactly why the Rust team came up with the synchronization primitives.\"}),(0,e.jsxs)(n.p,{children:[\"Let's try to use \",(0,e.jsx)(n.code,{children:\"RwLock\"}),\" now.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[macro_use]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extern\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"crate\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"lazy_static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),\"thread\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property macro\",children:\"lazy_static!\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ref\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" thread1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"thread\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token function\",children:\"spawn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token closure-params\",children:[(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mut\"}),\" w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"write\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" thread2 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"thread\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token function\",children:\"spawn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token closure-params\",children:[(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation closure-punctuation\",children:\"|\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mut\"}),\" w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"write\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    thread1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"join\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    thread2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"join\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" r \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"INC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"read\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"println!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"{}\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"r\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"output\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`1998\n`})})}),(0,e.jsxs)(n.p,{children:[\"Instead of mutating the global variable directly, we are mutating our type through \",(0,e.jsx)(n.code,{children:\"RwLock\"}),\". \",(0,e.jsx)(n.code,{children:\"RwLock\"}),\" ensures that we are using atomic operations. If one thread is incrementing the variable, the other thread has to wait. You should have already noticed the name of \",(0,e.jsx)(n.code,{children:\"RwLock\"}),\". It is a lock. Go again through the definition and you might understand it more stuff now. That's why in the previous \",(0,e.jsx)(n.code,{children:\"RwLock\"}),\" example our program was stuck. It was waiting for \",(0,e.jsx)(n.code,{children:\"RwLock\"}),\" to be unlocked so that it can access it again.\"]}),(0,e.jsxs)(n.p,{children:[\"Alright, let's make use of this knowledge and implement our final solution. For the fun of it, we are going to add a \",(0,e.jsx)(n.code,{children:\"String\"}),\" field. Because, you know, bureaucracy!\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[macro_use]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extern\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"crate\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"lazy_static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"ops\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Deref\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// First, we get an RwLockReadGuard\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" guard \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Next, we deref the guard and get MyConfig\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" guard\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"deref\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Freely access MyConfig by borrowing it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// We drop the guard and unlock the RwLock\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"drop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"guard\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Re-initialize our configuration\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"from\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Updated\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Go through the same process again\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" guard \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" guard\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"deref\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"drop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"guard\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"config.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLockReadGuard\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property macro\",children:\"lazy_static!\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ref\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"from\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Some info\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" custom_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Result\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mut\"}),\" w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"write\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"match\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" custom_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"debug_value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" debug_value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" custom_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            _ \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLockReadGuard\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" m \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"read\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        m\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"output\"})}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/main.rs:17\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    debug: false,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    info: \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Some info\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/main.rs:18\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"config.info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Some info\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/main.rs:32\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    debug: true,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    info: \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Updated\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/main.rs:33\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"config.info \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Updated\"'}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Hooray! This works! It is a pain in the \",(0,e.jsx)(n.strong,{children:\"_ but it serves our purposes, and it is safe. That should be everything Rust stands for (At least, I'm certain of the pain in the _\"}),\" part)!\"]}),(0,e.jsxs)(n.p,{children:[\"Alright, could this be simpler? We promised above to cover the \",(0,e.jsx)(n.code,{children:\"Copy\"}),\" and \",(0,e.jsx)(n.code,{children:\"Clone\"}),\" keywords, and this is the part where we do. Remember the Ownership/Borrowing concept we talked above at first? That you can't take something you don't own but you can borrow it? But what if you were able to \",(0,e.jsx)(n.em,{children:\"clone\"}),\" it. Well, that makes you able to return the actual type.\"]}),(0,e.jsxs)(n.p,{children:[\"There are types that don't \",(0,e.jsx)(n.em,{children:\"derive\"}),\" Copy. We won't go into the details of why and how. Partly because we have already covered a lot on this topic but also because there are lots of good resources on this. The Rust Programming Language book does a good job on that: \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html\",children:\"What is ownership\"})]}),(0,e.jsx)(n.p,{children:\"Let's see how this would work.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[macro_use]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extern\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"crate\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"lazy_static\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,e.jsx)(n.span,{className:\"token namespace module-declaration\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" a \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"a\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Updated\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" a \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property macro\",children:\"dbg!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"a\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"config.rs\"})}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"std\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attr-name attribute\",children:\"#[derive(Debug, Clone, Copy)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name type-definition\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"str\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property macro\",children:\"lazy_static!\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ref\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"RwLock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"new\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Some info\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"impl\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" custom_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Option\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"str\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Result\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"i32\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"mut\"}),\" w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"write\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"match\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_debug \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" custom_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"debug_value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Some\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"custom_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"w \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" debug\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" debug_value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" custom_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            _ \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Ok\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-definition\",children:\"global_config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyConfig\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" m \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONFIG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"read\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// This doesn't return *m but a copy of it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),`m\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"output\"})}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/main.rs:11\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" a \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    debug: false,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    info: \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Some info\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"src/main.rs:17\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" a \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" MyConfig \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    debug: true,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    info: \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Updated\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"That's convenient but you have to keep in mind that we are returning copies of the configuration and not the actual configuration.\"}),(0,e.jsx)(n.hr,{}),(0,e.jsx)(n.p,{children:\"I hope this introduction to Rust wasn't overwhelming.\"})]})}function b(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,Object.assign({},a,{children:(0,e.jsx)(d,a)})):d(a)}var v=b;return y(C);})();\n;return Component;","toc":[],"frontMatter":{"readingTime":{"text":"51 min read","minutes":50.785,"time":3047100,"words":10157},"slug":"rust-intro","fileName":"rust-intro.md","title":"A brief introduction to Rust","date":"2019-10-10T00:00:00.000Z","tags":["Rust","Programming"],"draft":false,"summary":"A brief introduction to Rust","images":[],"layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.205,"time":12300,"words":41},"slug":["default"],"fileName":"default.md","name":"Abid Omar","avatar":"/static/images/avatar.png","occupation":"Entrepreneur","company":"Aderbal","email":"contact@omarabid.com","github":"https://github.com/omarabid","date":null}],"prev":{"title":"The VIM Experience","date":"2019-04-27T00:00:00.000Z","tags":["vim","productivity"],"draft":false,"summary":"7 years journey with VIM","images":[],"layout":"PostLayout","slug":"vim"},"next":{"title":"Rust 2020: A better ecosystem","date":"2019-11-01T00:00:00.000Z","tags":["Rust","Programming"],"draft":false,"summary":"Suggestions for Rust 2020","images":[],"layout":"PostLayout","slug":"rust-2020"}},"__N_SSG":true},"page":"/[slug]","query":{"slug":"rust-intro"},"buildId":"0qN_KK8eLo_6RbAp1z1lJ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>